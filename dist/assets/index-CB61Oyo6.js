import{j as n,c as Ui,u as zi,i as J,T as U,I as et,a as G,B as g,C as z,G as _,b as f,L as _e,D as Jt,k as mr,d as je,e as Ae,f as Be,g as De,h as ee,A as ie,l as be,P as re,m as Y,V as Zt,n as er,o as ke,F as tt,p as rt,S as nt,M as Te,q as jt,r as Ln,s as Wn,E as Vi,t as Fn,Z as Hi,v as pr,w as Yi,x as tr,y as Gi,z as St,H as gr,J as _t,K as xr,N as Ki,O as Xi,Q as $n,R as qn,U as Un,W as Qi,X as Ji,Y as zn,_ as Zi,$ as Ct,a0 as Vn,a1 as ea,a2 as ta,a3 as rr,a4 as ra,a5 as st,a6 as na,a7 as Hn,a8 as Yn,a9 as sa,aa as Gn,ab as Kn,ac as ia,ad as aa,ae as an,af as on,ag as oa,ah as ca,ai as la}from"./mui-DcUurOWy.js";import{c as da,r as b,g as ua,L as Me,u as ae,d as ha,e as Xn,a as Ge,f as ft,h as fa,i as ma,j as pa,k as se,B as ga}from"./vendor-Cvc6gCqx.js";import{r as Et,_ as kt,C as It,a as Mt,E as Qn,o as xa,F as Jn,L as ya,g as Zn,i as es,b as ts,v as rs,c as cn,d as ns,e as ss,f as ba,h as va,j as wa,k as ja,s as Sa,l as _a,p as Ca,m as Ea,n as ka,q as Ia,t as Aa,u as Da,w as Ta,x as Pa,y as Ra,z as is,A as Oa,B as Ce,D as Ne,G as it,H as yr,I as he,J as ze,K as Bt,M as as,N as Ma,O as nr,P as Ba,Q as Nt,R as os,S as cs,T as at,U as ls,V as ds,W as br}from"./firebase-VOhLn62j.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function r(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=r(i);fetch(i.href,a)}})();var us,ln=da;us=ln.createRoot,ln.hydrateRoot;const hs=b.createContext({logPageView:()=>{},logEvent:()=>{}}),Na=()=>{const t=b.useContext(hs);if(!t)throw new Error("useAnalytics трябва да се използва в AnalyticsProvider");return t},La=({children:t})=>{const e=s=>{console.log(`Page viewed: ${s}`)},r=(s,i)=>{console.log(`Event: ${s}`,i)};return n.jsx(hs.Provider,{value:{logPageView:e,logEvent:r},children:t})},fs="@firebase/installations",vr="0.6.9";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ms=1e4,ps=`w:${vr}`,gs="FIS_v2",Wa="https://firebaseinstallations.googleapis.com/v1",Fa=60*60*1e3,$a="installations",qa="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ua={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},Le=new Qn($a,qa,Ua);function xs(t){return t instanceof Jn&&t.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ys({projectId:t}){return`${Wa}/projects/${t}/installations`}function bs(t){return{token:t.token,requestStatus:2,expiresIn:Va(t.expiresIn),creationTime:Date.now()}}async function vs(t,e){const s=(await e.json()).error;return Le.create("request-failed",{requestName:t,serverCode:s.code,serverMessage:s.message,serverStatus:s.status})}function ws({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}function za(t,{refreshToken:e}){const r=ws(t);return r.append("Authorization",Ha(e)),r}async function js(t){const e=await t();return e.status>=500&&e.status<600?t():e}function Va(t){return Number(t.replace("s","000"))}function Ha(t){return`${gs} ${t}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ya({appConfig:t,heartbeatServiceProvider:e},{fid:r}){const s=ys(t),i=ws(t),a=e.getImmediate({optional:!0});if(a){const d=await a.getHeartbeatsHeader();d&&i.append("x-firebase-client",d)}const o={fid:r,authVersion:gs,appId:t.appId,sdkVersion:ps},c={method:"POST",headers:i,body:JSON.stringify(o)},l=await js(()=>fetch(s,c));if(l.ok){const d=await l.json();return{fid:d.fid||r,registrationStatus:2,refreshToken:d.refreshToken,authToken:bs(d.authToken)}}else throw await vs("Create Installation",l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ss(t){return new Promise(e=>{setTimeout(e,t)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ga(t){return btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ka=/^[cdef][\w-]{21}$/,sr="";function Xa(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const r=Qa(t);return Ka.test(r)?r:sr}catch{return sr}}function Qa(t){return Ga(t).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lt(t){return`${t.appName}!${t.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _s=new Map;function Cs(t,e){const r=Lt(t);Es(r,e),Ja(r,e)}function Es(t,e){const r=_s.get(t);if(r)for(const s of r)s(e)}function Ja(t,e){const r=Za();r&&r.postMessage({key:t,fid:e}),eo()}let Oe=null;function Za(){return!Oe&&"BroadcastChannel"in self&&(Oe=new BroadcastChannel("[Firebase] FID Change"),Oe.onmessage=t=>{Es(t.data.key,t.data.fid)}),Oe}function eo(){_s.size===0&&Oe&&(Oe.close(),Oe=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const to="firebase-installations-database",ro=1,We="firebase-installations-store";let zt=null;function wr(){return zt||(zt=xa(to,ro,{upgrade:(t,e)=>{switch(e){case 0:t.createObjectStore(We)}}})),zt}async function At(t,e){const r=Lt(t),i=(await wr()).transaction(We,"readwrite"),a=i.objectStore(We),o=await a.get(r);return await a.put(e,r),await i.done,(!o||o.fid!==e.fid)&&Cs(t,e.fid),e}async function ks(t){const e=Lt(t),s=(await wr()).transaction(We,"readwrite");await s.objectStore(We).delete(e),await s.done}async function Wt(t,e){const r=Lt(t),i=(await wr()).transaction(We,"readwrite"),a=i.objectStore(We),o=await a.get(r),c=e(o);return c===void 0?await a.delete(r):await a.put(c,r),await i.done,c&&(!o||o.fid!==c.fid)&&Cs(t,c.fid),c}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jr(t){let e;const r=await Wt(t.appConfig,s=>{const i=no(s),a=so(t,i);return e=a.registrationPromise,a.installationEntry});return r.fid===sr?{installationEntry:await e}:{installationEntry:r,registrationPromise:e}}function no(t){const e=t||{fid:Xa(),registrationStatus:0};return Is(e)}function so(t,e){if(e.registrationStatus===0){if(!navigator.onLine){const i=Promise.reject(Le.create("app-offline"));return{installationEntry:e,registrationPromise:i}}const r={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},s=io(t,r);return{installationEntry:r,registrationPromise:s}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:ao(t)}:{installationEntry:e}}async function io(t,e){try{const r=await Ya(t,e);return At(t.appConfig,r)}catch(r){throw xs(r)&&r.customData.serverCode===409?await ks(t.appConfig):await At(t.appConfig,{fid:e.fid,registrationStatus:0}),r}}async function ao(t){let e=await dn(t.appConfig);for(;e.registrationStatus===1;)await Ss(100),e=await dn(t.appConfig);if(e.registrationStatus===0){const{installationEntry:r,registrationPromise:s}=await jr(t);return s||r}return e}function dn(t){return Wt(t,e=>{if(!e)throw Le.create("installation-not-found");return Is(e)})}function Is(t){return oo(t)?{fid:t.fid,registrationStatus:0}:t}function oo(t){return t.registrationStatus===1&&t.registrationTime+ms<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function co({appConfig:t,heartbeatServiceProvider:e},r){const s=lo(t,r),i=za(t,r),a=e.getImmediate({optional:!0});if(a){const d=await a.getHeartbeatsHeader();d&&i.append("x-firebase-client",d)}const o={installation:{sdkVersion:ps,appId:t.appId}},c={method:"POST",headers:i,body:JSON.stringify(o)},l=await js(()=>fetch(s,c));if(l.ok){const d=await l.json();return bs(d)}else throw await vs("Generate Auth Token",l)}function lo(t,{fid:e}){return`${ys(t)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Sr(t,e=!1){let r;const s=await Wt(t.appConfig,a=>{if(!As(a))throw Le.create("not-registered");const o=a.authToken;if(!e&&fo(o))return a;if(o.requestStatus===1)return r=uo(t,e),a;{if(!navigator.onLine)throw Le.create("app-offline");const c=po(a);return r=ho(t,c),c}});return r?await r:s.authToken}async function uo(t,e){let r=await un(t.appConfig);for(;r.authToken.requestStatus===1;)await Ss(100),r=await un(t.appConfig);const s=r.authToken;return s.requestStatus===0?Sr(t,e):s}function un(t){return Wt(t,e=>{if(!As(e))throw Le.create("not-registered");const r=e.authToken;return go(r)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function ho(t,e){try{const r=await co(t,e),s=Object.assign(Object.assign({},e),{authToken:r});return await At(t.appConfig,s),r}catch(r){if(xs(r)&&(r.customData.serverCode===401||r.customData.serverCode===404))await ks(t.appConfig);else{const s=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await At(t.appConfig,s)}throw r}}function As(t){return t!==void 0&&t.registrationStatus===2}function fo(t){return t.requestStatus===2&&!mo(t)}function mo(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+Fa}function po(t){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},t),{authToken:e})}function go(t){return t.requestStatus===1&&t.requestTime+ms<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xo(t){const e=t,{installationEntry:r,registrationPromise:s}=await jr(e);return s?s.catch(console.error):Sr(e).catch(console.error),r.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yo(t,e=!1){const r=t;return await bo(r),(await Sr(r,e)).token}async function bo(t){const{registrationPromise:e}=await jr(t);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vo(t){if(!t||!t.options)throw Vt("App Configuration");if(!t.name)throw Vt("App Name");const e=["projectId","apiKey","appId"];for(const r of e)if(!t.options[r])throw Vt(r);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}function Vt(t){return Le.create("missing-app-config-values",{valueName:t})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ds="installations",wo="installations-internal",jo=t=>{const e=t.getProvider("app").getImmediate(),r=vo(e),s=Mt(e,"heartbeat");return{app:e,appConfig:r,heartbeatServiceProvider:s,_delete:()=>Promise.resolve()}},So=t=>{const e=t.getProvider("app").getImmediate(),r=Mt(e,Ds).getImmediate();return{getId:()=>xo(r),getToken:i=>yo(r,i)}};function _o(){kt(new It(Ds,jo,"PUBLIC")),kt(new It(wo,So,"PRIVATE"))}_o();Et(fs,vr);Et(fs,vr,"esm2017");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dt="analytics",Co="firebase_id",Eo="origin",ko=60*1e3,Io="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",_r="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ce=new ya("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ao={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},de=new Qn("analytics","Analytics",Ao);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Do(t){if(!t.startsWith(_r)){const e=de.create("invalid-gtag-resource",{gtagURL:t});return ce.warn(e.message),""}return t}function Ts(t){return Promise.all(t.map(e=>e.catch(r=>r)))}function To(t,e){let r;return window.trustedTypes&&(r=window.trustedTypes.createPolicy(t,e)),r}function Po(t,e){const r=To("firebase-js-sdk-policy",{createScriptURL:Do}),s=document.createElement("script"),i=`${_r}?l=${t}&id=${e}`;s.src=r?r==null?void 0:r.createScriptURL(i):i,s.async=!0,document.head.appendChild(s)}function Ro(t){let e=[];return Array.isArray(window[t])?e=window[t]:window[t]=e,e}async function Oo(t,e,r,s,i,a){const o=s[i];try{if(o)await e[o];else{const l=(await Ts(r)).find(d=>d.measurementId===i);l&&await e[l.appId]}}catch(c){ce.error(c)}t("config",i,a)}async function Mo(t,e,r,s,i){try{let a=[];if(i&&i.send_to){let o=i.send_to;Array.isArray(o)||(o=[o]);const c=await Ts(r);for(const l of o){const d=c.find(h=>h.measurementId===l),y=d&&e[d.appId];if(y)a.push(y);else{a=[];break}}}a.length===0&&(a=Object.values(e)),await Promise.all(a),t("event",s,i||{})}catch(a){ce.error(a)}}function Bo(t,e,r,s){async function i(a,...o){try{if(a==="event"){const[c,l]=o;await Mo(t,e,r,c,l)}else if(a==="config"){const[c,l]=o;await Oo(t,e,r,s,c,l)}else if(a==="consent"){const[c,l]=o;t("consent",c,l)}else if(a==="get"){const[c,l,d]=o;t("get",c,l,d)}else if(a==="set"){const[c]=o;t("set",c)}else t(a,...o)}catch(c){ce.error(c)}}return i}function No(t,e,r,s,i){let a=function(...o){window[s].push(arguments)};return window[i]&&typeof window[i]=="function"&&(a=window[i]),window[i]=Bo(a,t,e,r),{gtagCore:a,wrappedGtag:window[i]}}function Lo(t){const e=window.document.getElementsByTagName("script");for(const r of Object.values(e))if(r.src&&r.src.includes(_r)&&r.src.includes(t))return r;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wo=30,Fo=1e3;class $o{constructor(e={},r=Fo){this.throttleMetadata=e,this.intervalMillis=r}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,r){this.throttleMetadata[e]=r}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const Ps=new $o;function qo(t){return new Headers({Accept:"application/json","x-goog-api-key":t})}async function Uo(t){var e;const{appId:r,apiKey:s}=t,i={method:"GET",headers:qo(s)},a=Io.replace("{app-id}",r),o=await fetch(a,i);if(o.status!==200&&o.status!==304){let c="";try{const l=await o.json();!((e=l.error)===null||e===void 0)&&e.message&&(c=l.error.message)}catch{}throw de.create("config-fetch-failed",{httpStatus:o.status,responseMessage:c})}return o.json()}async function zo(t,e=Ps,r){const{appId:s,apiKey:i,measurementId:a}=t.options;if(!s)throw de.create("no-app-id");if(!i){if(a)return{measurementId:a,appId:s};throw de.create("no-api-key")}const o=e.getThrottleMetadata(s)||{backoffCount:0,throttleEndTimeMillis:Date.now()},c=new Yo;return setTimeout(async()=>{c.abort()},ko),Rs({appId:s,apiKey:i,measurementId:a},o,c,e)}async function Rs(t,{throttleEndTimeMillis:e,backoffCount:r},s,i=Ps){var a;const{appId:o,measurementId:c}=t;try{await Vo(s,e)}catch(l){if(c)return ce.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${c} provided in the "measurementId" field in the local Firebase config. [${l==null?void 0:l.message}]`),{appId:o,measurementId:c};throw l}try{const l=await Uo(t);return i.deleteThrottleMetadata(o),l}catch(l){const d=l;if(!Ho(d)){if(i.deleteThrottleMetadata(o),c)return ce.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${c} provided in the "measurementId" field in the local Firebase config. [${d==null?void 0:d.message}]`),{appId:o,measurementId:c};throw l}const y=Number((a=d==null?void 0:d.customData)===null||a===void 0?void 0:a.httpStatus)===503?cn(r,i.intervalMillis,Wo):cn(r,i.intervalMillis),h={throttleEndTimeMillis:Date.now()+y,backoffCount:r+1};return i.setThrottleMetadata(o,h),ce.debug(`Calling attemptFetch again in ${y} millis`),Rs(t,h,s,i)}}function Vo(t,e){return new Promise((r,s)=>{const i=Math.max(e-Date.now(),0),a=setTimeout(r,i);t.addEventListener(()=>{clearTimeout(a),s(de.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function Ho(t){if(!(t instanceof Jn)||!t.customData)return!1;const e=Number(t.customData.httpStatus);return e===429||e===500||e===503||e===504}class Yo{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function Go(t,e,r,s,i){if(i&&i.global){t("event",r,s);return}else{const a=await e,o=Object.assign(Object.assign({},s),{send_to:a});t("event",r,o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ko(){if(ts())try{await rs()}catch(t){return ce.warn(de.create("indexeddb-unavailable",{errorInfo:t==null?void 0:t.toString()}).message),!1}else return ce.warn(de.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function Xo(t,e,r,s,i,a,o){var c;const l=zo(t);l.then(p=>{r[p.measurementId]=p.appId,t.options.measurementId&&p.measurementId!==t.options.measurementId&&ce.warn(`The measurement ID in the local Firebase config (${t.options.measurementId}) does not match the measurement ID fetched from the server (${p.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(p=>ce.error(p)),e.push(l);const d=Ko().then(p=>{if(p)return s.getId()}),[y,h]=await Promise.all([l,d]);Lo(a)||Po(a,y.measurementId),i("js",new Date);const x=(c=o==null?void 0:o.config)!==null&&c!==void 0?c:{};return x[Eo]="firebase",x.update=!0,h!=null&&(x[Co]=h),i("config",y.measurementId,x),y.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qo{constructor(e){this.app=e}_delete(){return delete Ze[this.app.options.appId],Promise.resolve()}}let Ze={},hn=[];const fn={};let Ht="dataLayer",Jo="gtag",mn,Os,pn=!1;function Zo(){const t=[];if(es()&&t.push("This is a browser extension environment."),ss()||t.push("Cookies are not available."),t.length>0){const e=t.map((s,i)=>`(${i+1}) ${s}`).join(" "),r=de.create("invalid-analytics-context",{errorInfo:e});ce.warn(r.message)}}function ec(t,e,r){Zo();const s=t.options.appId;if(!s)throw de.create("no-app-id");if(!t.options.apiKey)if(t.options.measurementId)ce.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${t.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw de.create("no-api-key");if(Ze[s]!=null)throw de.create("already-exists",{id:s});if(!pn){Ro(Ht);const{wrappedGtag:a,gtagCore:o}=No(Ze,hn,fn,Ht,Jo);Os=a,mn=o,pn=!0}return Ze[s]=Xo(t,hn,fn,e,mn,Ht,r),new Qo(t)}function tc(t=ns()){t=Zn(t);const e=Mt(t,Dt);return e.isInitialized()?e.getImmediate():rc(t)}function rc(t,e={}){const r=Mt(t,Dt);if(r.isInitialized()){const i=r.getImmediate();if(ba(e,r.getOptions()))return i;throw de.create("already-initialized")}return r.initialize({options:e})}async function nc(){if(es()||!ss()||!ts())return!1;try{return await rs()}catch{return!1}}function sc(t,e,r,s){t=Zn(t),Go(Os,Ze[t.app.options.appId],e,r,s).catch(i=>ce.error(i))}const gn="@firebase/analytics",xn="0.10.8";function ic(){kt(new It(Dt,(e,{options:r})=>{const s=e.getProvider("app").getImmediate(),i=e.getProvider("installations-internal").getImmediate();return ec(s,i,r)},"PUBLIC")),kt(new It("analytics-internal",t,"PRIVATE")),Et(gn,xn),Et(gn,xn,"esm2017");function t(e){try{const r=e.getProvider(Dt).getImmediate();return{logEvent:(s,i,a)=>sc(r,s,i,a)}}catch(r){throw de.create("interop-component-reg-failed",{reason:r})}}}ic();const ac=t=>{const e=["apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId"];for(const r of e)if(!t[r])throw new Error(`Missing required Firebase config field: ${r}`);if(!t.authDomain.includes("."))throw new Error("Invalid authDomain format");return console.log("Firebase Project ID:",t.projectId),t},oc=ac({apiKey:"AIzaSyCpDr8QI3d4_7xStw_5agh_nHGX8Agojas",authDomain:"zero-waste-swap.firebaseapp.com",projectId:"zero-waste-swap",storageBucket:"zero-waste-swap.firebasestorage.app",messagingSenderId:"32063996385",appId:"1:32063996385:web:fcd62891f07e28826092a0",measurementId:"G-KBDTETVZ1J"}),ot=va().length?ns():wa(oc),qe=ja(ot);Sa(qe,Aa).catch(t=>{console.error("Error setting auth persistence:",t)});let Q;try{Q=_a(ot,{localCache:Ca({tabManager:Ea()}),experimentalForceLongPolling:!0,ignoreUndefinedProperties:!0}),console.log("Firestore initialized successfully")}catch(t){console.error("Error initializing Firestore:",t),Q=ka(ot)}const ct=Ia(ot);nc().then(t=>t?tc(ot):null);const Cr=b.createContext(void 0);function cc({children:t}){const[e,r]=b.useState(null),[s,i]=b.useState(!0),[a,o]=b.useState(null),[c,l]=b.useState(null);b.useEffect(()=>Da(qe,async A=>{if(r(A),A)try{const O=await A.getIdToken();l(O)}catch(O){console.error("Error getting token:",O),l(null)}else l(null);i(!1)}),[]);const m={user:e,loading:s,error:a,token:c,login:async(u,A)=>{try{o(null);const v=await(await Oa(qe,u,A)).user.getIdToken();l(v)}catch(O){let v="Грешка при влизане. Моля, опитайте отново.";switch(O.code){case"auth/user-not-found":v="Няма акаунт с този имейл";break;case"auth/wrong-password":v="Грешна парола";break;case"auth/invalid-credential":v="Грешен имейл или парола";break;case"auth/invalid-email":v="Невалиден имейл адрес";break;case"auth/too-many-requests":v="Твърде много неуспешни опити. Моля, опитайте по-късно";break;default:v=O.message||v}throw o(v),new Error(v)}},register:async(u,A,O)=>{try{o(null);const v=await Ra(qe,u,A);await is(v.user,{displayName:O});const k=await v.user.getIdToken();l(k)}catch(v){let k="Грешка при регистрация. Моля, опитайте отново.";switch(v.code){case"auth/email-already-in-use":k="Този имейл вече е регистриран";break;case"auth/invalid-email":k="Невалиден имейл адрес";break;case"auth/operation-not-allowed":k="Акаунти с имейл/парола не са разрешени";break;case"auth/weak-password":k="Паролата трябва да е поне 8 символа";break;default:k=v.message||k}throw o(k),new Error(k)}},logout:async()=>{try{o(null),await Pa(qe),l(null)}catch(u){throw o(u.message||"Грешка при излизане"),u}},clearError:()=>{o(null)},resetPassword:async u=>{try{o(null),await Ta(qe,u)}catch(A){let O="Грешка при изпращане на имейл за възстановяване на паролата.";switch(A.code){case"auth/invalid-email":O="Невалиден имейл адрес";break;case"auth/user-not-found":O="Няма акаунт с този имейл";break;default:O=A.message||O}throw o(O),new Error(O)}}};return n.jsx(Cr.Provider,{value:m,children:!s&&t})}const Ft=()=>{const t=b.useContext(Cr);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t},we=Object.create(null);we.open="0";we.close="1";we.ping="2";we.pong="3";we.message="4";we.upgrade="5";we.noop="6";const xt=Object.create(null);Object.keys(we).forEach(t=>{xt[we[t]]=t});const ir={type:"error",data:"parser error"},Ms=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Bs=typeof ArrayBuffer=="function",Ns=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,Er=({type:t,data:e},r,s)=>Ms&&e instanceof Blob?r?s(e):yn(e,s):Bs&&(e instanceof ArrayBuffer||Ns(e))?r?s(e):yn(new Blob([e]),s):s(we[t]+(e||"")),yn=(t,e)=>{const r=new FileReader;return r.onload=function(){const s=r.result.split(",")[1];e("b"+(s||""))},r.readAsDataURL(t)};function bn(t){return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}let Yt;function lc(t,e){if(Ms&&t.data instanceof Blob)return t.data.arrayBuffer().then(bn).then(e);if(Bs&&(t.data instanceof ArrayBuffer||Ns(t.data)))return e(bn(t.data));Er(t,!1,r=>{Yt||(Yt=new TextEncoder),e(Yt.encode(r))})}const vn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Je=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let t=0;t<vn.length;t++)Je[vn.charCodeAt(t)]=t;const dc=t=>{let e=t.length*.75,r=t.length,s,i=0,a,o,c,l;t[t.length-1]==="="&&(e--,t[t.length-2]==="="&&e--);const d=new ArrayBuffer(e),y=new Uint8Array(d);for(s=0;s<r;s+=4)a=Je[t.charCodeAt(s)],o=Je[t.charCodeAt(s+1)],c=Je[t.charCodeAt(s+2)],l=Je[t.charCodeAt(s+3)],y[i++]=a<<2|o>>4,y[i++]=(o&15)<<4|c>>2,y[i++]=(c&3)<<6|l&63;return d},uc=typeof ArrayBuffer=="function",kr=(t,e)=>{if(typeof t!="string")return{type:"message",data:Ls(t,e)};const r=t.charAt(0);return r==="b"?{type:"message",data:hc(t.substring(1),e)}:xt[r]?t.length>1?{type:xt[r],data:t.substring(1)}:{type:xt[r]}:ir},hc=(t,e)=>{if(uc){const r=dc(t);return Ls(r,e)}else return{base64:!0,data:t}},Ls=(t,e)=>{switch(e){case"blob":return t instanceof Blob?t:new Blob([t]);case"arraybuffer":default:return t instanceof ArrayBuffer?t:t.buffer}},Ws="",fc=(t,e)=>{const r=t.length,s=new Array(r);let i=0;t.forEach((a,o)=>{Er(a,!1,c=>{s[o]=c,++i===r&&e(s.join(Ws))})})},mc=(t,e)=>{const r=t.split(Ws),s=[];for(let i=0;i<r.length;i++){const a=kr(r[i],e);if(s.push(a),a.type==="error")break}return s};function pc(){return new TransformStream({transform(t,e){lc(t,r=>{const s=r.length;let i;if(s<126)i=new Uint8Array(1),new DataView(i.buffer).setUint8(0,s);else if(s<65536){i=new Uint8Array(3);const a=new DataView(i.buffer);a.setUint8(0,126),a.setUint16(1,s)}else{i=new Uint8Array(9);const a=new DataView(i.buffer);a.setUint8(0,127),a.setBigUint64(1,BigInt(s))}t.data&&typeof t.data!="string"&&(i[0]|=128),e.enqueue(i),e.enqueue(r)})}})}let Gt;function mt(t){return t.reduce((e,r)=>e+r.length,0)}function pt(t,e){if(t[0].length===e)return t.shift();const r=new Uint8Array(e);let s=0;for(let i=0;i<e;i++)r[i]=t[0][s++],s===t[0].length&&(t.shift(),s=0);return t.length&&s<t[0].length&&(t[0]=t[0].slice(s)),r}function gc(t,e){Gt||(Gt=new TextDecoder);const r=[];let s=0,i=-1,a=!1;return new TransformStream({transform(o,c){for(r.push(o);;){if(s===0){if(mt(r)<1)break;const l=pt(r,1);a=(l[0]&128)===128,i=l[0]&127,i<126?s=3:i===126?s=1:s=2}else if(s===1){if(mt(r)<2)break;const l=pt(r,2);i=new DataView(l.buffer,l.byteOffset,l.length).getUint16(0),s=3}else if(s===2){if(mt(r)<8)break;const l=pt(r,8),d=new DataView(l.buffer,l.byteOffset,l.length),y=d.getUint32(0);if(y>Math.pow(2,21)-1){c.enqueue(ir);break}i=y*Math.pow(2,32)+d.getUint32(4),s=3}else{if(mt(r)<i)break;const l=pt(r,i);c.enqueue(kr(a?l:Gt.decode(l),e)),s=0}if(i===0||i>t){c.enqueue(ir);break}}}})}const Fs=4;function ne(t){if(t)return xc(t)}function xc(t){for(var e in ne.prototype)t[e]=ne.prototype[e];return t}ne.prototype.on=ne.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this};ne.prototype.once=function(t,e){function r(){this.off(t,r),e.apply(this,arguments)}return r.fn=e,this.on(t,r),this};ne.prototype.off=ne.prototype.removeListener=ne.prototype.removeAllListeners=ne.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var r=this._callbacks["$"+t];if(!r)return this;if(arguments.length==1)return delete this._callbacks["$"+t],this;for(var s,i=0;i<r.length;i++)if(s=r[i],s===e||s.fn===e){r.splice(i,1);break}return r.length===0&&delete this._callbacks["$"+t],this};ne.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),r=this._callbacks["$"+t],s=1;s<arguments.length;s++)e[s-1]=arguments[s];if(r){r=r.slice(0);for(var s=0,i=r.length;s<i;++s)r[s].apply(this,e)}return this};ne.prototype.emitReserved=ne.prototype.emit;ne.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]};ne.prototype.hasListeners=function(t){return!!this.listeners(t).length};const $t=typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,r)=>r(e,0),ue=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),yc="arraybuffer";function $s(t,...e){return e.reduce((r,s)=>(t.hasOwnProperty(s)&&(r[s]=t[s]),r),{})}const bc=ue.setTimeout,vc=ue.clearTimeout;function qt(t,e){e.useNativeTimers?(t.setTimeoutFn=bc.bind(ue),t.clearTimeoutFn=vc.bind(ue)):(t.setTimeoutFn=ue.setTimeout.bind(ue),t.clearTimeoutFn=ue.clearTimeout.bind(ue))}const wc=1.33;function jc(t){return typeof t=="string"?Sc(t):Math.ceil((t.byteLength||t.size)*wc)}function Sc(t){let e=0,r=0;for(let s=0,i=t.length;s<i;s++)e=t.charCodeAt(s),e<128?r+=1:e<2048?r+=2:e<55296||e>=57344?r+=3:(s++,r+=4);return r}function qs(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function _c(t){let e="";for(let r in t)t.hasOwnProperty(r)&&(e.length&&(e+="&"),e+=encodeURIComponent(r)+"="+encodeURIComponent(t[r]));return e}function Cc(t){let e={},r=t.split("&");for(let s=0,i=r.length;s<i;s++){let a=r[s].split("=");e[decodeURIComponent(a[0])]=decodeURIComponent(a[1])}return e}class Ec extends Error{constructor(e,r,s){super(e),this.description=r,this.context=s,this.type="TransportError"}}class Ir extends ne{constructor(e){super(),this.writable=!1,qt(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,r,s){return super.emitReserved("error",new Ec(e,r,s)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const r=kr(e,this.socket.binaryType);this.onPacket(r)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,r={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(r)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const r=_c(e);return r.length?"?"+r:""}}class kc extends Ir{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const r=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let s=0;this._polling&&(s++,this.once("pollComplete",function(){--s||r()})),this.writable||(s++,this.once("drain",function(){--s||r()}))}else r()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const r=s=>{if(this.readyState==="opening"&&s.type==="open"&&this.onOpen(),s.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(s)};mc(e,this.socket.binaryType).forEach(r),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,fc(e,r=>{this.doWrite(r,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",r=this.query||{};return this.opts.timestampRequests!==!1&&(r[this.opts.timestampParam]=qs()),!this.supportsBinary&&!r.sid&&(r.b64=1),this.createUri(e,r)}}let Us=!1;try{Us=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Ic=Us;function Ac(){}class Dc extends kc{constructor(e){if(super(e),typeof location<"u"){const r=location.protocol==="https:";let s=location.port;s||(s=r?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||s!==e.port}}doWrite(e,r){const s=this.request({method:"POST",data:e});s.on("success",r),s.on("error",(i,a)=>{this.onError("xhr post error",i,a)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(r,s)=>{this.onError("xhr poll error",r,s)}),this.pollXhr=e}}class ve extends ne{constructor(e,r,s){super(),this.createRequest=e,qt(this,s),this._opts=s,this._method=s.method||"GET",this._uri=r,this._data=s.data!==void 0?s.data:null,this._create()}_create(){var e;const r=$s(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");r.xdomain=!!this._opts.xd;const s=this._xhr=this.createRequest(r);try{s.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){s.setDisableHeaderCheck&&s.setDisableHeaderCheck(!0);for(let i in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(i)&&s.setRequestHeader(i,this._opts.extraHeaders[i])}}catch{}if(this._method==="POST")try{s.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{s.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(s),"withCredentials"in s&&(s.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(s.timeout=this._opts.requestTimeout),s.onreadystatechange=()=>{var i;s.readyState===3&&((i=this._opts.cookieJar)===null||i===void 0||i.parseCookies(s.getResponseHeader("set-cookie"))),s.readyState===4&&(s.status===200||s.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof s.status=="number"?s.status:0)},0))},s.send(this._data)}catch(i){this.setTimeoutFn(()=>{this._onError(i)},0);return}typeof document<"u"&&(this._index=ve.requestsCount++,ve.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=Ac,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete ve.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}ve.requestsCount=0;ve.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",wn);else if(typeof addEventListener=="function"){const t="onpagehide"in ue?"pagehide":"unload";addEventListener(t,wn,!1)}}function wn(){for(let t in ve.requests)ve.requests.hasOwnProperty(t)&&ve.requests[t].abort()}const Tc=function(){const t=zs({xdomain:!1});return t&&t.responseType!==null}();class Pc extends Dc{constructor(e){super(e);const r=e&&e.forceBase64;this.supportsBinary=Tc&&!r}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new ve(zs,this.uri(),e)}}function zs(t){const e=t.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||Ic))return new XMLHttpRequest}catch{}if(!e)try{return new ue[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const Vs=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class Rc extends Ir{get name(){return"websocket"}doOpen(){const e=this.uri(),r=this.opts.protocols,s=Vs?{}:$s(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(s.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,r,s)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let r=0;r<e.length;r++){const s=e[r],i=r===e.length-1;Er(s,this.supportsBinary,a=>{try{this.doWrite(s,a)}catch{}i&&$t(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",r=this.query||{};return this.opts.timestampRequests&&(r[this.opts.timestampParam]=qs()),this.supportsBinary||(r.b64=1),this.createUri(e,r)}}const Kt=ue.WebSocket||ue.MozWebSocket;class Oc extends Rc{createSocket(e,r,s){return Vs?new Kt(e,r,s):r?new Kt(e,r):new Kt(e)}doWrite(e,r){this.ws.send(r)}}class Mc extends Ir{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const r=gc(Number.MAX_SAFE_INTEGER,this.socket.binaryType),s=e.readable.pipeThrough(r).getReader(),i=pc();i.readable.pipeTo(e.writable),this._writer=i.writable.getWriter();const a=()=>{s.read().then(({done:c,value:l})=>{c||(this.onPacket(l),a())}).catch(c=>{})};a();const o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this._writer.write(o).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let r=0;r<e.length;r++){const s=e[r],i=r===e.length-1;this._writer.write(s).then(()=>{i&&$t(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}}const Bc={websocket:Oc,webtransport:Mc,polling:Pc},Nc=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Lc=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function ar(t){if(t.length>8e3)throw"URI too long";const e=t,r=t.indexOf("["),s=t.indexOf("]");r!=-1&&s!=-1&&(t=t.substring(0,r)+t.substring(r,s).replace(/:/g,";")+t.substring(s,t.length));let i=Nc.exec(t||""),a={},o=14;for(;o--;)a[Lc[o]]=i[o]||"";return r!=-1&&s!=-1&&(a.source=e,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a.pathNames=Wc(a,a.path),a.queryKey=Fc(a,a.query),a}function Wc(t,e){const r=/\/{2,9}/g,s=e.replace(r,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&s.splice(0,1),e.slice(-1)=="/"&&s.splice(s.length-1,1),s}function Fc(t,e){const r={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(s,i,a){i&&(r[i]=a)}),r}const or=typeof addEventListener=="function"&&typeof removeEventListener=="function",yt=[];or&&addEventListener("offline",()=>{yt.forEach(t=>t())},!1);class Ie extends ne{constructor(e,r){if(super(),this.binaryType=yc,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(r=e,e=null),e){const s=ar(e);r.hostname=s.host,r.secure=s.protocol==="https"||s.protocol==="wss",r.port=s.port,s.query&&(r.query=s.query)}else r.host&&(r.hostname=ar(r.host).host);qt(this,r),this.secure=r.secure!=null?r.secure:typeof location<"u"&&location.protocol==="https:",r.hostname&&!r.port&&(r.port=this.secure?"443":"80"),this.hostname=r.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=r.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},r.transports.forEach(s=>{const i=s.prototype.name;this.transports.push(i),this._transportsByName[i]=s}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},r),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Cc(this.opts.query)),or&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},yt.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const r=Object.assign({},this.opts.query);r.EIO=Fs,r.transport=e,this.id&&(r.sid=this.id);const s=Object.assign({},this.opts,{query:r,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](s)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const e=this.opts.rememberUpgrade&&Ie.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const r=this.createTransport(e);r.open(),this.setTransport(r)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",r=>this._onClose("transport close",r))}onOpen(){this.readyState="open",Ie.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const r=new Error("server error");r.code=e.data,this._onError(r);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let r=1;for(let s=0;s<this.writeBuffer.length;s++){const i=this.writeBuffer[s].data;if(i&&(r+=jc(i)),s>0&&r>this._maxPayload)return this.writeBuffer.slice(0,s);r+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,$t(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,r,s){return this._sendPacket("message",e,r,s),this}send(e,r,s){return this._sendPacket("message",e,r,s),this}_sendPacket(e,r,s,i){if(typeof r=="function"&&(i=r,r=void 0),typeof s=="function"&&(i=s,s=null),this.readyState==="closing"||this.readyState==="closed")return;s=s||{},s.compress=s.compress!==!1;const a={type:e,data:r,options:s};this.emitReserved("packetCreate",a),this.writeBuffer.push(a),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},r=()=>{this.off("upgrade",r),this.off("upgradeError",r),e()},s=()=>{this.once("upgrade",r),this.once("upgradeError",r)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?s():e()}):this.upgrading?s():e()),this}_onError(e){if(Ie.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,r){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),or&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const s=yt.indexOf(this._offlineEventListener);s!==-1&&yt.splice(s,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,r),this.writeBuffer=[],this._prevBufferLen=0}}}Ie.protocol=Fs;class $c extends Ie{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let r=this.createTransport(e),s=!1;Ie.priorWebsocketSuccess=!1;const i=()=>{s||(r.send([{type:"ping",data:"probe"}]),r.once("packet",h=>{if(!s)if(h.type==="pong"&&h.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",r),!r)return;Ie.priorWebsocketSuccess=r.name==="websocket",this.transport.pause(()=>{s||this.readyState!=="closed"&&(y(),this.setTransport(r),r.send([{type:"upgrade"}]),this.emitReserved("upgrade",r),r=null,this.upgrading=!1,this.flush())})}else{const x=new Error("probe error");x.transport=r.name,this.emitReserved("upgradeError",x)}}))};function a(){s||(s=!0,y(),r.close(),r=null)}const o=h=>{const x=new Error("probe error: "+h);x.transport=r.name,a(),this.emitReserved("upgradeError",x)};function c(){o("transport closed")}function l(){o("socket closed")}function d(h){r&&h.name!==r.name&&a()}const y=()=>{r.removeListener("open",i),r.removeListener("error",o),r.removeListener("close",c),this.off("close",l),this.off("upgrading",d)};r.once("open",i),r.once("error",o),r.once("close",c),this.once("close",l),this.once("upgrading",d),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{s||r.open()},200):r.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const r=[];for(let s=0;s<e.length;s++)~this.transports.indexOf(e[s])&&r.push(e[s]);return r}}let qc=class extends $c{constructor(e,r={}){const s=typeof e=="object"?e:r;(!s.transports||s.transports&&typeof s.transports[0]=="string")&&(s.transports=(s.transports||["polling","websocket","webtransport"]).map(i=>Bc[i]).filter(i=>!!i)),super(e,s)}};function Uc(t,e="",r){let s=t;r=r||typeof location<"u"&&location,t==null&&(t=r.protocol+"//"+r.host),typeof t=="string"&&(t.charAt(0)==="/"&&(t.charAt(1)==="/"?t=r.protocol+t:t=r.host+t),/^(https?|wss?):\/\//.test(t)||(typeof r<"u"?t=r.protocol+"//"+t:t="https://"+t),s=ar(t)),s.port||(/^(http|ws)$/.test(s.protocol)?s.port="80":/^(http|ws)s$/.test(s.protocol)&&(s.port="443")),s.path=s.path||"/";const a=s.host.indexOf(":")!==-1?"["+s.host+"]":s.host;return s.id=s.protocol+"://"+a+":"+s.port+e,s.href=s.protocol+"://"+a+(r&&r.port===s.port?"":":"+s.port),s}const zc=typeof ArrayBuffer=="function",Vc=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,Hs=Object.prototype.toString,Hc=typeof Blob=="function"||typeof Blob<"u"&&Hs.call(Blob)==="[object BlobConstructor]",Yc=typeof File=="function"||typeof File<"u"&&Hs.call(File)==="[object FileConstructor]";function Ar(t){return zc&&(t instanceof ArrayBuffer||Vc(t))||Hc&&t instanceof Blob||Yc&&t instanceof File}function bt(t,e){if(!t||typeof t!="object")return!1;if(Array.isArray(t)){for(let r=0,s=t.length;r<s;r++)if(bt(t[r]))return!0;return!1}if(Ar(t))return!0;if(t.toJSON&&typeof t.toJSON=="function"&&arguments.length===1)return bt(t.toJSON(),!0);for(const r in t)if(Object.prototype.hasOwnProperty.call(t,r)&&bt(t[r]))return!0;return!1}function Gc(t){const e=[],r=t.data,s=t;return s.data=cr(r,e),s.attachments=e.length,{packet:s,buffers:e}}function cr(t,e){if(!t)return t;if(Ar(t)){const r={_placeholder:!0,num:e.length};return e.push(t),r}else if(Array.isArray(t)){const r=new Array(t.length);for(let s=0;s<t.length;s++)r[s]=cr(t[s],e);return r}else if(typeof t=="object"&&!(t instanceof Date)){const r={};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(r[s]=cr(t[s],e));return r}return t}function Kc(t,e){return t.data=lr(t.data,e),delete t.attachments,t}function lr(t,e){if(!t)return t;if(t&&t._placeholder===!0){if(typeof t.num=="number"&&t.num>=0&&t.num<e.length)return e[t.num];throw new Error("illegal attachments")}else if(Array.isArray(t))for(let r=0;r<t.length;r++)t[r]=lr(t[r],e);else if(typeof t=="object")for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(t[r]=lr(t[r],e));return t}const Xc=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Qc=5;var F;(function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"})(F||(F={}));class Jc{constructor(e){this.replacer=e}encode(e){return(e.type===F.EVENT||e.type===F.ACK)&&bt(e)?this.encodeAsBinary({type:e.type===F.EVENT?F.BINARY_EVENT:F.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let r=""+e.type;return(e.type===F.BINARY_EVENT||e.type===F.BINARY_ACK)&&(r+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(r+=e.nsp+","),e.id!=null&&(r+=e.id),e.data!=null&&(r+=JSON.stringify(e.data,this.replacer)),r}encodeAsBinary(e){const r=Gc(e),s=this.encodeAsString(r.packet),i=r.buffers;return i.unshift(s),i}}function jn(t){return Object.prototype.toString.call(t)==="[object Object]"}class Dr extends ne{constructor(e){super(),this.reviver=e}add(e){let r;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");r=this.decodeString(e);const s=r.type===F.BINARY_EVENT;s||r.type===F.BINARY_ACK?(r.type=s?F.EVENT:F.ACK,this.reconstructor=new Zc(r),r.attachments===0&&super.emitReserved("decoded",r)):super.emitReserved("decoded",r)}else if(Ar(e)||e.base64)if(this.reconstructor)r=this.reconstructor.takeBinaryData(e),r&&(this.reconstructor=null,super.emitReserved("decoded",r));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let r=0;const s={type:Number(e.charAt(0))};if(F[s.type]===void 0)throw new Error("unknown packet type "+s.type);if(s.type===F.BINARY_EVENT||s.type===F.BINARY_ACK){const a=r+1;for(;e.charAt(++r)!=="-"&&r!=e.length;);const o=e.substring(a,r);if(o!=Number(o)||e.charAt(r)!=="-")throw new Error("Illegal attachments");s.attachments=Number(o)}if(e.charAt(r+1)==="/"){const a=r+1;for(;++r&&!(e.charAt(r)===","||r===e.length););s.nsp=e.substring(a,r)}else s.nsp="/";const i=e.charAt(r+1);if(i!==""&&Number(i)==i){const a=r+1;for(;++r;){const o=e.charAt(r);if(o==null||Number(o)!=o){--r;break}if(r===e.length)break}s.id=Number(e.substring(a,r+1))}if(e.charAt(++r)){const a=this.tryParse(e.substr(r));if(Dr.isPayloadValid(s.type,a))s.data=a;else throw new Error("invalid payload")}return s}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,r){switch(e){case F.CONNECT:return jn(r);case F.DISCONNECT:return r===void 0;case F.CONNECT_ERROR:return typeof r=="string"||jn(r);case F.EVENT:case F.BINARY_EVENT:return Array.isArray(r)&&(typeof r[0]=="number"||typeof r[0]=="string"&&Xc.indexOf(r[0])===-1);case F.ACK:case F.BINARY_ACK:return Array.isArray(r)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Zc{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const r=Kc(this.reconPack,this.buffers);return this.finishedReconstruction(),r}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const el=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Dr,Encoder:Jc,get PacketType(){return F},protocol:Qc},Symbol.toStringTag,{value:"Module"}));function pe(t,e,r){return t.on(e,r),function(){t.off(e,r)}}const tl=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Ys extends ne{constructor(e,r,s){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=r,s&&s.auth&&(this.auth=s.auth),this._opts=Object.assign({},s),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[pe(e,"open",this.onopen.bind(this)),pe(e,"packet",this.onpacket.bind(this)),pe(e,"error",this.onerror.bind(this)),pe(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...r){var s,i,a;if(tl.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(r.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(r),this;const o={type:F.EVENT,data:r};if(o.options={},o.options.compress=this.flags.compress!==!1,typeof r[r.length-1]=="function"){const y=this.ids++,h=r.pop();this._registerAckCallback(y,h),o.id=y}const c=(i=(s=this.io.engine)===null||s===void 0?void 0:s.transport)===null||i===void 0?void 0:i.writable,l=this.connected&&!(!((a=this.io.engine)===null||a===void 0)&&a._hasPingExpired());return this.flags.volatile&&!c||(l?(this.notifyOutgoingListeners(o),this.packet(o)):this.sendBuffer.push(o)),this.flags={},this}_registerAckCallback(e,r){var s;const i=(s=this.flags.timeout)!==null&&s!==void 0?s:this._opts.ackTimeout;if(i===void 0){this.acks[e]=r;return}const a=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let c=0;c<this.sendBuffer.length;c++)this.sendBuffer[c].id===e&&this.sendBuffer.splice(c,1);r.call(this,new Error("operation has timed out"))},i),o=(...c)=>{this.io.clearTimeoutFn(a),r.apply(this,c)};o.withError=!0,this.acks[e]=o}emitWithAck(e,...r){return new Promise((s,i)=>{const a=(o,c)=>o?i(o):s(c);a.withError=!0,r.push(a),this.emit(e,...r)})}_addToQueue(e){let r;typeof e[e.length-1]=="function"&&(r=e.pop());const s={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((i,...a)=>s!==this._queue[0]?void 0:(i!==null?s.tryCount>this._opts.retries&&(this._queue.shift(),r&&r(i)):(this._queue.shift(),r&&r(null,...a)),s.pending=!1,this._drainQueue())),this._queue.push(s),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const r=this._queue[0];r.pending&&!e||(r.pending=!0,r.tryCount++,this.flags=r.flags,this.emit.apply(this,r.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:F.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,r){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,r),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(s=>String(s.id)===e)){const s=this.acks[e];delete this.acks[e],s.withError&&s.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case F.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case F.EVENT:case F.BINARY_EVENT:this.onevent(e);break;case F.ACK:case F.BINARY_ACK:this.onack(e);break;case F.DISCONNECT:this.ondisconnect();break;case F.CONNECT_ERROR:this.destroy();const s=new Error(e.data.message);s.data=e.data.data,this.emitReserved("connect_error",s);break}}onevent(e){const r=e.data||[];e.id!=null&&r.push(this.ack(e.id)),this.connected?this.emitEvent(r):this.receiveBuffer.push(Object.freeze(r))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const r=this._anyListeners.slice();for(const s of r)s.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const r=this;let s=!1;return function(...i){s||(s=!0,r.packet({type:F.ACK,id:e,data:i}))}}onack(e){const r=this.acks[e.id];typeof r=="function"&&(delete this.acks[e.id],r.withError&&e.data.unshift(null),r.apply(this,e.data))}onconnect(e,r){this.id=e,this.recovered=r&&this._pid===r,this._pid=r,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:F.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const r=this._anyListeners;for(let s=0;s<r.length;s++)if(e===r[s])return r.splice(s,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const r=this._anyOutgoingListeners;for(let s=0;s<r.length;s++)if(e===r[s])return r.splice(s,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const r=this._anyOutgoingListeners.slice();for(const s of r)s.apply(this,e.data)}}}function Ve(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}Ve.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),r=Math.floor(e*this.jitter*t);t=Math.floor(e*10)&1?t+r:t-r}return Math.min(t,this.max)|0};Ve.prototype.reset=function(){this.attempts=0};Ve.prototype.setMin=function(t){this.ms=t};Ve.prototype.setMax=function(t){this.max=t};Ve.prototype.setJitter=function(t){this.jitter=t};class dr extends ne{constructor(e,r){var s;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(r=e,e=void 0),r=r||{},r.path=r.path||"/socket.io",this.opts=r,qt(this,r),this.reconnection(r.reconnection!==!1),this.reconnectionAttempts(r.reconnectionAttempts||1/0),this.reconnectionDelay(r.reconnectionDelay||1e3),this.reconnectionDelayMax(r.reconnectionDelayMax||5e3),this.randomizationFactor((s=r.randomizationFactor)!==null&&s!==void 0?s:.5),this.backoff=new Ve({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(r.timeout==null?2e4:r.timeout),this._readyState="closed",this.uri=e;const i=r.parser||el;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=r.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var r;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(r=this.backoff)===null||r===void 0||r.setMin(e),this)}randomizationFactor(e){var r;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(r=this.backoff)===null||r===void 0||r.setJitter(e),this)}reconnectionDelayMax(e){var r;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(r=this.backoff)===null||r===void 0||r.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new qc(this.uri,this.opts);const r=this.engine,s=this;this._readyState="opening",this.skipReconnect=!1;const i=pe(r,"open",function(){s.onopen(),e&&e()}),a=c=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",c),e?e(c):this.maybeReconnectOnOpen()},o=pe(r,"error",a);if(this._timeout!==!1){const c=this._timeout,l=this.setTimeoutFn(()=>{i(),a(new Error("timeout")),r.close()},c);this.opts.autoUnref&&l.unref(),this.subs.push(()=>{this.clearTimeoutFn(l)})}return this.subs.push(i),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(pe(e,"ping",this.onping.bind(this)),pe(e,"data",this.ondata.bind(this)),pe(e,"error",this.onerror.bind(this)),pe(e,"close",this.onclose.bind(this)),pe(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(r){this.onclose("parse error",r)}}ondecoded(e){$t(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,r){let s=this.nsps[e];return s?this._autoConnect&&!s.active&&s.connect():(s=new Ys(this,e,r),this.nsps[e]=s),s}_destroy(e){const r=Object.keys(this.nsps);for(const s of r)if(this.nsps[s].active)return;this._close()}_packet(e){const r=this.encoder.encode(e);for(let s=0;s<r.length;s++)this.engine.write(r[s],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,r){var s;this.cleanup(),(s=this.engine)===null||s===void 0||s.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,r),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const r=this.backoff.duration();this._reconnecting=!0;const s=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(i=>{i?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",i)):e.onreconnect()}))},r);this.opts.autoUnref&&s.unref(),this.subs.push(()=>{this.clearTimeoutFn(s)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const Ke={};function vt(t,e){typeof t=="object"&&(e=t,t=void 0),e=e||{};const r=Uc(t,e.path||"/socket.io"),s=r.source,i=r.id,a=r.path,o=Ke[i]&&a in Ke[i].nsps,c=e.forceNew||e["force new connection"]||e.multiplex===!1||o;let l;return c?l=new dr(s,e):(Ke[i]||(Ke[i]=new dr(s,e)),l=Ke[i]),r.query&&!e.query&&(e.query=r.queryKey),l.socket(r.path,e)}Object.assign(vt,{Manager:dr,Socket:Ys,io:vt,connect:vt});var rl={VITE_API_URL:"http://localhost:5000"};const Gs=b.createContext(void 0),nl=({children:t})=>{const{user:e,token:r}=Ft(),s=b.useRef(null),[i,a]=b.useState([]),[o,c]=b.useState(null),[l,d]=b.useState([]),[y,h]=b.useState(!1),[x,p]=b.useState(null),[m,u]=b.useState({}),A=rl.VITE_API_URL;b.useEffect(()=>{if(!r||!e)return;(async()=>{try{const C=await e.getIdToken(!0),E=vt(A,{auth:{token:C},transports:["websocket","polling"],reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e3,reconnectionDelayMax:5e3,timeout:3e4,forceNew:!0,autoConnect:!0});return E.on("connect",()=>{console.log("Socket connected successfully"),p(null)}),E.on("connect_error",async w=>{if(console.error("Socket connection error:",w),w.message.includes("id-token-expired"))try{const B=await e.getIdToken(!0);E.auth={token:B},E.connect()}catch(B){console.error("Error refreshing token:",B),p("Failed to refresh authentication. Please log in again.")}else p("Failed to connect to chat server. Retrying..."),setTimeout(()=>{E.disconnected&&(console.log("Attempting to reconnect..."),E.connect())},5e3)}),E.on("disconnect",w=>{console.log("Socket disconnected:",w),(w==="io server disconnect"||w==="io client disconnect")&&E.connect()}),E.on("error",w=>{console.error("Socket error:",w),p("Chat server error. Attempting to reconnect...")}),E.on("reconnect",w=>{console.log("Socket reconnected after",w,"attempts"),p(null)}),E.on("reconnect_error",w=>{console.error("Socket reconnection error:",w),p("Failed to reconnect to chat server")}),E.on("reconnect_failed",()=>{console.error("Socket reconnection failed"),p("Unable to reconnect to chat server. Please refresh the page.")}),s.current=E,()=>{E.connected&&E.disconnect(),s.current=null}}catch(C){console.error("Error initializing socket:",C),p("Failed to initialize chat connection")}})()},[r,e,A]);const O=Object.values(m).reduce((I,C)=>{const E=Number(C);return I+(isNaN(E)?0:E)},0),v=b.useCallback(async()=>{if(!(!r||!e))try{const I=await fetch(`${A}/api/chats/unread`,{headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},credentials:"include"});if(!I.ok){const w=await I.text();throw console.error("Failed to fetch unread counts:",{status:I.status,statusText:I.statusText,errorText:w}),new Error(`Failed to fetch unread counts: ${I.status} ${I.statusText}`)}const C=await I.json();if(!Array.isArray(C))throw console.error("Invalid response format for unread counts:",C),new Error("Invalid response format for unread counts");const E=C.reduce((w,B)=>{const S=Number(B.unreadCount);return w[B.chatId]=isNaN(S)?0:S,w},{});u(E)}catch(I){console.error("Error fetching unread counts:",I),u({}),p("Failed to fetch unread counts")}},[r,e,A]),k=b.useCallback(async()=>{if(!(!r||!e)){h(!0);try{const I=await e.getIdToken(!0);console.log("Fetching chats with token:",I.substring(0,10)+"...");const C=await fetch(`${A}/api/chats`,{headers:{Authorization:`Bearer ${I}`,"Content-Type":"application/json"},credentials:"include"});if(!C.ok){const B=await C.text();throw console.error("Failed to fetch chats:",{status:C.status,statusText:C.statusText,errorText:B}),new Error(`Failed to fetch chats: ${C.status} ${C.statusText}`)}const E=await C.json();if(!Array.isArray(E))throw console.error("Invalid response format for chats:",E),new Error("Invalid response format for chats");console.log("Chats fetched:",{count:E.length,currentUser:{uid:e.uid,email:e.email},firstChat:E[0]?{_id:E[0]._id,participants:E[0].participants.map(B=>({uid:B.uid,username:B.username,email:B.email,displayName:B.displayName}))}:null});const w=E.map(B=>({...B,participants:B.participants.map(S=>({uid:S.uid,username:S.username,email:S.email,displayName:S.displayName,photoURL:S.photoURL}))}));a(w),p(null)}catch(I){console.error("Error fetching chats:",I),a([]),p("Failed to fetch chats")}finally{h(!1)}}},[r,e,A]),R=b.useCallback(async I=>{if(!(!r||!e)){h(!0);try{const C=await fetch(`${A}/api/chats/${I}`,{headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}});if(!C.ok)throw new Error("Failed to fetch messages");const E=await C.json();d(E)}catch(C){console.error("Error fetching messages:",C),d([])}finally{h(!1)}}},[r,e,A]),T=b.useCallback(async I=>{if(c(I),I!=null&&I._id){try{const C=await fetch(`${A}/api/chats/${I._id}/read`,{method:"PUT",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}});if(C.ok){const{unreadCount:E}=await C.json();u(w=>({...w,[I._id]:E}))}}catch(C){console.error("Error marking messages as read:",C)}R(I._id)}else d([])},[R,r,A]),N=async(I,C)=>{if(!r||!e)throw new Error("Not authenticated");try{const E=await fetch(`${A}/api/chats/${I}/messages`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({text:C})});if(!E.ok)throw new Error("Failed to send message");const w=await E.json();d(B=>[...B,w]),await v()}catch(E){throw console.error("Error sending message:",E),E}},$=async I=>{if(!r||!e)throw new Error("Not authenticated");try{const C=await fetch(`${A}/api/chats`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({participantId:I})});if(!C.ok)throw new Error("Failed to start chat");const E=await C.json();return a(w=>w.some(S=>S._id===E._id)?w:[...w,E]),c(E),E}catch(C){throw console.error("Error starting chat:",C),C}};b.useEffect(()=>{r&&e&&(k(),v())},[r,e,k,v]);const D={chats:i,currentChat:o,messages:l,loading:y,error:x,unreadCounts:m,unreadCount:O,setCurrentChat:T,sendMessage:N,startChat:$,refreshUnreadCounts:v,fetchChats:k,socket:s.current};return n.jsx(Gs.Provider,{value:D,children:t})},dt=()=>{const t=b.useContext(Gs);if(t===void 0)throw new Error("useChat must be used within a ChatProvider");return t},sl=Ui({palette:{primary:{main:"#2E7D32",light:"#4CAF50",dark:"#1B5E20",contrastText:"#ffffff"},secondary:{main:"#FFA000",light:"#FFB74D",dark:"#F57C00",contrastText:"#000000"},background:{default:"#F5F7FA",paper:"#FFFFFF"},text:{primary:"#2C3E50",secondary:"#546E7A"},error:{main:"#D32F2F",light:"#EF5350",dark:"#C62828"},success:{main:"#2E7D32",light:"#4CAF50",dark:"#1B5E20"}},typography:{fontFamily:'"Poppins", "Roboto", "Helvetica", "Arial", sans-serif',h1:{fontSize:"2.5rem",fontWeight:600,lineHeight:1.2},h2:{fontSize:"2rem",fontWeight:600,lineHeight:1.3},h3:{fontSize:"1.75rem",fontWeight:600,lineHeight:1.4},h4:{fontSize:"1.5rem",fontWeight:500,lineHeight:1.4},h5:{fontSize:"1.25rem",fontWeight:500,lineHeight:1.4},h6:{fontSize:"1rem",fontWeight:500,lineHeight:1.4},body1:{fontSize:"1rem",lineHeight:1.5},body2:{fontSize:"0.875rem",lineHeight:1.5},button:{textTransform:"none",fontWeight:500}},shape:{borderRadius:8},components:{MuiButton:{styleOverrides:{root:{borderRadius:8,padding:"8px 16px",fontSize:"0.875rem"},contained:{boxShadow:"none","&:hover":{boxShadow:"0px 2px 4px rgba(0,0,0,0.1)"}}}},MuiCard:{styleOverrides:{root:{borderRadius:12,boxShadow:"0px 4px 20px rgba(0,0,0,0.05)",transition:"transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out","&:hover":{transform:"translateY(-4px)",boxShadow:"0px 8px 24px rgba(0,0,0,0.1)"}}}},MuiTextField:{styleOverrides:{root:{"& .MuiOutlinedInput-root":{borderRadius:8}}}},MuiAppBar:{styleOverrides:{root:{boxShadow:"0px 2px 8px rgba(0,0,0,0.1)",background:"rgba(255,255,255,0.9)",backdropFilter:"blur(8px)",color:"#2C3E50",borderBottom:"1px solid rgba(0,0,0,0.05)"}}}}});var Tr={},Xt={};const il=ua(zi);var Sn;function Z(){return Sn||(Sn=1,function(t){"use client";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return e.createSvgIcon}});var e=il}(Xt)),Xt}var al=J;Object.defineProperty(Tr,"__esModule",{value:!0});var Ks=Tr.default=void 0,ol=al(Z()),cl=n;Ks=Tr.default=(0,ol.default)((0,cl.jsx)("path",{d:"m12 21.35-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54z"}),"Favorite");var Pr={},ll=J;Object.defineProperty(Pr,"__esModule",{value:!0});var Xs=Pr.default=void 0,dl=ll(Z()),ul=n;Xs=Pr.default=(0,dl.default)((0,ul.jsx)("path",{d:"M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3m-4.4 15.55-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05"}),"FavoriteBorder");var Rr={},hl=J;Object.defineProperty(Rr,"__esModule",{value:!0});var Or=Rr.default=void 0,fl=hl(Z()),ml=n;Or=Rr.default=(0,fl.default)((0,ml.jsx)("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7m0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5"}),"LocationOn");var Mr={},pl=J;Object.defineProperty(Mr,"__esModule",{value:!0});var Qs=Mr.default=void 0,gl=pl(Z()),xl=n;Qs=Mr.default=(0,gl.default)((0,xl.jsx)("path",{d:"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2M6 9h12v2H6zm8 5H6v-2h8zm4-6H6V6h12z"}),"Chat");const yl="https://images.unsplash.com/photo-1517245386807-bb43f82c33c4?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80",Js="https://images.unsplash.com/photo-1518843875459-f738682238a6?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2042&q=80",Zs="https://images.unsplash.com/photo-1555529669-e69e7aa0ba9a?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80",bl="https://jungleculture.eco/cdn/shop/files/SQUARE-Bamboo-Cutlery-Set_1_d599e041-8557-4a55-9a54-7067752fbff0_2048x.jpg?v=1691488817",ei="https://images.unsplash.com/photo-1542291026-7eec264c27ff?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80",ti="https://m.media-amazon.com/images/I/818gyfjYmZL.jpg",ri="https://www.houseofkids.com/media/catalog/product/cache/1/image/9df78eab33525d08d6e5fb8d27136e95/5/f/5f3503400a50bHugo_Boss-_jakke-j26417-09b_0_Front_website.jpg",ni="https://dailyworkerplacement.com/wp-content/uploads/2017/12/shelfb-1648x1140.jpg",si="https://yolohayoga.com/cdn/shop/files/Aura-Cork-Yoga-Mat.jpg?v=1695911413",ur="https://www.dualit.com/cdn/shop/files/Blender-Chrome-Lifestyle-1.jpg?v=1685022361",ii="https://ik.imagekit.io/panmac/tr:f-auto,w-740,pr-true//bcd02f72-b50c-0179-8b4b-5e44f5340bd4/c56137c1-a008-48ee-b479-71c378adcbb2/Modern-children%27s-books-we-think-will-be-classics.jpg",ai="https://m.media-amazon.com/images/I/71z-qa1M5dL._AC_SL1500_.jpg",oi="https://hniesfp.imgix.net/8/images/detailed/312/AALNBS-SGR_1.jpg?fit=fill&bg=0FFF&w=1500&h=1000&auto=format,compress",ci="https://intensecycles.com/cdn/shop/files/2_2.png?v=1714596775",li="https://m.media-amazon.com/images/I/81qQrGur9QL.jpg",di="https://i5.walmartimages.com/seo/Home-Decorative-Mainstays-LED-Architect-Desk-Lamp-Black-Metal-Powder-Coating-Finish-for-All-Ages_2416f3cf-e5d2-4e9d-9612-d2ad61a014e0.ce7d149337e1d115ba4a61a2c3a11904.jpeg",ui="https://cdncloudcart.com/402/products/images/148284/laptop-apple-macbook-pro-16a-m3-pro-512gb-space-black-mrw13--16-20--18--512gb-ssd--apple-m3-pro-12-core--apple-m3-pro-18-core-gpu-6542458122175_800x800.png?1698842017",vl="https://images.unsplash.com/photo-1532453288672-3a27e9be9efd?fm=jpg&q=60&w=3000&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8NHx8Y2xvdGhlc3xlbnwwfHwwfHx8MA%3D%3D",wl="https://images.unsplash.com/photo-1518770660439-4636190af475?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80",jl="https://images.unsplash.com/photo-1543002588-bfa74002ed7e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80",Sl="https://st4.depositphotos.com/1023934/37752/i/450/depositphotos_377527168-stock-photo-interior-design-modern-living-room.jpg",_l="https://t3.ftcdn.net/jpg/00/74/44/28/360_F_74442850_C0PsTWPFlOfwcPA3AybYefXDBmnWVsWX.jpg",Cl="https://t4.ftcdn.net/jpg/00/04/43/79/360_F_4437974_DbE4NRiaoRtUeivMyfPoXZFNdCnYmjPq.jpg";var Br={},El=J;Object.defineProperty(Br,"__esModule",{value:!0});var Nr=Br.default=void 0,kl=El(Z()),Il=n;Nr=Br.default=(0,kl.default)((0,Il.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search");const hi=({value:t,onChange:e,onSearch:r,placeholder:s="Търсене...",sx:i,variant:a="search"})=>{const o=d=>({"& .MuiInputBase-root":{backgroundColor:a==="home"?"rgba(255, 255, 255, 0.9)":"#ffffff",backdropFilter:a==="home"?"blur(4px)":"none",borderRadius:2,border:a==="home"?"1px solid rgba(255, 255, 255, 0.3)":`1px solid ${d.palette.divider}`,boxShadow:"0 2px 4px rgba(0,0,0,0.05)",transition:"all 0.2s ease-in-out","&:hover":{backgroundColor:a==="home"?"rgba(255, 255, 255, 1)":"#ffffff",border:a==="home"?"1px solid rgba(255, 255, 255, 0.5)":`1px solid ${d.palette.primary.main}`,boxShadow:"0 4px 8px rgba(0,0,0,0.1)"},"&.Mui-focused":{backgroundColor:a==="home"?"rgba(255, 255, 255, 1)":"#ffffff",border:a==="home"?"2px solid rgba(255, 255, 255, 0.8)":`2px solid ${d.palette.primary.main}`,boxShadow:"0 8px 16px rgba(0,0,0,0.2)"}},"& .MuiInputBase-input":{padding:"16px",fontSize:"1.1rem",color:d.palette.text.primary,"&::placeholder":{color:d.palette.text.secondary,opacity:.8}},"& .MuiInputAdornment-root .MuiSvgIcon-root":{fontSize:"1.5rem",color:d.palette.primary.main,marginLeft:"8px"}}),c=d=>{d.preventDefault(),r&&t.trim()&&r(t)},l=d=>{d.key==="Enter"&&r&&t.trim()&&r(t)};return n.jsx("form",{onSubmit:c,style:{width:"100%"},children:n.jsx(U,{fullWidth:!0,value:t,onChange:d=>e(d.target.value),onKeyPress:l,placeholder:s,sx:d=>({...o(d),...i&&typeof i=="function"?i(d):i}),InputProps:{endAdornment:n.jsx(et,{position:"end",children:n.jsx(G,{type:"submit","aria-label":"search",onClick:()=>r&&t.trim()&&r(t),sx:{color:"primary.main","&:hover":{backgroundColor:"rgba(46, 125, 50, 0.04)"}},children:n.jsx(Nr,{})})})}})})};var Lr={},Al=J;Object.defineProperty(Lr,"__esModule",{value:!0});var fi=Lr.default=void 0,Dl=Al(Z()),Tl=n;fi=Lr.default=(0,Dl.default)((0,Tl.jsx)("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 4-8 5-8-5V6l8 5 8-5z"}),"Email");var Wr={},Pl=J;Object.defineProperty(Wr,"__esModule",{value:!0});var mi=Wr.default=void 0,Rl=Pl(Z()),Ol=n;mi=Wr.default=(0,Rl.default)((0,Ol.jsx)("path",{d:"M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02z"}),"Phone");const Ut=()=>{const t=[{title:"Начало",path:"/"},{title:"За нас",path:"/about"},{title:"Как работи",path:"/how-it-works"},{title:"Създай обява",path:"/create-listing"},{title:"Търсене",path:"/search"},{title:"Контакти",path:"/contact"}],e=[{title:"Политика за поверителност",path:"/privacy"},{title:"Условия за ползване",path:"/terms"}],r=[{name:"Дрехи",icon:""},{name:"Електроника",icon:""},{name:"Книги",icon:""},{name:"Мебели",icon:""},{name:"Спортни стоки",icon:""},{name:"Кухненски принадлежности",icon:""},{name:"Инструменти",icon:""},{name:"Други",icon:""}];return n.jsx(g,{component:"footer",sx:{bgcolor:"primary.main",color:"white",py:{xs:4,md:6},mt:"auto"},children:n.jsxs(z,{maxWidth:"lg",children:[n.jsxs(_,{container:!0,spacing:4,children:[n.jsxs(_,{item:!0,xs:12,sm:6,md:3,children:[n.jsx(f,{variant:"h6",gutterBottom:!0,sx:{fontWeight:600},children:"Бързи връзки"}),t.map(s=>n.jsx(_e,{component:Me,to:s.path,color:"inherit",sx:{display:"flex",alignItems:"center",mb:1,textDecoration:"none",transition:"all 0.2s ease-in-out","&:hover":{color:"secondary.light",transform:"translateX(8px)"}},children:s.title},s.title))]}),n.jsxs(_,{item:!0,xs:12,sm:6,md:3,children:[n.jsx(f,{variant:"h6",gutterBottom:!0,sx:{fontWeight:600},children:"Категории"}),r.map(s=>n.jsx(_e,{component:Me,to:`/search?category=${encodeURIComponent(s.name)}`,color:"inherit",sx:{display:"flex",alignItems:"center",mb:1,textDecoration:"none",transition:"all 0.2s ease-in-out","&:hover":{color:"secondary.light",transform:"translateX(8px)"}},children:s.name},s.name))]}),n.jsxs(_,{item:!0,xs:12,sm:6,md:3,children:[n.jsx(f,{variant:"h6",gutterBottom:!0,sx:{fontWeight:600},children:"Контакти"}),n.jsxs(g,{sx:{mb:2},children:[n.jsxs(_e,{href:"mailto:stilianmihnev@gmail.com",color:"inherit",sx:{display:"flex",alignItems:"center",mb:1,textDecoration:"none","&:hover":{color:"secondary.light"}},children:[n.jsx(fi,{sx:{mr:1}}),"stilianmihnev@gmail.com"]}),n.jsxs(_e,{href:"tel:+359888123456",color:"inherit",sx:{display:"flex",alignItems:"center",mb:1,textDecoration:"none","&:hover":{color:"secondary.light"}},children:[n.jsx(mi,{sx:{mr:1}}),"+359 888 123 456"]}),n.jsxs(g,{sx:{display:"flex",alignItems:"center",transition:"all 0.2s ease-in-out","&:hover":{color:"secondary.light",transform:"translateX(8px)"}},children:[n.jsx(Or,{sx:{mr:1}}),n.jsx(f,{variant:"body2",children:"Сливен, България"})]})]})]}),n.jsxs(_,{item:!0,xs:12,sm:6,md:3,children:[n.jsx(f,{variant:"h6",gutterBottom:!0,sx:{fontWeight:600},children:"Правна информация"}),e.map(s=>n.jsx(_e,{component:Me,to:s.path,color:"inherit",sx:{display:"flex",alignItems:"center",mb:1,textDecoration:"none",transition:"all 0.2s ease-in-out","&:hover":{color:"secondary.light",transform:"translateX(8px)"}},children:s.title},s.title))]})]}),n.jsx(Jt,{sx:{my:4,borderColor:"rgba(255, 255, 255, 0.1)"}}),n.jsxs(f,{variant:"body2",align:"center",sx:{opacity:.8},children:["© ",new Date().getFullYear()," Zero-Waste Swap Platform. Всички права запазени."]})]})})};function le(){const t=b.useContext(Cr);if(t===void 0)throw new Error("useAuth трябва да се използва в AuthProvider");return t}const ut=()=>{const{user:t}=le(),[e,r]=b.useState([]),[s,i]=b.useState(!0),[a,o]=b.useState(null);return b.useEffect(()=>{if(!t){r([]),i(!1);return}const d=Ce(Q,"favorites"),y=Ne(d,it("userId","==",t.uid)),h=yr(y,x=>{const p=x.docs.map(m=>String(m.data().listingId));r(p),i(!1)},x=>{console.error("Error loading favorites:",x),o("Грешка при зареждане на любими"),i(!1)});return()=>h()},[t]),{favorites:e,loading:s,error:a,toggleFavorite:async d=>{if(!t){o("Моля, влезте в системата, за да добавите в любими");return}try{const y=String(d),h=`${t.uid}_${y}`,x=he(Q,"favorites",h);if(e.includes(y))await ze(x);else{if(!y.startsWith("demo_")){const m=he(Q,"listings",y);if(!(await Bt(m)).exists()){o("Обявата не съществува");return}}const p={userId:t.uid,listingId:y,createdAt:as(),id:h};await Ma(x,p,{merge:!0})}}catch(y){console.error("Error toggling favorite:",y),o("Грешка при обновяване на любими")}},isFavorite:d=>e.includes(String(d))}},_n=mr`
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
`,Ml=mr`
  from {
    opacity: 0;
    transform: translateX(-20px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
`,Bl=mr`
  from {
    opacity: 0;
    transform: scale(0.95);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
`,M=({children:t,animation:e="fade",delay:r=0})=>{const s=()=>{switch(e){case"fade":return _n;case"slide":return Ml;case"scale":return Bl;default:return _n}};return n.jsx(g,{sx:{animation:`${s()} 0.5s ease-out ${r}s forwards`,opacity:0},children:t})};var Nl={PORT:"5000",CLIENT_URL:"http://localhost:5173",VITE_API_URL:"http://localhost:5000",MONGODB_URI:"mongodb+srv://stilianmh:BAlyA9dq6lls1dbo@zero-waste-swap.bljhvop.mongodb.net/zero-waste-swap?retryWrites=true&w=majority&appName=zero-waste-swap",EMAIL_USER:"stilianmihnev@gmail.com",EMAIL_PASSWORD:"gzfo kcgi ymqk gzbt",VITE_FIREBASE_PROJECT_ID:"zero-waste-swap",FIREBASE_PROJECT_ID:"zero-waste-swap",FIREBASE_CLIENT_EMAIL:"firebase-adminsdk-fbsvc@zero-waste-swap.iam.gserviceaccount.com",FIREBASE_PRIVATE_KEY:"-----BEGIN PRIVATE KEY-----\\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQDCfi+hBENezgIiZTQz89dzUi0ZaROzxSHHJlkwEBri7IRDUreSwQdcCt7gRunTy7Guo1rovp0g0hZ6YHrvcuhgQySegN0XJqGrhZRMrLwkWIxpLGq6m1hFhI1KYDVyWxYG/KaC+VN+eHul1XoaRne8qrq+kGDxbf12TgMGhw60yxe8n24hhVHNlmsY8FGNG7snlw831HDqY7SYPFWcwO/SaWs01EDztcW0hmh+XElY9ydad2qngoTDCDqQLR7E5/pt8bAurBg0kaJV4r94F+Bfzj2QPWjUpQhyVFoZAlt4zAN6WCnT1VnIIiyk5Vvn7d0ajLXPS+wjU+AwhhCv2BdnAgMBAAECggEAXEE7uW5KwJkKVSNZOD11WIvFvbRkdpTO+WaczpoNDs+uyzpcvj1WjtfPMWYhuud3gEWXNShZYvyUUfcaySLhy+t9Xrv0Y2tdK32Awz/6PGlOLQM3Gw3duJfv5zQslfJTx/umxiCa9LYUvKw+r2D2oeUAEK1udoa8QBYwBDQjCykpBd6Bc+1mI7i+iAsIVcAtDVrFqUlfagr3cLfvvwFk3GCvamN3BsSSDhGaWKzMfjI/a9SVRPY34AfkVjhdlfHMo29Ajo0VyLSbT2fpwVqR+5LMrGe7682smShao8DqO2qQnPt2Rew4rtUIuQk9/7dqgVBUFCv33UN5ntv9zjnRUQKBgQDhhHF3SAvPwPbBG0ExgleZyxOOsjnHBjKG+1u2XFxuphvwtmwHq6Nz18jNySCu9RVq0TvLrry0qpBDpadYekHkj0a1jkD9EW39y7OjqsrF3S9+Dlt/tPYtxVokYkWiH+/KWkUEEpw5so5M6C/Dwv5tKbdYkv6KymLaJOhYyfeKsQKBgQDcyDT0BGa4F1BUSTpl341sEeBdZyNfZcF0/0NVDL2xEOqfQjrvg4paCu0CovU9uqDRfVZXz+CbaNldt8a6/IPlk8uebJK/OA2Z9STCiAupIevhRg0b9Wla4YJnQVVP4bqi18MK7hAwFrdmUYagDe5pAUJ77X8IjgjPxf3bhWoZlwKBgQDM1whZWE+iPZvke2UUG1iGkTcKfkiMxsxOXzJGyk4LE0Z9trUZooWtS2tRwEa3pFX32GV/9Q/i6qpvR6BhdWs0uA96CeRt+c72oHhjSVc1slrZHSFvNmgF2yStt7WYNXoRSz01HdJZdh5bLOt13UBM1396LMqYNozjqHKDc7AtgQKBgBRRPEZEbWt9gb/v6TbcxrfuQTZ3OlMaGx54KysVfBNiWiUDxEasVTwKC1uVwXnHxerh\\nXOPB1oqWsIImWlx0xnKHElLm7O45606Ct7pLKL+Mxpc5ihVLlUFuxUBZS8+JF1LLBkDoPYcfYAtDb18lSQ5StlqPNYSFBZyRPNZJxcTLAoGAXSH+6LpWMcWrnUqqpdH5RxGN36ofUJN9reykgDIbxRu6H8yKIb/6Y2rJUP5DsnX8o6mTRkKCShXNyqHB4b7pos+G4ArK/Ovn4h74zJMqq+8P9nJOqaWIBLQZ7uNO51Cerv6VJVbOGXPEQUQvLFaZCdfomN5U0N0WdCKwN62L5Q8=\\n-----END PRIVATE KEY-----\\n",VITE_FIREBASE_API_KEY:"AIzaSyCpDr8QI3d4_7xStw_5agh_nHGX8Agojas",VITE_FIREBASE_AUTH_DOMAIN:"zero-waste-swap.firebaseapp.com",VITE_FIREBASE_STORAGE_BUCKET:"zero-waste-swap.firebasestorage.app",VITE_FIREBASE_MESSAGING_SENDER_ID:"32063996385",VITE_FIREBASE_APP_ID:"1:32063996385:web:fcd62891f07e28826092a0",VITE_FIREBASE_MEASUREMENT_ID:"G-KBDTETVZ1J",VITE_USE_FIREBASE_EMULATORS:"false",VITE_CLOUDINARY_CLOUD_NAME:"dlcko37mx",VITE_CLOUDINARY_UPLOAD_PRESET:"uploads",VITE_CLOUDINARY_API_KEY:"578595613657324",VITE_CLOUDINARY_API_SECRET:"P9Aul3wCEvVWRb-ktKqAXmVptoI",VITE_CLIENT_URL:"http://localhost:3000",ACSetupSvcPort:"23210",ACSvcPort:"17532",ALLUSERSPROFILE:"C:\\ProgramData",APPDATA:"C:\\Users\\mihnev\\AppData\\Roaming",CHROME_CRASHPAD_PIPE_NAME:"\\\\.\\pipe\\crashpad_16848_PJSKNBAFLRKHZNZR",COLOR:"1",COLORTERM:"truecolor",CommonProgramFiles:"C:\\Program Files\\Common Files","CommonProgramFiles(x86)":"C:\\Program Files (x86)\\Common Files",CommonProgramW6432:"C:\\Program Files\\Common Files",COMPUTERNAME:"DESKTOP-IDJ261H",ComSpec:"C:\\WINDOWS\\system32\\cmd.exe",CURSOR_TRACE_ID:"ae869b9bc49848c08ca7fd53b5ded77d",DriverData:"C:\\Windows\\System32\\Drivers\\DriverData",EDITOR:"C:\\WINDOWS\\notepad.exe",EFC_5932_1592913036:"1",EnableLog:"INFO",FPS_BROWSER_APP_PROFILE_STRING:"Internet Explorer",FPS_BROWSER_USER_PROFILE_STRING:"Default",GIT_ASKPASS:"c:\\Users\\mihnev\\AppData\\Local\\Programs\\cursor\\resources\\app\\extensions\\git\\dist\\askpass.sh",HOME:"C:\\Users\\mihnev",HOMEDRIVE:"C:",HOMEPATH:"\\Users\\mihnev",IGCCSVC_DB:"AQAAANCMnd8BFdERjHoAwE/Cl+sBAAAA0R4Kl3/oL0a6dOq9c0Q2GQQAAAACAAAAAAAQZgAAAAEAACAAAAAUxdqT2FsC2hFpjSdHap1roSJQIxDxFHmvN7fPGLMTVQAAAAAOgAAAAAIAACAAAADV8/VnN9HbEK/TUkLmNzzLfmSW5fjMQEvj6DbySGrjdGAAAAAV5BqEl1d3nft35dfB7/rw6+RSxiutBBByVUYYQawzsJiniSkFKqVjUsfUJUxO8qGil0aILKgxvVJcRwsVBdQYEfB4FYNADKUwAIrWOj83bUFVCV65XrAYkanu0q+UFxRAAAAAFGUOkxCVdtscpIqs+Ok5lGeOx4A48KoVBvttfWutrbknQzuY0ivVpJ5wa7j4na1B/Bof7vpIaJnKS+xCEPls9Q==",INIT_CWD:"D:\\Zero-Waste Swap Platform","IntelliJ IDEA Community Edition":"C:\\Program Files\\JetBrains\\IntelliJ IDEA Community Edition 2024.3.3\\bin;",JAVA_HOME:"C:\\Users\\mihnev\\Downloads\\jdk-23_windows-x64_bin.zip\\jdk-23.0.2",LANG:"en_US.UTF-8",LOCALAPPDATA:"C:\\Users\\mihnev\\AppData\\Local",LOGONSERVER:"\\\\DESKTOP-IDJ261H",NINJA_ENV:"parentDisabled",NODE:"C:\\Program Files\\nodejs\\node.exe",NODE_ENV:"production",NODE_EXE:"C:\\Program Files\\nodejs\\\\node.exe",NPM_CLI_JS:"C:\\Users\\mihnev\\AppData\\Roaming\\npm\\node_modules\\npm\\bin\\npm-cli.js",npm_command:"run-script",npm_config_cache:"C:\\Users\\mihnev\\AppData\\Local\\npm-cache",npm_config_globalconfig:"C:\\Users\\mihnev\\AppData\\Roaming\\npm\\etc\\npmrc",npm_config_global_prefix:"C:\\Users\\mihnev\\AppData\\Roaming\\npm",npm_config_init_module:"C:\\Users\\mihnev\\.npm-init.js",npm_config_local_prefix:"D:\\Zero-Waste Swap Platform",npm_config_node_gyp:"C:\\Users\\mihnev\\AppData\\Roaming\\npm\\node_modules\\npm\\node_modules\\node-gyp\\bin\\node-gyp.js",npm_config_noproxy:"",npm_config_npm_version:"11.0.0",npm_config_prefix:"C:\\Users\\mihnev\\AppData\\Roaming\\npm",npm_config_userconfig:"C:\\Users\\mihnev\\.npmrc",npm_config_user_agent:"npm/11.0.0 node/v20.17.0 win32 x64 workspaces/false",npm_execpath:"C:\\Users\\mihnev\\AppData\\Roaming\\npm\\node_modules\\npm\\bin\\npm-cli.js",npm_lifecycle_event:"build",npm_lifecycle_script:"tsc && vite build",npm_node_execpath:"C:\\Program Files\\nodejs\\node.exe",npm_package_json:"D:\\Zero-Waste Swap Platform\\package.json",npm_package_name:"zero-waste-swap-platform",npm_package_version:"0.1.0",NPM_PREFIX_JS:"C:\\Program Files\\nodejs\\\\node_modules\\npm\\bin\\npm-prefix.js",NPM_PREFIX_NPM_CLI_JS:"C:\\Users\\mihnev\\AppData\\Roaming\\npm\\node_modules\\npm\\bin\\npm-cli.js",NUMBER_OF_PROCESSORS:"20",OneDrive:"C:\\Users\\mihnev\\OneDrive",OneDriveConsumer:"C:\\Users\\mihnev\\OneDrive",ORIGINAL_XDG_CURRENT_DESKTOP:"undefined",OS:"Windows_NT",Path:"D:\\Zero-Waste Swap Platform\\node_modules\\.bin;D:\\node_modules\\.bin;C:\\Users\\mihnev\\AppData\\Roaming\\npm\\node_modules\\npm\\node_modules\\@npmcli\\run-script\\lib\\node-gyp-bin;C:\\Program Files\\Common Files\\Oracle\\Java\\javapath;C:\\WINDOWS\\system32;C:\\WINDOWS;C:\\WINDOWS\\System32\\Wbem;C:\\WINDOWS\\System32\\WindowsPowerShell\\v1.0\\;C:\\WINDOWS\\System32\\OpenSSH\\;C:\\Program Files (x86)\\NVIDIA Corporation\\PhysX\\Common;C:\\Program Files\\Microsoft VS Code\\bin;C:\\Program Files\\nodejs\\;C:\\Program Files\\Git\\cmd;C:\\Program Files (x86)\\Windows Kits\\10\\Windows Performance Toolkit\\;C:\\Program Files\\dotnet\\;C:\\Program Files\\NVIDIA Corporation\\NVIDIA app\\NvDLISR;C:\\Program Files\\MongoDB\\mongosh-2.3.9-win32-x64\\bin;C:\\Users\\mihnev\\Downloads\\jdk-23_windows-x64_bin.zip\\jdk-23.0.2\\bin;C:\\Users\\mihnev\\.console-ninja\\.bin;C:\\Users\\mihnev\\AppData\\Local\\Microsoft\\WindowsApps;C:\\Users\\mihnev\\AppData\\Roaming\\npm;C:\\Users\\mihnev\\AppData\\Local\\GitHubDesktop\\bin;C:\\Program Files\\heroku\\bin;C:\\Users\\mihnev\\AppData\\Local\\Microsoft\\WindowsApps;C:\\Program Files\\JetBrains\\IntelliJ IDEA Community Edition 2024.3.3\\bin;;C:\\Users\\mihnev\\AppData\\Local\\Programs\\cursor\\resources\\app\\bin;C:\\Users\\mihnev\\AppData\\Local\\Google\\Cloud SDK\\google-cloud-sdk\\bin",PATHEXT:".COM;.EXE;.BAT;.CMD;.VBS;.VBE;.JS;.JSE;.WSF;.WSH;.MSC;.CPL",PROCESSOR_ARCHITECTURE:"AMD64",PROCESSOR_IDENTIFIER:"Intel64 Family 6 Model 183 Stepping 1, GenuineIntel",PROCESSOR_LEVEL:"6",PROCESSOR_REVISION:"b701",ProgramData:"C:\\ProgramData",ProgramFiles:"C:\\Program Files","ProgramFiles(x86)":"C:\\Program Files (x86)",ProgramW6432:"C:\\Program Files",PROMPT:"$P$G",PSModulePath:"C:\\Users\\mihnev\\Documents\\WindowsPowerShell\\Modules;C:\\Users\\mihnev\\AppData\\Local\\Google\\Cloud SDK\\google-cloud-sdk\\platform\\PowerShell;C:\\Program Files\\WindowsPowerShell\\Modules;C:\\WINDOWS\\system32\\WindowsPowerShell\\v1.0\\Modules",PUBLIC:"C:\\Users\\Public",RlsSvcPort:"22112",SESSIONNAME:"Console",SystemDrive:"C:",SystemRoot:"C:\\WINDOWS",TEMP:"C:\\Users\\mihnev\\AppData\\Local\\Temp",TERM_PROGRAM:"vscode",TERM_PROGRAM_VERSION:"0.49.5",TMP:"C:\\Users\\mihnev\\AppData\\Local\\Temp",USERDOMAIN:"DESKTOP-IDJ261H",USERDOMAIN_ROAMINGPROFILE:"DESKTOP-IDJ261H",USERNAME:"mihnev",USERPROFILE:"C:\\Users\\mihnev",VSCODE_GIT_ASKPASS_EXTRA_ARGS:"",VSCODE_GIT_ASKPASS_MAIN:"c:\\Users\\mihnev\\AppData\\Local\\Programs\\cursor\\resources\\app\\extensions\\git\\dist\\askpass-main.js",VSCODE_GIT_ASKPASS_NODE:"C:\\Users\\mihnev\\AppData\\Local\\Programs\\cursor\\Cursor.exe",VSCODE_GIT_IPC_HANDLE:"\\\\.\\pipe\\vscode-git-4272f1f982-sock",VSCODE_INJECTION:"1",VSCODE_NONCE:"ab1d4720-1836-444b-90a0-43bd7ef04846",VSCODE_STABLE:"1",windir:"C:\\WINDOWS",ZES_ENABLE_SYSMAN:"1"};const Ll=()=>{const t=ae(),e=je(),{logPageView:r}=Na(),[s,i]=b.useState(""),[a,o]=b.useState([]),[c,l]=b.useState(!0),{favorites:d,toggleFavorite:y}=ut(),{user:h,token:x}=le(),{setCurrentChat:p}=dt(),[m,u]=b.useState(null),[A,O]=b.useState(null),v=[{id:"clothing",name:"Дрехи",image:vl},{id:"electronics",name:"Електроника",image:wl},{id:"books",name:"Книги",image:jl},{id:"furniture",name:"Мебели",image:Sl},{id:"toys",name:"Играчки",image:_l},{id:"sports",name:"Спорт",image:Cl}];b.useEffect(()=>{r("home"),k()},[r]);const k=async()=>{try{l(!0),u(null),h||console.log("User not authenticated, fetching public listings");const w=Ne(Ce(Q,"listings"),nr("createdAt","desc"),Ba(8)),S=(await Nt(w)).docs.map(j=>{var L,K;const P=j.data();console.log("Raw listing data:",P);const W=P.userId||((L=j.ref.parent.parent)==null?void 0:L.id);if(!W)return console.warn("Listing missing userId:",j.id),console.log("Listing data:",P),null;const q={id:j.id,title:P.title||"Untitled",description:P.description||"",category:P.category||"other",condition:P.condition||"good",images:Array.isArray(P.images)?P.images:[],userEmail:P.userEmail||P.email||"",userName:P.userName||P.firstName||"Anonymous",createdAt:((K=P.createdAt)==null?void 0:K.toDate())||new Date,location:P.location||{address:"",latitude:0,longitude:0},userId:W,user:{_id:W,username:P.userName||P.firstName||"Anonymous",email:P.userEmail||P.email||""}};return console.log("Processed listing:",q),q}).filter(j=>j!==null);console.log("Fetched listings:",S),o(S)}catch(w){console.error("Error fetching recent listings:",w),w instanceof Error?u(`Възникна грешка при зареждане на обявите: ${w.message}`):u("Възникна грешка при зареждане на обявите")}finally{l(!1)}},R=()=>{t(`/search?q=${encodeURIComponent(s)}`)},T=w=>{i(w)},N=w=>{t(`/search?category=${w}`)},$=(w,B=!1)=>{const S=B?`demo_${w.id}`:w.id,j=B?{id:S,...w,images:[w.image],location:{address:w.location,latitude:0,longitude:0},userId:"demo",userName:"Demo User",userEmail:"demo@example.com",createdAt:new Date,updatedAt:new Date,condition:"good",status:"active"}:w;t(`/listing/${S}`,{state:{listing:j}})},D=async(w,B)=>{w.stopPropagation(),h?await y(B):t("/login")},I=async(w,B)=>{var S;if(w.stopPropagation(),!h||!x){t("/login");return}try{O(B.id);const j=Nl.VITE_API_URL||"http://localhost:3001";console.log("Starting chat with API URL:",j),console.log("Listing data:",B);const P=B.userId||((S=B.user)==null?void 0:S._id);if(console.log("Participant ID:",P),console.log("Current user ID:",h.uid),!P)throw console.error("Missing participant ID in listing:",B),new Error("Cannot start chat: User ID not found in listing data");if(P===h.uid)throw new Error("Не можете да започнете чат със себе си!");const W=await fetch(`${j}/api/chats`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${x}`},body:JSON.stringify({participantId:P})});if(console.log("Chat creation response status:",W.status),!W.ok){const L=await W.json().catch(()=>({}));throw console.error("Chat creation error:",L),new Error(L.message||`HTTP error! status: ${W.status}`)}const q=await W.json();console.log("Chat created successfully:",q),p(q),t("/chat")}catch(j){console.error("Error starting chat:",j),u(j instanceof Error?j.message:"Failed to start chat. Please try again.")}finally{O(null)}},C=(w,B=!1)=>{const S=B?`demo_${w.id}`:w.id,j=d.includes(S),P=B?[w.image]:w.images,W=A===S;let q="Location not specified";return B&&w.location?q=w.location:w.location&&(q=typeof w.location=="string"?w.location:w.location.address||"Location not specified"),n.jsxs(Ae,{sx:{height:"100%",display:"flex",flexDirection:"column",cursor:"pointer",transition:"all 0.2s ease-in-out","&:hover":{transform:"translateY(-4px)",boxShadow:e.shadows[4]}},onClick:()=>$(w,B),children:[n.jsxs(g,{sx:{position:"relative"},children:[n.jsx(Be,{component:"img",height:"200",image:(P==null?void 0:P[0])||"/placeholder-image.jpg",alt:w.title,sx:{objectFit:"cover"}}),n.jsxs(g,{sx:{position:"absolute",top:8,right:8,display:"flex",gap:1},children:[n.jsx(G,{size:"small",sx:{backgroundColor:"rgba(255, 255, 255, 0.8)","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.9)"}},onClick:L=>D(L,S),children:j?n.jsx(Ks,{color:"error"}):n.jsx(Xs,{})},`favorite-${S}`),!B&&n.jsx(G,{size:"small",sx:{backgroundColor:"rgba(255, 255, 255, 0.8)","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.9)"}},onClick:L=>I(L,w),disabled:W||!h,children:W?n.jsx(ee,{size:20}):n.jsx(Qs,{color:h?"primary":"disabled"})},`chat-${S}`)]})]}),n.jsxs(De,{sx:{flexGrow:1},children:[n.jsx(f,{variant:"h6",component:"h2",gutterBottom:!0,children:w.title}),n.jsx(f,{variant:"body2",color:"text.secondary",sx:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",mb:2},children:w.description}),n.jsxs(g,{sx:{display:"flex",alignItems:"center",mb:1},children:[n.jsx(Or,{fontSize:"small",color:"action",sx:{mr:.5}}),n.jsx(f,{variant:"body2",color:"text.secondary",children:q})]}),!B&&w.category&&n.jsxs(g,{sx:{display:"flex",gap:1,mt:1},children:[n.jsx(be,{label:w.category,size:"small",color:"primary",variant:"outlined"},`category-${S}`),w.condition&&n.jsx(be,{label:w.condition,size:"small",color:"secondary",variant:"outlined"},`condition-${S}`)]})]})]},`card-${S}`)},E=[{id:1,title:"Organic Vegetables",description:"Fresh organic vegetables from our garden, including tomatoes, cucumbers, and leafy greens",image:Js,location:"Sofia, Bulgaria",category:"Food"},{id:2,title:"Reusable Shopping Bags",description:"Set of 5 eco-friendly shopping bags made from recycled materials, durable and washable",image:Zs,location:"Plovdiv, Bulgaria",category:"Accessories"},{id:3,title:"Kitchen Set",description:"Complete kitchen set including pots, pans, and utensils, lightly used",image:ur,location:"Varna, Bulgaria",category:"Other"},{id:4,title:"Running Shoes",description:"Nike running shoes, size EU 42, gently used, perfect for beginners",image:ei,location:"Burgas, Bulgaria",category:"Clothing"},{id:5,title:"Coffee Maker",description:"Philips coffee maker, 1.5L capacity, used for 6 months, works perfectly",image:ti,location:"Ruse, Bulgaria",category:"Electronics"},{id:6,title:"Winter Jacket",description:"Women's winter jacket, size M, water-resistant, excellent condition",image:ri,location:"Sofia, Bulgaria",category:"Clothing"},{id:7,title:"Board Games Collection",description:"Collection of popular board games including Monopoly, Scrabble, and Chess",image:ni,location:"Plovdiv, Bulgaria",category:"Entertainment"},{id:8,title:"Yoga Mat",description:"Eco-friendly yoga mat made from natural rubber, 4mm thickness, barely used",image:si,location:"Varna, Bulgaria",category:"Sports"},{id:9,title:"Blender",description:"High-speed blender perfect for smoothies and soups, 800W power",image:ur,location:"Burgas, Bulgaria",category:"Appliances"},{id:10,title:"Children's Books",description:"Collection of 15 children's books in excellent condition, suitable for ages 5-8",image:ii,location:"Sofia, Bulgaria",category:"Books"},{id:11,title:"Garden Tools Set",description:"Complete set of garden tools including shovel, rake, and pruning shears",image:ai,location:"Stara Zagora, Bulgaria",category:"Tools"},{id:12,title:"Laptop Stand",description:"Adjustable aluminum laptop stand, ergonomic design, foldable",image:oi,location:"Veliko Tarnovo, Bulgaria",category:"Electronics"},{id:13,title:"Bicycle",description:'Mountain bike in good condition, 26" wheels, recently serviced',image:ci,location:"Sofia, Bulgaria",category:"Sports"},{id:14,title:"Art Supplies",description:"Set of acrylic paints, brushes, and canvas boards, perfect for beginners",image:li,location:"Plovdiv, Bulgaria",category:"Hobbies"},{id:15,title:"Desk Lamp",description:"LED desk lamp with adjustable brightness and color temperature",image:di,location:"Varna, Bulgaria",category:"Electronics"},{id:16,title:"Laptop",description:'Apple MacBook Pro 16" M3 Pro 512GB Space Black',image:ui,location:"Sliven, Bulgaria",category:"Electronics"}];return n.jsxs(M,{animation:"fade",children:[n.jsxs(g,{children:[n.jsx(g,{sx:{position:"relative",height:"100vh",minHeight:600,backgroundImage:`url(${yl})`,backgroundSize:"cover",backgroundPosition:"center",display:"flex",alignItems:"center",justifyContent:"center","&::before":{content:'""',position:"absolute",top:0,left:0,right:0,bottom:0,background:"linear-gradient(to bottom, rgba(0,0,0,0.2) 0%, rgba(0,0,0,0.6) 100%)"}},children:n.jsxs(z,{maxWidth:"md",sx:{position:"relative",zIndex:1},children:[n.jsxs(M,{animation:"fade",delay:.2,children:[n.jsx(f,{variant:"h2",component:"h1",align:"center",color:"white",sx:{mb:2,fontWeight:"bold",textShadow:"2px 2px 4px rgba(0,0,0,0.5)"},children:"Споделете. Обновете. Пазете природата."}),n.jsx(f,{variant:"h4",align:"center",color:"white",sx:{mb:4,textShadow:"1px 1px 3px rgba(0,0,0,0.5)",fontWeight:300},children:"Вашите вещи заслужават втори шанс"})]}),n.jsx(M,{animation:"fade",delay:.4,children:n.jsx(hi,{value:s,onChange:T,onSearch:R,placeholder:"Намерете подходящият за вас продукт..."})})]})}),n.jsxs(g,{sx:{mt:-8,position:"relative",zIndex:2,bgcolor:"background.paper"},children:[n.jsxs(z,{maxWidth:"lg",sx:{py:8},children:[n.jsx(M,{animation:"slide",delay:.6,children:n.jsx(f,{variant:"h4",component:"h2",gutterBottom:!0,align:"center",sx:{mb:6,position:"relative","&::after":{content:'""',position:"absolute",bottom:-8,left:"50%",transform:"translateX(-50%)",width:60,height:4,bgcolor:"primary.main",borderRadius:2}},children:"Категории"})}),n.jsx(_,{container:!0,spacing:4,children:v.map((w,B)=>n.jsx(_,{item:!0,xs:12,sm:6,md:4,children:n.jsx(M,{animation:"scale",delay:.8+B*.1,children:n.jsxs(Ae,{sx:{height:"100%",display:"flex",flexDirection:"column",cursor:"pointer",transition:"all 0.2s ease-in-out","&:hover":{transform:"translateY(-4px)",boxShadow:e.shadows[4]}},onClick:()=>N(w.id),children:[n.jsx(Be,{component:"img",height:"140",image:w.image,alt:w.name,sx:{objectFit:"cover"}}),n.jsx(De,{sx:{flexGrow:1},children:n.jsx(f,{gutterBottom:!0,variant:"h6",component:"div",align:"center",children:w.name})})]})})},w.id))})]}),n.jsxs(z,{maxWidth:"lg",sx:{py:8},children:[n.jsx(M,{animation:"slide",delay:.6,children:n.jsx(f,{variant:"h4",component:"h2",gutterBottom:!0,align:"center",sx:{mb:6,position:"relative","&::after":{content:'""',position:"absolute",bottom:-8,left:"50%",transform:"translateX(-50%)",width:60,height:4,bgcolor:"primary.main",borderRadius:2}},children:"Представени обяви"})}),n.jsx(_,{container:!0,spacing:4,sx:{mt:2},children:E.map(w=>n.jsx(_,{item:!0,xs:12,sm:6,md:4,children:C(w,!0)},`featured-${w.id}`))})]}),n.jsxs(z,{maxWidth:"lg",sx:{py:8},children:[n.jsx(M,{animation:"slide",delay:.6,children:n.jsx(f,{variant:"h4",component:"h2",gutterBottom:!0,align:"center",sx:{mb:6,position:"relative","&::after":{content:'""',position:"absolute",bottom:-8,left:"50%",transform:"translateX(-50%)",width:60,height:4,bgcolor:"primary.main",borderRadius:2}},children:"Последни обяви"})}),c?n.jsx(g,{sx:{display:"flex",justifyContent:"center",py:4},children:n.jsx(ee,{})}):m?n.jsx(ie,{severity:"error",sx:{mt:2},children:m}):a.length===0?n.jsx(ie,{severity:"info",sx:{mt:2},children:"Все още няма обяви"}):n.jsx(_,{container:!0,spacing:4,sx:{mt:2},children:a.map(w=>n.jsx(_,{item:!0,xs:12,sm:6,md:4,children:C(w)},`recent-${w.id}`))})]}),n.jsx(g,{sx:{bgcolor:"background.paper",py:8},children:n.jsxs(z,{maxWidth:"lg",children:[n.jsx(M,{animation:"slide",delay:.6,children:n.jsx(f,{variant:"h4",component:"h2",gutterBottom:!0,align:"center",sx:{mb:6,position:"relative","&::after":{content:'""',position:"absolute",bottom:-8,left:"50%",transform:"translateX(-50%)",width:60,height:4,bgcolor:"primary.main",borderRadius:2}},children:"Как работи?"})}),n.jsxs(_,{container:!0,spacing:4,sx:{mt:2},children:[n.jsx(_,{item:!0,xs:12,md:4,children:n.jsx(M,{animation:"scale",delay:.8,children:n.jsxs(g,{sx:{textAlign:"center"},children:[n.jsx(f,{variant:"h6",gutterBottom:!0,children:"1. Създайте обява"}),n.jsx(f,{variant:"body1",color:"text.secondary",children:"Качете снимки и описание на предмета, който искате да обменяте"})]})})}),n.jsx(_,{item:!0,xs:12,md:4,children:n.jsx(M,{animation:"scale",delay:1,children:n.jsxs(g,{sx:{textAlign:"center"},children:[n.jsx(f,{variant:"h6",gutterBottom:!0,children:"2. Намерете подходящ обмен"}),n.jsx(f,{variant:"body1",color:"text.secondary",children:"Разгледайте обявите и намерете нещо, което ви интересува"})]})})}),n.jsx(_,{item:!0,xs:12,md:4,children:n.jsx(M,{animation:"scale",delay:1.2,children:n.jsxs(g,{sx:{textAlign:"center"},children:[n.jsx(f,{variant:"h6",gutterBottom:!0,children:"3. Договорете обмен"}),n.jsx(f,{variant:"body1",color:"text.secondary",children:"Свържете се с продавача и договорете детайлите на обмена"})]})})})]})]})})]})]}),n.jsx(Ut,{})]})},Wl=()=>{const[t,e]=b.useState(""),[r,s]=b.useState(""),[i,a]=b.useState(!1),{login:o,error:c,clearError:l}=le(),d=ae(),y=x=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(x),h=async x=>{if(x.preventDefault(),l(),!!y(t))try{a(!0),await o(t,r),d("/")}catch{}finally{a(!1)}};return n.jsx(M,{animation:"fade",children:n.jsx(g,{sx:{pt:8},children:n.jsxs(z,{maxWidth:"sm",children:[n.jsx(M,{animation:"slide",delay:.2,children:n.jsxs(g,{sx:{mb:4,textAlign:"center"},children:[n.jsx(f,{variant:"h4",component:"h1",gutterBottom:!0,children:"Вход"}),n.jsx(f,{variant:"body1",color:"text.secondary",paragraph:!0,children:"Влезте в системата, за да продължите"})]})}),n.jsx(M,{animation:"scale",delay:.4,children:n.jsxs(re,{sx:{p:4},children:[c&&n.jsx(ie,{severity:"error",sx:{mb:2},children:c}),n.jsx("form",{onSubmit:h,children:n.jsxs(_,{container:!0,spacing:3,children:[n.jsx(_,{item:!0,xs:12,children:n.jsx(U,{fullWidth:!0,label:"Имейл",value:t,onChange:x=>e(x.target.value),required:!0,error:!!c,helperText:c&&!y(t)?"Моля, въведете валиден имейл адрес":""})}),n.jsx(_,{item:!0,xs:12,children:n.jsx(U,{fullWidth:!0,label:"Парола",type:"password",value:r,onChange:x=>s(x.target.value),required:!0,error:!!c,helperText:c})}),n.jsx(_,{item:!0,xs:12,children:n.jsx(M,{animation:"slide",delay:.6,children:n.jsxs(g,{sx:{display:"flex",flexDirection:"column",gap:2},children:[n.jsx(Y,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,disabled:i,children:i?n.jsx(ee,{size:24}):"Вход"}),n.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[n.jsx(_e,{component:Me,to:"/register",variant:"body2",children:"Нямате акаунт? Регистрирайте се"}),n.jsx(_e,{component:Me,to:"/forgot-password",variant:"body2",children:"Забравена парола?"})]})]})})})]})})]})})]})})})},Fl=()=>{const[t,e]=b.useState({name:"",email:"",password:"",confirmPassword:""}),[r,s]=b.useState(!1),[i,a]=b.useState(!1),[o,c]=b.useState(!1),{register:l,error:d,clearError:y}=le(),h=ae(),x=u=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(u),p=u=>u.length>=8,m=async u=>{if(u.preventDefault(),y(),!!x(t.email)&&p(t.password)&&t.password===t.confirmPassword)try{c(!0),await l(t.email,t.password,t.name),h("/")}catch{}finally{c(!1)}};return n.jsx(M,{animation:"fade",children:n.jsx(g,{sx:{pt:8},children:n.jsxs(z,{maxWidth:"sm",children:[n.jsx(M,{animation:"slide",delay:.2,children:n.jsxs(g,{sx:{mb:4,textAlign:"center"},children:[n.jsx(f,{variant:"h4",component:"h1",gutterBottom:!0,children:"Регистрация"}),n.jsx(f,{variant:"body1",color:"text.secondary",paragraph:!0,children:"Създайте нов акаунт, за да започнете да споделяте"})]})}),n.jsx(M,{animation:"scale",delay:.4,children:n.jsx(re,{sx:{p:4},children:n.jsx("form",{onSubmit:m,children:n.jsxs(_,{container:!0,spacing:3,children:[n.jsx(_,{item:!0,xs:12,children:n.jsx(U,{fullWidth:!0,label:"Име",value:t.name,onChange:u=>e({...t,name:u.target.value}),required:!0,error:!!d&&!x(t.name),helperText:d&&!x(t.name)?"Моля, въведете валидно име":""})}),n.jsx(_,{item:!0,xs:12,children:n.jsx(U,{fullWidth:!0,label:"Имейл",value:t.email,onChange:u=>e({...t,email:u.target.value}),required:!0,error:!!d&&!x(t.email),helperText:d&&!x(t.email)?"Моля, въведете валиден имейл адрес":""})}),n.jsx(_,{item:!0,xs:12,children:n.jsx(U,{fullWidth:!0,label:"Парола",type:r?"text":"password",value:t.password,onChange:u=>e({...t,password:u.target.value}),required:!0,error:!!d&&!p(t.password),helperText:d&&!p(t.password)?"Паролата трябва да бъде поне 8 символа":"",InputProps:{endAdornment:n.jsx(et,{position:"end",children:n.jsx(G,{"aria-label":"toggle password visibility",onClick:()=>s(!r),edge:"end",children:r?n.jsx(Zt,{}):n.jsx(er,{})})})}})}),n.jsx(_,{item:!0,xs:12,children:n.jsx(U,{fullWidth:!0,label:"Потвърди парола",type:i?"text":"password",value:t.confirmPassword,onChange:u=>e({...t,confirmPassword:u.target.value}),required:!0,error:!!d&&t.password!==t.confirmPassword,helperText:d&&t.password!==t.confirmPassword?"Паролите не съвпадат":"",InputProps:{endAdornment:n.jsx(et,{position:"end",children:n.jsx(G,{"aria-label":"toggle confirm password visibility",onClick:()=>a(!i),edge:"end",children:i?n.jsx(Zt,{}):n.jsx(er,{})})})}})}),n.jsx(_,{item:!0,xs:12,children:n.jsx(M,{animation:"slide",delay:.6,children:n.jsxs(g,{sx:{display:"flex",flexDirection:"column",gap:2},children:[n.jsx(Y,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,disabled:o,children:o?n.jsx(ee,{size:24}):"Регистрация"}),n.jsx(g,{sx:{display:"flex",justifyContent:"center"},children:n.jsx(_e,{component:Me,to:"/login",variant:"body2",children:"Вече имате акаунт? Влезте"})})]})})})]})})})})]})})})},$l=()=>{const[t,e]=b.useState([]),[r,s]=b.useState(!0),[i,a]=b.useState(null),o=async(l,d)=>{try{a(null);const y=he(Q,"listings",l);await os(y,d)}catch(y){throw a("Грешка при обновяване на обявата"),y}},c=async l=>{try{a(null);const d=he(Q,"listings",l);await ze(d)}catch(d){throw a("Грешка при изтриване на обявата"),d}};return b.useEffect(()=>{let l,d=0;const y=3;let h=!0;const x=u=>{if(!h)return;const A=u.docs.map(O=>{var v,k;return{id:O.id,...O.data(),createdAt:(v=O.data().createdAt)==null?void 0:v.toDate(),updatedAt:(k=O.data().updatedAt)==null?void 0:k.toDate()}});e(A),s(!1),d=0},p=async()=>{try{if(!h)return;s(!0),a(null);const u=Ne(Ce(Q,"listings"),nr("createdAt","desc"));try{l=yr(u,A=>{x(A)},A=>{console.error("onSnapshot error:",A),d<y?(d++,console.log(`Retrying connection (attempt ${d}/${y})...`),setTimeout(m,1e3*d)):m()})}catch(A){console.error("Error setting up onSnapshot:",A),m()}}catch(u){console.error("Error in fetchListings:",u),h&&(a("Грешка при зареждане на обявите"),s(!1))}},m=async()=>{try{if(!h)return;const u=Ne(Ce(Q,"listings"),nr("createdAt","desc")),A=await Nt(u);x(A)}catch(u){console.error("Error fetching listings with getDocs:",u),h&&(a("Грешка при зареждане на обявите"),s(!1))}};return p(),()=>{h=!1,l&&l()}},[]),{listings:t,loading:r,error:i,updateListing:o,deleteListing:c}},ql=({listing:t})=>{var r;const e=ae();return n.jsxs(Ae,{sx:{mb:2,cursor:"pointer","&:hover":{boxShadow:6}},onClick:()=>e(`/listing/${t.id}`,{state:{listing:t}}),children:[n.jsx(Be,{component:"img",height:"140",image:((r=t.images)==null?void 0:r[0])||"/book.webp",alt:t.title,sx:{objectFit:"cover",backgroundColor:"grey.100",minHeight:"140px"},onError:s=>{const i=s.target;i.src="/placeholder-image.jpg"}}),n.jsxs(De,{children:[n.jsx(f,{variant:"h6",component:"div",gutterBottom:!0,children:t.title}),n.jsx(f,{variant:"body2",color:"text.secondary",paragraph:!0,children:t.description}),n.jsxs(g,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[n.jsx(be,{label:t.category,size:"small"}),n.jsx(be,{label:t.condition,size:"small"})]}),n.jsxs(f,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:["Публикувано от ",t.userName]})]})]})},Ul=()=>{const{user:t,loading:e}=le(),{listings:r,loading:s}=$l(),i=ae();if(b.useEffect(()=>{!e&&!t&&i("/login")},[t,e,i]),e||!t)return null;const a=r.filter(c=>(console.log("Listing:",c),c.userId===t.uid&&c.status==="active")),o=a.length;return n.jsx(M,{animation:"fade",children:n.jsx(g,{sx:{pt:8},children:n.jsxs(z,{maxWidth:"lg",children:[n.jsx(M,{animation:"slide",delay:.2,children:n.jsxs(g,{sx:{mb:4},children:[n.jsx(f,{variant:"h4",component:"h1",gutterBottom:!0,children:"Профил"}),n.jsx(f,{variant:"body1",color:"text.secondary",paragraph:!0,children:"Управлявайте вашия профил и обяви."})]})}),n.jsxs(_,{container:!0,spacing:4,children:[n.jsx(_,{item:!0,xs:12,md:4,children:n.jsx(M,{animation:"scale",delay:.4,children:n.jsx(Ae,{children:n.jsxs(De,{children:[n.jsxs(g,{sx:{display:"flex",flexDirection:"column",alignItems:"center",mb:3},children:[n.jsx(ke,{sx:{width:100,height:100,mb:2},alt:(t==null?void 0:t.displayName)||"User",src:(t==null?void 0:t.photoURL)||""}),n.jsx(f,{variant:"h6",gutterBottom:!0,children:(t==null?void 0:t.displayName)||"Потребител"}),n.jsx(f,{variant:"body2",color:"text.secondary",children:t==null?void 0:t.email}),n.jsxs(f,{variant:"body2",color:"text.secondary",sx:{mt:1},children:[o," активни обяви"]})]}),n.jsxs(g,{sx:{display:"flex",gap:2},children:[n.jsx(Y,{variant:"outlined",fullWidth:!0,onClick:()=>i("/settings"),children:"Настройки"}),n.jsx(Y,{variant:"outlined",fullWidth:!0,onClick:()=>i("/create-listing"),children:"Нова обява"})]})]})})})}),n.jsx(_,{item:!0,xs:12,md:8,children:n.jsx(M,{animation:"slide",delay:.6,children:n.jsxs(g,{sx:{mb:4},children:[n.jsx(f,{variant:"h5",gutterBottom:!0,children:"Моите обяви"}),s?n.jsx(g,{sx:{display:"flex",justifyContent:"center",py:4},children:n.jsx(ee,{})}):a.length===0?n.jsx(ie,{severity:"info",children:"Все още нямате публикувани обяви."}):n.jsx(_,{container:!0,spacing:3,children:a.map((c,l)=>n.jsx(_,{item:!0,xs:12,sm:6,children:n.jsx(M,{animation:"scale",delay:.8+l*.1,children:n.jsx(ql,{listing:c})})},c.id))})]})})})]})]})})})};var Fr={},zl=J;Object.defineProperty(Fr,"__esModule",{value:!0});var $r=Fr.default=void 0,Vl=zl(Z()),Hl=n;$r=Fr.default=(0,Vl.default)((0,Hl.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M14 13v4h-4v-4H7l5-5 5 5z"}),"CloudUpload");var qr={},Yl=J;Object.defineProperty(qr,"__esModule",{value:!0});var Ur=qr.default=void 0,Gl=Yl(Z()),Kl=n;Ur=qr.default=(0,Gl.default)((0,Kl.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete");const Xl=["Дрехи","Електроника","Книги","Мебели","Спортни стоки","Други"],Ql=["ново","като ново","добро","задоволително","лошо"],Jl=()=>{const{user:t,loading:e}=le(),r=ae(),[s,i]=b.useState(""),[a,o]=b.useState(!1),[c,l]=b.useState(!1),[d,y]=b.useState(!1),[h,x]=b.useState({title:"",description:"",category:"",condition:"",images:[],imagePreviews:[],location:{latitude:0,longitude:0,address:"",region:""},userPhone:"",firstName:"",lastName:"",email:""});b.useEffect(()=>{!e&&!t&&r("/login")},[e,t,r]);const p=()=>(console.log("Validating form..."),console.log("Title:",h.title),console.log("Description:",h.description),console.log("Category:",h.category),console.log("Condition:",h.condition),console.log("Images:",h.images.length),h.title.trim()?h.description.trim()?h.category?h.condition?h.images.length===0?(i("Необходима е поне една снимка"),!1):!0:(i("Състоянието е задължително"),!1):(i("Категорията е задължителна"),!1):(i("Описанието е задължително"),!1):(i("Заглавието е задължително"),!1)),m=v=>{if(v.target.files&&v.target.files.length>0){const k=Array.from(v.target.files),R=k.map(T=>URL.createObjectURL(T));x(T=>({...T,images:[...T.images,...k],imagePreviews:[...T.imagePreviews,...R]}))}},u=v=>{x(k=>({...k,images:k.images.filter((R,T)=>T!==v),imagePreviews:k.imagePreviews.filter((R,T)=>T!==v)}))},A=async v=>{if(!t)return[];try{y(!0);const k=v.map(async R=>{const T=Date.now(),N=R.name.replace(/[^a-zA-Z0-9.-]/g,"_"),$=`${T}-${N}`,D=`listings/${t.uid}/${$}`,I=at(ct,D),C=await ls(I,R);return await ds(C.ref)});return await Promise.all(k)}catch{throw new Error("Грешка при качване на снимките")}finally{y(!1)}},O=async v=>{if(v.preventDefault(),i(""),!!p()){if(!t){i("Трябва да сте влезли в системата, за да създадете обява");return}try{o(!0);const k=await A(h.images);if(!k.length)throw new Error("Грешка при качване на снимките");const R={...h,images:k,status:"active",createdAt:as(),userId:t.uid,userName:t.displayName||"Anonymous",userEmail:t.email},T=await cs(Ce(Q,"listings"),R);l(!0),await new Promise(N=>setTimeout(N,2e3)),r(`/listing/${T.id}`)}catch(k){i(k.message||"Грешка при създаване на обявата. Моля, опитайте отново.")}finally{o(!1)}}};return e?n.jsx(g,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh"},children:n.jsx(ee,{})}):n.jsxs(M,{animation:"fade",children:[n.jsx(g,{sx:{pt:8},children:n.jsxs(z,{maxWidth:"md",children:[n.jsx(M,{animation:"slide",delay:.2,children:n.jsxs(g,{sx:{mb:4},children:[n.jsx(f,{variant:"h4",component:"h1",gutterBottom:!0,children:"Създай нова обява"}),n.jsx(f,{variant:"body1",color:"text.secondary",paragraph:!0,children:"Споделете предмети, които вече не използвате, и помогнете на други хора да ги намерят."})]})}),n.jsx(M,{animation:"scale",delay:.4,children:n.jsx(re,{sx:{p:4},children:n.jsx("form",{onSubmit:O,children:n.jsxs(_,{container:!0,spacing:3,children:[n.jsx(_,{item:!0,xs:12,children:n.jsx(U,{fullWidth:!0,label:"Заглавие",value:h.title,onChange:v=>x({...h,title:v.target.value}),required:!0,error:!!s&&!h.title.trim(),helperText:s&&!h.title.trim()?"Заглавието е задължително":""})}),n.jsx(_,{item:!0,xs:12,children:n.jsxs(M,{animation:"slide",delay:.6,children:[n.jsx(g,{sx:{mb:2},children:n.jsxs(Y,{component:"label",variant:"outlined",startIcon:n.jsx($r,{}),fullWidth:!0,children:["Качи снимки",n.jsx("input",{type:"file",hidden:!0,multiple:!0,accept:"image/*",onChange:m})]})}),h.imagePreviews.length>0&&n.jsx(_,{container:!0,spacing:2,children:h.imagePreviews.map((v,k)=>n.jsx(_,{item:!0,xs:6,sm:4,md:3,children:n.jsxs(g,{sx:{position:"relative"},children:[n.jsx("img",{src:v,alt:`Preview ${k+1}`,style:{width:"100%",height:"150px",objectFit:"cover",borderRadius:"4px"}}),n.jsx(G,{size:"small",sx:{position:"absolute",top:8,right:8,backgroundColor:"rgba(0, 0, 0, 0.5)","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.7)"}},onClick:()=>u(k),children:n.jsx(Ur,{sx:{color:"white"}})})]})},k))}),!!s&&!h.images.length&&n.jsx(f,{color:"error",variant:"body2",sx:{mt:1},children:"Необходима е поне една снимка"})]})}),n.jsx(_,{item:!0,xs:12,children:n.jsx(U,{fullWidth:!0,label:"Описание",value:h.description,onChange:v=>x({...h,description:v.target.value}),multiline:!0,rows:4,required:!0,error:!!s&&!h.description.trim(),helperText:s&&!h.description.trim()?"Описанието е задължително":""})}),n.jsx(_,{item:!0,xs:12,sm:6,children:n.jsxs(tt,{fullWidth:!0,required:!0,error:!!s&&!h.category,children:[n.jsx(rt,{children:"Категория"}),n.jsx(nt,{value:h.category,onChange:v=>x({...h,category:v.target.value}),label:"Категория",children:Xl.map(v=>n.jsx(Te,{value:v,children:v},v))}),s&&!h.category&&n.jsx(jt,{children:s})]})}),n.jsx(_,{item:!0,xs:12,sm:6,children:n.jsxs(tt,{fullWidth:!0,required:!0,error:!!s&&!h.condition,children:[n.jsx(rt,{children:"Състояние"}),n.jsx(nt,{value:h.condition,onChange:v=>x({...h,condition:v.target.value}),label:"Състояние",children:Ql.map(v=>n.jsx(Te,{value:v,children:v},v))}),s&&!h.condition&&n.jsx(jt,{children:s})]})}),n.jsx(_,{item:!0,xs:12,children:n.jsx(M,{animation:"slide",delay:.8,children:n.jsx(U,{label:"Град",value:h.location.address,onChange:v=>x({...h,location:{...h.location,address:v.target.value}}),fullWidth:!0,required:!0,sx:{mb:2}})})}),n.jsx(_,{item:!0,xs:12,children:n.jsx(M,{animation:"slide",delay:.9,children:n.jsx(U,{label:"Регион",value:h.location.region,onChange:v=>x({...h,location:{...h.location,region:v.target.value}}),fullWidth:!0,required:!0,sx:{mb:2}})})}),n.jsx(_,{item:!0,xs:12,sm:6,children:n.jsx(U,{fullWidth:!0,label:"Име",value:h.firstName,onChange:v=>x({...h,firstName:v.target.value}),required:!0})}),n.jsx(_,{item:!0,xs:12,sm:6,children:n.jsx(U,{fullWidth:!0,label:"Фамилия",value:h.lastName,onChange:v=>x({...h,lastName:v.target.value}),required:!0})}),n.jsx(_,{item:!0,xs:12,children:n.jsx(U,{fullWidth:!0,label:"Имейл адрес",value:h.email,onChange:v=>x({...h,email:v.target.value}),required:!0,type:"email"})}),n.jsx(_,{item:!0,xs:12,children:n.jsx(U,{fullWidth:!0,label:"Телефонен номер",value:h.userPhone,onChange:v=>x({...h,userPhone:v.target.value}),placeholder:"+359 888 123 456",helperText:"По избор - за по-лесна комуникация с купувачите"})}),n.jsx(_,{item:!0,xs:12,children:n.jsxs(g,{sx:{display:"flex",gap:2,justifyContent:"flex-end"},children:[n.jsx(Y,{variant:"outlined",onClick:()=>r("/"),children:"Отказ"}),n.jsx(Y,{type:"submit",variant:"contained",color:"primary",disabled:a||d,children:a||d?n.jsx(ee,{size:24}):"Публикувай"})]})})]})})})})]})}),s&&n.jsx(ie,{severity:"error",sx:{mt:2},children:s}),n.jsx(Ln,{open:c,autoHideDuration:2e3,onClose:()=>l(!1),children:n.jsx(ie,{severity:"success",children:"Обявата беше създадена успешно!"})})]})},Zl=()=>{var P,W,q;const t=ha(),e=ae(),{id:r}=Xn(),s=je(),{user:i}=le(),{favorites:a,isFavorite:o}=ut(),[c,l]=Ge.useState(!1),[d,y]=Ge.useState(!1),[h,x]=Ge.useState(!0),[p,m]=Ge.useState(null),[u,A]=Ge.useState(null),[O,v]=b.useState(null),[k,R]=b.useState(!1),[T,N]=b.useState([]),[$,D]=b.useState(!1);b.useEffect(()=>{var oe;const L=async()=>{if(!r){m("ID на обявата не е намерен"),x(!1);return}try{const X=await Bt(he(Q,"listings",r));if(!X.exists()){m("Обявата не е намерена"),x(!1);return}const V={id:X.id,...X.data()};if(A(V),V.userId){D(!0);const me=Ne(Ce(Q,"listings"),it("userId","==",V.userId),it("status","==","active")),Ye=(await Nt(me)).docs.map(ge=>({id:ge.id,...ge.data()})).filter(ge=>ge.id!==r);N(Ye)}}catch(X){m("Грешка при зареждане на обявата"),console.error("Error fetching listing:",X)}finally{x(!1),D(!1)}},K=(oe=t.state)==null?void 0:oe.listing;K?(A(K),x(!1)):L()},[r,t.state,a,o]);const I=()=>{u!=null&&u.id&&e(`/edit-listing/${u.id}`,{state:{listing:u}})},C=async()=>{if(u!=null&&u.id)try{x(!0);const L=he(Q,"listings",u.id);if(await ze(L),u.images&&u.images.length>0)for(const K of u.images)try{const oe=K.split("listings/")[1];if(oe){const X=at(ct,`listings/${oe}`);await br(X)}}catch(oe){console.error("Error deleting image:",oe)}m("Обявата беше изтрита успешно"),e("/my-listings")}catch(L){m("Грешка при изтриване на обявата"),console.error(L)}finally{x(!1),y(!1)}},E=L=>{v(L),l(!0)},w=()=>{l(!1),v(null)},B=()=>{R(!k)},S=L=>{if(!L)return"неизвестна дата";try{return typeof L=="string"?new Date(L).toLocaleDateString("bg-BG",{year:"numeric",month:"long",day:"numeric"}):typeof L=="object"&&"seconds"in L?new Date(L.seconds*1e3).toLocaleDateString("bg-BG",{year:"numeric",month:"long",day:"numeric"}):"неизвестна дата"}catch(K){return console.error("Error formatting date:",K),"неизвестна дата"}};if(h)return n.jsx(z,{children:n.jsx(g,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:n.jsx(ee,{})})});if(p)return n.jsx(z,{children:n.jsx(g,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:n.jsx(ie,{severity:"error",sx:{width:"100%"},children:p})})});if(!u)return n.jsx(z,{children:n.jsx(g,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:n.jsx(ie,{severity:"error",sx:{width:"100%"},children:"Обявата не е намерена"})})});const j=L=>{if(!L)return"Местоположението не е посочено";if(typeof L=="string")return L;const K=L.address||"",oe=K.match(/([^,]+),/);return(oe?oe[1].trim():K)||"Местоположението не е посочено"};return n.jsxs(M,{animation:"fade",children:[n.jsx(g,{sx:{py:4},children:n.jsx(z,{children:n.jsx(M,{animation:"slide",children:n.jsxs(_,{container:!0,spacing:3,children:[n.jsx(_,{item:!0,xs:12,children:n.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[n.jsx(G,{onClick:()=>e(-1),sx:{mr:2},children:n.jsx(Wn,{})}),n.jsx(f,{variant:"h4",component:"h1",sx:{flex:1},children:u.title}),n.jsx(g,{sx:{display:"flex",gap:1},children:(i==null?void 0:i.uid)===u.userId&&n.jsxs(n.Fragment,{children:[n.jsx(G,{onClick:I,color:"primary",children:n.jsx(Vi,{})}),n.jsx(G,{onClick:()=>y(!0),color:"error",children:n.jsx(Fn,{})})]})})]})}),n.jsx(_,{item:!0,xs:12,md:8,children:n.jsxs(re,{sx:{p:3},children:[n.jsx(g,{sx:{mb:3},children:n.jsx(_,{container:!0,spacing:2,children:(P=u.images)==null?void 0:P.map((L,K)=>n.jsx(_,{item:!0,xs:12,sm:6,children:n.jsxs(g,{onClick:()=>E(L),sx:{cursor:"pointer",position:"relative","&:hover":{"&::after":{content:'""',position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.1)",borderRadius:"8px"},"& .zoom-icon":{opacity:1}}},children:[n.jsx("img",{src:L,alt:`${u.title} - Снимка ${K+1}`,style:{width:"100%",height:"300px",objectFit:"cover",borderRadius:"8px"}}),n.jsx(Hi,{className:"zoom-icon",sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"white",fontSize:40,opacity:0,transition:"opacity 0.2s",zIndex:1}})]})},K))})}),n.jsx(f,{variant:"body1",paragraph:!0,children:u.description}),n.jsx(Jt,{sx:{my:3}}),n.jsxs(g,{sx:{display:"flex",flexWrap:"wrap",gap:1,mb:2},children:[u.category&&n.jsx(be,{label:u.category,color:"primary"}),u.condition&&n.jsx(be,{label:u.condition,color:"secondary"}),u.status&&n.jsx(be,{label:u.status,color:u.status==="active"?"success":"default"})]}),u.location&&n.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:3,mt:2,p:2.5,bgcolor:"background.default",borderRadius:1.5,boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},children:[n.jsx(pr,{color:"primary",sx:{fontSize:28}}),n.jsx(f,{variant:"body1",color:"text.primary",sx:{fontWeight:500},children:j(u.location)})]})]})}),n.jsx(_,{item:!0,xs:12,md:4,children:n.jsx(M,{animation:"slide",delay:.4,children:n.jsxs(re,{sx:{p:3},children:[n.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[n.jsx(ke,{sx:{width:64,height:64,bgcolor:"primary.main",fontSize:"1.5rem"},children:((q=(W=u.userName)==null?void 0:W[0])==null?void 0:q.toUpperCase())||"?"}),n.jsxs(g,{children:[n.jsx(f,{variant:"h6",component:"h2",children:u.userName||"Неизвестен потребител"}),n.jsxs(f,{variant:"body2",color:"text.secondary",children:["Член от ",S(u.createdAt)]})]})]}),n.jsx(Jt,{sx:{my:2}}),n.jsxs(g,{sx:{mb:3},children:[n.jsx(f,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Контактна информация"}),n.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[n.jsx(Yi,{color:"action"}),n.jsx(f,{variant:"body2",children:u.userName||"Неизвестен потребител"})]}),n.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[n.jsx(tr,{color:"action"}),n.jsx(f,{variant:"body2",children:u.userEmail})]}),n.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:1},children:[n.jsx(Gi,{color:"action"}),k?n.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:1},children:[n.jsx(f,{variant:"body2",children:u.userPhone||"Няма телефон"}),n.jsx(G,{size:"small",onClick:B,sx:{color:"primary.main","&:hover":{backgroundColor:"transparent"}},children:n.jsx(Zt,{fontSize:"small"})})]}):n.jsx(Y,{variant:"text",size:"small",onClick:B,startIcon:n.jsx(er,{}),sx:{textTransform:"none",color:"primary.main","&:hover":{backgroundColor:"transparent"}},children:"Покажи телефон"})]})]}),n.jsxs(g,{sx:{mb:3},children:[n.jsx(f,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Други обяви от този потребител"}),$?n.jsx(ee,{size:24}):n.jsxs(f,{variant:"body2",children:[T.length," активни обяви"]}),T.length>0&&n.jsx(_,{container:!0,spacing:2,sx:{mt:2},children:T.map(L=>{var K;return n.jsx(_,{item:!0,xs:12,sm:6,children:n.jsxs(Ae,{sx:{cursor:"pointer","&:hover":{boxShadow:s.shadows[4]}},onClick:()=>e(`/listing/${L.id}`),children:[n.jsx(Be,{component:"img",height:"140",image:((K=L.images)==null?void 0:K[0])||"/placeholder-image.jpg",alt:L.title,sx:{objectFit:"cover"}}),n.jsxs(De,{children:[n.jsx(f,{variant:"subtitle1",noWrap:!0,children:L.title}),n.jsx(f,{variant:"body2",color:"text.secondary",noWrap:!0,children:L.description})]})]})},L.id)})})]}),n.jsx(Y,{variant:"contained",color:"primary",fullWidth:!0,startIcon:n.jsx(tr,{}),onClick:()=>window.location.href=`mailto:${u.userEmail}`,disabled:!u.userEmail,children:"Свържи се"})]})})})]})})})}),n.jsx(St,{open:d,onClose:()=>y(!1),children:n.jsxs(M,{animation:"fade",children:[n.jsx(gr,{children:"Потвърди изтриване"}),n.jsx(_t,{children:"Сигурни ли сте, че искате да изтриете тази обява? Това действие не може да бъде отменено."}),n.jsxs(xr,{children:[n.jsx(Y,{onClick:()=>y(!1),children:"Отказ"}),n.jsx(Y,{onClick:C,color:"error",variant:"contained",disabled:h,children:h?n.jsx(ee,{size:24}):"Изтрий"})]})]})}),n.jsx(St,{open:c,onClose:w,maxWidth:"lg",fullWidth:!0,children:n.jsxs(_t,{sx:{p:0,position:"relative"},children:[n.jsx(G,{onClick:w,sx:{position:"absolute",right:8,top:8,color:"white",bgcolor:"rgba(0, 0, 0, 0.5)","&:hover":{bgcolor:"rgba(0, 0, 0, 0.7)"}},children:n.jsx(Ki,{})}),O&&n.jsx("img",{src:O,alt:"Enlarged product",style:{width:"100%",height:"auto",maxHeight:"80vh",objectFit:"contain"}})]})})]})},ed=["Дрехи","Електроника","Книги","Мебели","Спортни стоки","Други"],td=["ново","като ново","добро","задоволително","лошо"],rd={id:"",title:"",description:"",category:"",condition:"",status:"active",images:[],location:{latitude:0,longitude:0,address:"",region:""},userId:"",userName:"",userEmail:"",userPhone:"",firstName:"",lastName:"",createdAt:"",updatedAt:""},nd=()=>{var I,C,E,w,B,S;const{id:t}=Xn(),{user:e,loading:r}=le(),s=ae(),{toggleFavorite:i}=ut(),[a,o]=b.useState(""),[c,l]=b.useState(!1),[d,y]=b.useState(!1),[h,x]=b.useState(!1),[p,m]=b.useState(rd),[u,A]=b.useState([]),[O,v]=b.useState([]);b.useEffect(()=>{if(!r&&!e){s("/login");return}(async()=>{if(t)try{l(!0);const P=he(Q,"listings",t),W=await Bt(P);if(W.exists()){const q=W.data();if(q.userId!==(e==null?void 0:e.uid)){s("/");return}m(q),v(q.images||[])}else o("Обявата не беше намерена")}catch{o("Грешка при зареждане на обявата")}finally{l(!1)}})()},[r,e,s,t]);const k=()=>{var j,P;return(j=p.title)!=null&&j.trim()?(P=p.description)!=null&&P.trim()?p.category?p.condition?(!p.images||p.images.length===0)&&u.length===0?(o("Необходима е поне една снимка"),!1):!0:(o("Състоянието е задължително"),!1):(o("Категорията е задължителна"),!1):(o("Описанието е задължително"),!1):(o("Заглавието е задължително"),!1)},R=j=>{if(j.target.files&&j.target.files.length>0){const P=Array.from(j.target.files),W=P.map(q=>URL.createObjectURL(q));A(q=>[...q,...P]),v(q=>[...q,...W])}},T=async(j,P)=>{A(W=>W.filter((q,L)=>L!==j)),v(W=>W.filter((q,L)=>L!==j))},N=async j=>{if(!e)return[];try{y(!0);const P=j.map(async W=>{const q=Date.now(),L=W.name.replace(/[^a-zA-Z0-9.-]/g,"_"),K=`${q}-${L}`,oe=`listings/${e.uid}/${K}`,X=at(ct,oe),V=await ls(X,W);return await ds(V.ref)});return await Promise.all(P)}catch{throw new Error("Грешка при качване на снимките")}finally{y(!1)}},$=async j=>{if(j.preventDefault(),o(""),!!k()&&!(!e||!t))try{l(!0);let P=p.images||[];if(u.length>0){const q=await N(u);P=[...P,...q]}const W=he(Q,"listings",t);await os(W,{...p,images:P,status:"active",updatedAt:new Date}),s(`/listing/${t}`)}catch{o("Грешка при актуализиране на обявата. Моля, опитайте отново.")}finally{l(!1)}},D=async()=>{if(t)try{if(l(!0),p.images){const j=p.images.map(async P=>{const W=at(ct,P);try{await br(W)}catch(q){console.error("Error deleting image:",q)}});await Promise.all(j)}await ze(he(Q,"listings",t)),await i(t),s("/profile")}catch{o("Грешка при изтриване на обявата. Моля, опитайте отново.")}finally{l(!1),x(!1)}};return c&&!p.title?n.jsx(g,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh"},children:n.jsx(ee,{})}):n.jsxs(M,{animation:"fade",children:[n.jsx(g,{sx:{pt:8},children:n.jsxs(z,{maxWidth:"md",children:[n.jsx(M,{animation:"slide",delay:.2,children:n.jsxs(g,{sx:{mb:4},children:[n.jsx(f,{variant:"h4",component:"h1",gutterBottom:!0,children:"Редактирай обява"}),n.jsx(f,{variant:"body1",color:"text.secondary",paragraph:!0,children:"Актуализирайте информацията за вашата обява."})]})}),n.jsx(M,{animation:"scale",delay:.4,children:n.jsx(re,{sx:{p:4},children:n.jsx("form",{onSubmit:$,children:n.jsxs(_,{container:!0,spacing:3,children:[n.jsx(_,{item:!0,xs:12,children:n.jsx(U,{fullWidth:!0,label:"Заглавие",value:p.title,onChange:j=>m({...p,title:j.target.value}),required:!0,error:!!a&&!((I=p.title)!=null&&I.trim()),helperText:a&&!((C=p.title)!=null&&C.trim())?"Заглавието е задължително":""})}),n.jsxs(_,{item:!0,xs:12,children:[n.jsx(g,{sx:{mb:2},children:n.jsxs(Y,{component:"label",variant:"outlined",startIcon:n.jsx($r,{}),fullWidth:!0,children:["Качи снимки",n.jsx("input",{type:"file",hidden:!0,multiple:!0,accept:"image/*",onChange:R})]})}),O.length>0&&n.jsx(_,{container:!0,spacing:2,children:O.map((j,P)=>n.jsx(_,{item:!0,xs:6,sm:4,md:3,children:n.jsxs(g,{sx:{position:"relative"},children:[n.jsx("img",{src:j,alt:`Preview ${P+1}`,style:{width:"100%",height:"150px",objectFit:"cover",borderRadius:"4px"}}),n.jsx(G,{size:"small",sx:{position:"absolute",top:8,right:8,backgroundColor:"rgba(0, 0, 0, 0.5)","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.7)"}},onClick:()=>T(P),children:n.jsx(Ur,{sx:{color:"white"}})})]})},P))}),!!a&&(!p.images||p.images.length===0)&&u.length===0&&n.jsx(f,{color:"error",variant:"body2",sx:{mt:1},children:"Необходима е поне една снимка"})]}),n.jsx(_,{item:!0,xs:12,children:n.jsx(U,{fullWidth:!0,label:"Описание",value:p.description,onChange:j=>m({...p,description:j.target.value}),multiline:!0,rows:4,required:!0,error:!!a&&!((E=p.description)!=null&&E.trim()),helperText:a&&!((w=p.description)!=null&&w.trim())?"Описанието е задължително":""})}),n.jsx(_,{item:!0,xs:12,sm:6,children:n.jsxs(tt,{fullWidth:!0,required:!0,error:!!a&&!p.category,children:[n.jsx(rt,{children:"Категория"}),n.jsx(nt,{value:p.category,onChange:j=>m({...p,category:j.target.value}),label:"Категория",children:ed.map(j=>n.jsx(Te,{value:j,children:j},j))}),a&&!p.category&&n.jsx(jt,{children:a})]})}),n.jsx(_,{item:!0,xs:12,sm:6,children:n.jsxs(tt,{fullWidth:!0,required:!0,error:!!a&&!p.condition,children:[n.jsx(rt,{children:"Състояние"}),n.jsx(nt,{value:p.condition,onChange:j=>m({...p,condition:j.target.value}),label:"Състояние",children:td.map(j=>n.jsx(Te,{value:j,children:j},j))}),a&&!p.condition&&n.jsx(jt,{children:a})]})}),n.jsx(_,{item:!0,xs:12,children:n.jsx(U,{label:"Град",value:(B=p.location)==null?void 0:B.address,onChange:j=>m({...p,location:{...p.location,address:j.target.value}}),fullWidth:!0,required:!0,sx:{mb:2}})}),n.jsx(_,{item:!0,xs:12,children:n.jsx(U,{label:"Регион",value:(S=p.location)==null?void 0:S.region,onChange:j=>m({...p,location:{...p.location,region:j.target.value}}),fullWidth:!0,required:!0,sx:{mb:2}})}),n.jsx(_,{item:!0,xs:12,sm:6,children:n.jsx(U,{fullWidth:!0,label:"Име",value:p.firstName,onChange:j=>m({...p,firstName:j.target.value}),required:!0})}),n.jsx(_,{item:!0,xs:12,sm:6,children:n.jsx(U,{fullWidth:!0,label:"Фамилия",value:p.lastName,onChange:j=>m({...p,lastName:j.target.value}),required:!0})}),n.jsx(_,{item:!0,xs:12,children:n.jsx(U,{fullWidth:!0,label:"Имейл адрес",value:p.userEmail,onChange:j=>m({...p,userEmail:j.target.value}),required:!0,type:"email"})}),n.jsx(_,{item:!0,xs:12,children:n.jsx(U,{fullWidth:!0,label:"Телефонен номер",value:p.userPhone,onChange:j=>m({...p,userPhone:j.target.value}),placeholder:"+359 888 123 456",helperText:"По избор - за по-лесна комуникация с купувачите"})}),n.jsx(_,{item:!0,xs:12,children:n.jsxs(g,{sx:{display:"flex",gap:2,justifyContent:"flex-end"},children:[n.jsx(Y,{variant:"outlined",onClick:()=>s("/"),children:"Отказ"}),n.jsx(Y,{type:"submit",variant:"contained",color:"primary",disabled:c||d,children:c||d?n.jsx(ee,{size:24}):"Запази промените"})]})})]})})})})]})}),n.jsx(St,{open:h,onClose:()=>x(!1),children:n.jsxs(M,{animation:"fade",children:[n.jsx(gr,{children:"Потвърди изтриване"}),n.jsx(_t,{children:"Сигурни ли сте, че искате да изтриете тази обява? Това действие не може да бъде отменено."}),n.jsxs(xr,{children:[n.jsx(Y,{onClick:()=>x(!1),children:"Отказ"}),n.jsx(Y,{onClick:D,color:"error",variant:"contained",disabled:c,children:c?n.jsx(ee,{size:24}):"Изтрий"})]})]})})]})};function sd(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var pi=sd,id=typeof ft=="object"&&ft&&ft.Object===Object&&ft,ad=id,od=ad,cd=typeof self=="object"&&self&&self.Object===Object&&self,ld=od||cd||Function("return this")(),gi=ld,dd=gi,ud=function(){return dd.Date.now()},hd=ud,fd=/\s/;function md(t){for(var e=t.length;e--&&fd.test(t.charAt(e)););return e}var pd=md,gd=pd,xd=/^\s+/;function yd(t){return t&&t.slice(0,gd(t)+1).replace(xd,"")}var bd=yd,vd=gi,wd=vd.Symbol,xi=wd,Cn=xi,yi=Object.prototype,jd=yi.hasOwnProperty,Sd=yi.toString,Xe=Cn?Cn.toStringTag:void 0;function _d(t){var e=jd.call(t,Xe),r=t[Xe];try{t[Xe]=void 0;var s=!0}catch{}var i=Sd.call(t);return s&&(e?t[Xe]=r:delete t[Xe]),i}var Cd=_d,Ed=Object.prototype,kd=Ed.toString;function Id(t){return kd.call(t)}var Ad=Id,En=xi,Dd=Cd,Td=Ad,Pd="[object Null]",Rd="[object Undefined]",kn=En?En.toStringTag:void 0;function Od(t){return t==null?t===void 0?Rd:Pd:kn&&kn in Object(t)?Dd(t):Td(t)}var Md=Od;function Bd(t){return t!=null&&typeof t=="object"}var Nd=Bd,Ld=Md,Wd=Nd,Fd="[object Symbol]";function $d(t){return typeof t=="symbol"||Wd(t)&&Ld(t)==Fd}var qd=$d,Ud=bd,In=pi,zd=qd,An=NaN,Vd=/^[-+]0x[0-9a-f]+$/i,Hd=/^0b[01]+$/i,Yd=/^0o[0-7]+$/i,Gd=parseInt;function Kd(t){if(typeof t=="number")return t;if(zd(t))return An;if(In(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=In(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=Ud(t);var r=Hd.test(t);return r||Yd.test(t)?Gd(t.slice(2),r?2:8):Vd.test(t)?An:+t}var Xd=Kd,Qd=pi,Qt=hd,Dn=Xd,Jd="Expected a function",Zd=Math.max,eu=Math.min;function tu(t,e,r){var s,i,a,o,c,l,d=0,y=!1,h=!1,x=!0;if(typeof t!="function")throw new TypeError(Jd);e=Dn(e)||0,Qd(r)&&(y=!!r.leading,h="maxWait"in r,a=h?Zd(Dn(r.maxWait)||0,e):a,x="trailing"in r?!!r.trailing:x);function p(N){var $=s,D=i;return s=i=void 0,d=N,o=t.apply(D,$),o}function m(N){return d=N,c=setTimeout(O,e),y?p(N):o}function u(N){var $=N-l,D=N-d,I=e-$;return h?eu(I,a-D):I}function A(N){var $=N-l,D=N-d;return l===void 0||$>=e||$<0||h&&D>=a}function O(){var N=Qt();if(A(N))return v(N);c=setTimeout(O,u(N))}function v(N){return c=void 0,x&&s?p(N):(s=i=void 0,o)}function k(){c!==void 0&&clearTimeout(c),d=0,s=l=i=c=void 0}function R(){return c===void 0?o:v(Qt())}function T(){var N=Qt(),$=A(N);if(s=arguments,i=this,l=N,$){if(c===void 0)return m(l);if(h)return clearTimeout(c),c=setTimeout(O,e),p(l)}return c===void 0&&(c=setTimeout(O,e)),o}return T.cancel=k,T.flush=R,T}var ru=tu;const nu=fa(ru),bi=6048e5,su=864e5,gt=43200,Tn=1440,Pn=Symbol.for("constructDateFrom");function fe(t,e){return typeof t=="function"?t(e):t&&typeof t=="object"&&Pn in t?t[Pn](e):t instanceof Date?new t.constructor(e):new Date(e)}function te(t,e){return fe(e||t,t)}function iu(t,e,r){const s=te(t,r==null?void 0:r.in);return isNaN(e)?fe(t,NaN):(s.setDate(s.getDate()+e),s)}let au={};function ht(){return au}function Fe(t,e){var c,l,d,y;const r=ht(),s=(e==null?void 0:e.weekStartsOn)??((l=(c=e==null?void 0:e.locale)==null?void 0:c.options)==null?void 0:l.weekStartsOn)??r.weekStartsOn??((y=(d=r.locale)==null?void 0:d.options)==null?void 0:y.weekStartsOn)??0,i=te(t,e==null?void 0:e.in),a=i.getDay(),o=(a<s?7:0)+a-s;return i.setDate(i.getDate()-o),i.setHours(0,0,0,0),i}function Tt(t,e){return Fe(t,{...e,weekStartsOn:1})}function vi(t,e){const r=te(t,e==null?void 0:e.in),s=r.getFullYear(),i=fe(r,0);i.setFullYear(s+1,0,4),i.setHours(0,0,0,0);const a=Tt(i),o=fe(r,0);o.setFullYear(s,0,4),o.setHours(0,0,0,0);const c=Tt(o);return r.getTime()>=a.getTime()?s+1:r.getTime()>=c.getTime()?s:s-1}function Pt(t){const e=te(t),r=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return r.setUTCFullYear(e.getFullYear()),+t-+r}function He(t,...e){const r=fe.bind(null,t||e.find(s=>typeof s=="object"));return e.map(r)}function Rt(t,e){const r=te(t,e==null?void 0:e.in);return r.setHours(0,0,0,0),r}function ou(t,e,r){const[s,i]=He(r==null?void 0:r.in,t,e),a=Rt(s),o=Rt(i),c=+a-Pt(a),l=+o-Pt(o);return Math.round((c-l)/su)}function cu(t,e){const r=vi(t,e),s=fe(t,0);return s.setFullYear(r,0,4),s.setHours(0,0,0,0),Tt(s)}function wt(t,e){const r=+te(t)-+te(e);return r<0?-1:r>0?1:r}function zr(t){return fe(t,Date.now())}function wi(t,e,r){const[s,i]=He(r==null?void 0:r.in,t,e);return+Rt(s)==+Rt(i)}function lu(t){return t instanceof Date||typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]"}function ji(t){return!(!lu(t)&&typeof t!="number"||isNaN(+te(t)))}function du(t,e,r){const[s,i]=He(r==null?void 0:r.in,t,e),a=s.getFullYear()-i.getFullYear(),o=s.getMonth()-i.getMonth();return a*12+o}function uu(t){return e=>{const s=(t?Math[t]:Math.trunc)(e);return s===0?0:s}}function hu(t,e){return+te(t)-+te(e)}function fu(t,e){const r=te(t,e==null?void 0:e.in);return r.setHours(23,59,59,999),r}function mu(t,e){const r=te(t,e==null?void 0:e.in),s=r.getMonth();return r.setFullYear(r.getFullYear(),s+1,0),r.setHours(23,59,59,999),r}function pu(t,e){const r=te(t,e==null?void 0:e.in);return+fu(r,e)==+mu(r,e)}function gu(t,e,r){const[s,i,a]=He(r==null?void 0:r.in,t,t,e),o=wt(i,a),c=Math.abs(du(i,a));if(c<1)return 0;i.getMonth()===1&&i.getDate()>27&&i.setDate(30),i.setMonth(i.getMonth()-o*c);let l=wt(i,a)===-o;pu(s)&&c===1&&wt(s,a)===1&&(l=!1);const d=o*(c-+l);return d===0?0:d}function xu(t,e,r){const s=hu(t,e)/1e3;return uu(r==null?void 0:r.roundingMethod)(s)}function yu(t,e){const r=te(t,e==null?void 0:e.in);return r.setFullYear(r.getFullYear(),0,1),r.setHours(0,0,0,0),r}const bu={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},vu=(t,e,r)=>{let s;const i=bu[t];return typeof i=="string"?s=i:e===1?s=i.one:s=i.other.replace("{{count}}",e.toString()),r!=null&&r.addSuffix?r.comparison&&r.comparison>0?"in "+s:s+" ago":s};function Ue(t){return(e={})=>{const r=e.width?String(e.width):t.defaultWidth;return t.formats[r]||t.formats[t.defaultWidth]}}const wu={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},ju={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Su={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},_u={date:Ue({formats:wu,defaultWidth:"full"}),time:Ue({formats:ju,defaultWidth:"full"}),dateTime:Ue({formats:Su,defaultWidth:"full"})},Cu={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Eu=(t,e,r,s)=>Cu[t];function xe(t){return(e,r)=>{const s=r!=null&&r.context?String(r.context):"standalone";let i;if(s==="formatting"&&t.formattingValues){const o=t.defaultFormattingWidth||t.defaultWidth,c=r!=null&&r.width?String(r.width):o;i=t.formattingValues[c]||t.formattingValues[o]}else{const o=t.defaultWidth,c=r!=null&&r.width?String(r.width):t.defaultWidth;i=t.values[c]||t.values[o]}const a=t.argumentCallback?t.argumentCallback(e):e;return i[a]}}const ku={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Iu={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Au={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Du={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Tu={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Pu={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Ru=(t,e)=>{const r=Number(t),s=r%100;if(s>20||s<10)switch(s%10){case 1:return r+"st";case 2:return r+"nd";case 3:return r+"rd"}return r+"th"},Ou={ordinalNumber:Ru,era:xe({values:ku,defaultWidth:"wide"}),quarter:xe({values:Iu,defaultWidth:"wide",argumentCallback:t=>t-1}),month:xe({values:Au,defaultWidth:"wide"}),day:xe({values:Du,defaultWidth:"wide"}),dayPeriod:xe({values:Tu,defaultWidth:"wide",formattingValues:Pu,defaultFormattingWidth:"wide"})};function ye(t){return(e,r={})=>{const s=r.width,i=s&&t.matchPatterns[s]||t.matchPatterns[t.defaultMatchWidth],a=e.match(i);if(!a)return null;const o=a[0],c=s&&t.parsePatterns[s]||t.parsePatterns[t.defaultParseWidth],l=Array.isArray(c)?Bu(c,h=>h.test(o)):Mu(c,h=>h.test(o));let d;d=t.valueCallback?t.valueCallback(l):l,d=r.valueCallback?r.valueCallback(d):d;const y=e.slice(o.length);return{value:d,rest:y}}}function Mu(t,e){for(const r in t)if(Object.prototype.hasOwnProperty.call(t,r)&&e(t[r]))return r}function Bu(t,e){for(let r=0;r<t.length;r++)if(e(t[r]))return r}function Si(t){return(e,r={})=>{const s=e.match(t.matchPattern);if(!s)return null;const i=s[0],a=e.match(t.parsePattern);if(!a)return null;let o=t.valueCallback?t.valueCallback(a[0]):a[0];o=r.valueCallback?r.valueCallback(o):o;const c=e.slice(i.length);return{value:o,rest:c}}}const Nu=/^(\d+)(th|st|nd|rd)?/i,Lu=/\d+/i,Wu={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Fu={any:[/^b/i,/^(a|c)/i]},$u={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},qu={any:[/1/i,/2/i,/3/i,/4/i]},Uu={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},zu={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Vu={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Hu={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Yu={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Gu={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Ku={ordinalNumber:Si({matchPattern:Nu,parsePattern:Lu,valueCallback:t=>parseInt(t,10)}),era:ye({matchPatterns:Wu,defaultMatchWidth:"wide",parsePatterns:Fu,defaultParseWidth:"any"}),quarter:ye({matchPatterns:$u,defaultMatchWidth:"wide",parsePatterns:qu,defaultParseWidth:"any",valueCallback:t=>t+1}),month:ye({matchPatterns:Uu,defaultMatchWidth:"wide",parsePatterns:zu,defaultParseWidth:"any"}),day:ye({matchPatterns:Vu,defaultMatchWidth:"wide",parsePatterns:Hu,defaultParseWidth:"any"}),dayPeriod:ye({matchPatterns:Yu,defaultMatchWidth:"any",parsePatterns:Gu,defaultParseWidth:"any"})},_i={code:"en-US",formatDistance:vu,formatLong:_u,formatRelative:Eu,localize:Ou,match:Ku,options:{weekStartsOn:0,firstWeekContainsDate:1}};function Xu(t,e){const r=te(t,e==null?void 0:e.in);return ou(r,yu(r))+1}function Qu(t,e){const r=te(t,e==null?void 0:e.in),s=+Tt(r)-+cu(r);return Math.round(s/bi)+1}function Ci(t,e){var y,h,x,p;const r=te(t,e==null?void 0:e.in),s=r.getFullYear(),i=ht(),a=(e==null?void 0:e.firstWeekContainsDate)??((h=(y=e==null?void 0:e.locale)==null?void 0:y.options)==null?void 0:h.firstWeekContainsDate)??i.firstWeekContainsDate??((p=(x=i.locale)==null?void 0:x.options)==null?void 0:p.firstWeekContainsDate)??1,o=fe((e==null?void 0:e.in)||t,0);o.setFullYear(s+1,0,a),o.setHours(0,0,0,0);const c=Fe(o,e),l=fe((e==null?void 0:e.in)||t,0);l.setFullYear(s,0,a),l.setHours(0,0,0,0);const d=Fe(l,e);return+r>=+c?s+1:+r>=+d?s:s-1}function Ju(t,e){var c,l,d,y;const r=ht(),s=(e==null?void 0:e.firstWeekContainsDate)??((l=(c=e==null?void 0:e.locale)==null?void 0:c.options)==null?void 0:l.firstWeekContainsDate)??r.firstWeekContainsDate??((y=(d=r.locale)==null?void 0:d.options)==null?void 0:y.firstWeekContainsDate)??1,i=Ci(t,e),a=fe((e==null?void 0:e.in)||t,0);return a.setFullYear(i,0,s),a.setHours(0,0,0,0),Fe(a,e)}function Zu(t,e){const r=te(t,e==null?void 0:e.in),s=+Fe(r,e)-+Ju(r,e);return Math.round(s/bi)+1}function H(t,e){const r=t<0?"-":"",s=Math.abs(t).toString().padStart(e,"0");return r+s}const Ee={y(t,e){const r=t.getFullYear(),s=r>0?r:1-r;return H(e==="yy"?s%100:s,e.length)},M(t,e){const r=t.getMonth();return e==="M"?String(r+1):H(r+1,2)},d(t,e){return H(t.getDate(),e.length)},a(t,e){const r=t.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return r.toUpperCase();case"aaa":return r;case"aaaaa":return r[0];case"aaaa":default:return r==="am"?"a.m.":"p.m."}},h(t,e){return H(t.getHours()%12||12,e.length)},H(t,e){return H(t.getHours(),e.length)},m(t,e){return H(t.getMinutes(),e.length)},s(t,e){return H(t.getSeconds(),e.length)},S(t,e){const r=e.length,s=t.getMilliseconds(),i=Math.trunc(s*Math.pow(10,r-3));return H(i,e.length)}},$e={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Rn={G:function(t,e,r){const s=t.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return r.era(s,{width:"abbreviated"});case"GGGGG":return r.era(s,{width:"narrow"});case"GGGG":default:return r.era(s,{width:"wide"})}},y:function(t,e,r){if(e==="yo"){const s=t.getFullYear(),i=s>0?s:1-s;return r.ordinalNumber(i,{unit:"year"})}return Ee.y(t,e)},Y:function(t,e,r,s){const i=Ci(t,s),a=i>0?i:1-i;if(e==="YY"){const o=a%100;return H(o,2)}return e==="Yo"?r.ordinalNumber(a,{unit:"year"}):H(a,e.length)},R:function(t,e){const r=vi(t);return H(r,e.length)},u:function(t,e){const r=t.getFullYear();return H(r,e.length)},Q:function(t,e,r){const s=Math.ceil((t.getMonth()+1)/3);switch(e){case"Q":return String(s);case"QQ":return H(s,2);case"Qo":return r.ordinalNumber(s,{unit:"quarter"});case"QQQ":return r.quarter(s,{width:"abbreviated",context:"formatting"});case"QQQQQ":return r.quarter(s,{width:"narrow",context:"formatting"});case"QQQQ":default:return r.quarter(s,{width:"wide",context:"formatting"})}},q:function(t,e,r){const s=Math.ceil((t.getMonth()+1)/3);switch(e){case"q":return String(s);case"qq":return H(s,2);case"qo":return r.ordinalNumber(s,{unit:"quarter"});case"qqq":return r.quarter(s,{width:"abbreviated",context:"standalone"});case"qqqqq":return r.quarter(s,{width:"narrow",context:"standalone"});case"qqqq":default:return r.quarter(s,{width:"wide",context:"standalone"})}},M:function(t,e,r){const s=t.getMonth();switch(e){case"M":case"MM":return Ee.M(t,e);case"Mo":return r.ordinalNumber(s+1,{unit:"month"});case"MMM":return r.month(s,{width:"abbreviated",context:"formatting"});case"MMMMM":return r.month(s,{width:"narrow",context:"formatting"});case"MMMM":default:return r.month(s,{width:"wide",context:"formatting"})}},L:function(t,e,r){const s=t.getMonth();switch(e){case"L":return String(s+1);case"LL":return H(s+1,2);case"Lo":return r.ordinalNumber(s+1,{unit:"month"});case"LLL":return r.month(s,{width:"abbreviated",context:"standalone"});case"LLLLL":return r.month(s,{width:"narrow",context:"standalone"});case"LLLL":default:return r.month(s,{width:"wide",context:"standalone"})}},w:function(t,e,r,s){const i=Zu(t,s);return e==="wo"?r.ordinalNumber(i,{unit:"week"}):H(i,e.length)},I:function(t,e,r){const s=Qu(t);return e==="Io"?r.ordinalNumber(s,{unit:"week"}):H(s,e.length)},d:function(t,e,r){return e==="do"?r.ordinalNumber(t.getDate(),{unit:"date"}):Ee.d(t,e)},D:function(t,e,r){const s=Xu(t);return e==="Do"?r.ordinalNumber(s,{unit:"dayOfYear"}):H(s,e.length)},E:function(t,e,r){const s=t.getDay();switch(e){case"E":case"EE":case"EEE":return r.day(s,{width:"abbreviated",context:"formatting"});case"EEEEE":return r.day(s,{width:"narrow",context:"formatting"});case"EEEEEE":return r.day(s,{width:"short",context:"formatting"});case"EEEE":default:return r.day(s,{width:"wide",context:"formatting"})}},e:function(t,e,r,s){const i=t.getDay(),a=(i-s.weekStartsOn+8)%7||7;switch(e){case"e":return String(a);case"ee":return H(a,2);case"eo":return r.ordinalNumber(a,{unit:"day"});case"eee":return r.day(i,{width:"abbreviated",context:"formatting"});case"eeeee":return r.day(i,{width:"narrow",context:"formatting"});case"eeeeee":return r.day(i,{width:"short",context:"formatting"});case"eeee":default:return r.day(i,{width:"wide",context:"formatting"})}},c:function(t,e,r,s){const i=t.getDay(),a=(i-s.weekStartsOn+8)%7||7;switch(e){case"c":return String(a);case"cc":return H(a,e.length);case"co":return r.ordinalNumber(a,{unit:"day"});case"ccc":return r.day(i,{width:"abbreviated",context:"standalone"});case"ccccc":return r.day(i,{width:"narrow",context:"standalone"});case"cccccc":return r.day(i,{width:"short",context:"standalone"});case"cccc":default:return r.day(i,{width:"wide",context:"standalone"})}},i:function(t,e,r){const s=t.getDay(),i=s===0?7:s;switch(e){case"i":return String(i);case"ii":return H(i,e.length);case"io":return r.ordinalNumber(i,{unit:"day"});case"iii":return r.day(s,{width:"abbreviated",context:"formatting"});case"iiiii":return r.day(s,{width:"narrow",context:"formatting"});case"iiiiii":return r.day(s,{width:"short",context:"formatting"});case"iiii":default:return r.day(s,{width:"wide",context:"formatting"})}},a:function(t,e,r){const i=t.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return r.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"aaa":return r.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return r.dayPeriod(i,{width:"narrow",context:"formatting"});case"aaaa":default:return r.dayPeriod(i,{width:"wide",context:"formatting"})}},b:function(t,e,r){const s=t.getHours();let i;switch(s===12?i=$e.noon:s===0?i=$e.midnight:i=s/12>=1?"pm":"am",e){case"b":case"bb":return r.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"bbb":return r.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return r.dayPeriod(i,{width:"narrow",context:"formatting"});case"bbbb":default:return r.dayPeriod(i,{width:"wide",context:"formatting"})}},B:function(t,e,r){const s=t.getHours();let i;switch(s>=17?i=$e.evening:s>=12?i=$e.afternoon:s>=4?i=$e.morning:i=$e.night,e){case"B":case"BB":case"BBB":return r.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"BBBBB":return r.dayPeriod(i,{width:"narrow",context:"formatting"});case"BBBB":default:return r.dayPeriod(i,{width:"wide",context:"formatting"})}},h:function(t,e,r){if(e==="ho"){let s=t.getHours()%12;return s===0&&(s=12),r.ordinalNumber(s,{unit:"hour"})}return Ee.h(t,e)},H:function(t,e,r){return e==="Ho"?r.ordinalNumber(t.getHours(),{unit:"hour"}):Ee.H(t,e)},K:function(t,e,r){const s=t.getHours()%12;return e==="Ko"?r.ordinalNumber(s,{unit:"hour"}):H(s,e.length)},k:function(t,e,r){let s=t.getHours();return s===0&&(s=24),e==="ko"?r.ordinalNumber(s,{unit:"hour"}):H(s,e.length)},m:function(t,e,r){return e==="mo"?r.ordinalNumber(t.getMinutes(),{unit:"minute"}):Ee.m(t,e)},s:function(t,e,r){return e==="so"?r.ordinalNumber(t.getSeconds(),{unit:"second"}):Ee.s(t,e)},S:function(t,e){return Ee.S(t,e)},X:function(t,e,r){const s=t.getTimezoneOffset();if(s===0)return"Z";switch(e){case"X":return Mn(s);case"XXXX":case"XX":return Re(s);case"XXXXX":case"XXX":default:return Re(s,":")}},x:function(t,e,r){const s=t.getTimezoneOffset();switch(e){case"x":return Mn(s);case"xxxx":case"xx":return Re(s);case"xxxxx":case"xxx":default:return Re(s,":")}},O:function(t,e,r){const s=t.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+On(s,":");case"OOOO":default:return"GMT"+Re(s,":")}},z:function(t,e,r){const s=t.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+On(s,":");case"zzzz":default:return"GMT"+Re(s,":")}},t:function(t,e,r){const s=Math.trunc(+t/1e3);return H(s,e.length)},T:function(t,e,r){return H(+t,e.length)}};function On(t,e=""){const r=t>0?"-":"+",s=Math.abs(t),i=Math.trunc(s/60),a=s%60;return a===0?r+String(i):r+String(i)+e+H(a,2)}function Mn(t,e){return t%60===0?(t>0?"-":"+")+H(Math.abs(t)/60,2):Re(t,e)}function Re(t,e=""){const r=t>0?"-":"+",s=Math.abs(t),i=H(Math.trunc(s/60),2),a=H(s%60,2);return r+i+e+a}const Bn=(t,e)=>{switch(t){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},Ei=(t,e)=>{switch(t){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},eh=(t,e)=>{const r=t.match(/(P+)(p+)?/)||[],s=r[1],i=r[2];if(!i)return Bn(t,e);let a;switch(s){case"P":a=e.dateTime({width:"short"});break;case"PP":a=e.dateTime({width:"medium"});break;case"PPP":a=e.dateTime({width:"long"});break;case"PPPP":default:a=e.dateTime({width:"full"});break}return a.replace("{{date}}",Bn(s,e)).replace("{{time}}",Ei(i,e))},th={p:Ei,P:eh},rh=/^D+$/,nh=/^Y+$/,sh=["D","DD","YY","YYYY"];function ih(t){return rh.test(t)}function ah(t){return nh.test(t)}function oh(t,e,r){const s=ch(t,e,r);if(console.warn(s),sh.includes(t))throw new RangeError(s)}function ch(t,e,r){const s=t[0]==="Y"?"years":"days of the month";return`Use \`${t.toLowerCase()}\` instead of \`${t}\` (in \`${e}\`) for formatting ${s} to the input \`${r}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const lh=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,dh=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,uh=/^'([^]*?)'?$/,hh=/''/g,fh=/[a-zA-Z]/;function Ot(t,e,r){var y,h,x,p;const s=ht(),i=s.locale??_i,a=s.firstWeekContainsDate??((h=(y=s.locale)==null?void 0:y.options)==null?void 0:h.firstWeekContainsDate)??1,o=s.weekStartsOn??((p=(x=s.locale)==null?void 0:x.options)==null?void 0:p.weekStartsOn)??0,c=te(t,r==null?void 0:r.in);if(!ji(c))throw new RangeError("Invalid time value");let l=e.match(dh).map(m=>{const u=m[0];if(u==="p"||u==="P"){const A=th[u];return A(m,i.formatLong)}return m}).join("").match(lh).map(m=>{if(m==="''")return{isToken:!1,value:"'"};const u=m[0];if(u==="'")return{isToken:!1,value:mh(m)};if(Rn[u])return{isToken:!0,value:m};if(u.match(fh))throw new RangeError("Format string contains an unescaped latin alphabet character `"+u+"`");return{isToken:!1,value:m}});i.localize.preprocessor&&(l=i.localize.preprocessor(c,l));const d={firstWeekContainsDate:a,weekStartsOn:o,locale:i};return l.map(m=>{if(!m.isToken)return m.value;const u=m.value;(ah(u)||ih(u))&&oh(u,e,String(t));const A=Rn[u[0]];return A(c,u,i.localize,d)}).join("")}function mh(t){const e=t.match(uh);return e?e[1].replace(hh,"'"):t}function ph(t,e,r){const s=ht(),i=(r==null?void 0:r.locale)??s.locale??_i,a=2520,o=wt(t,e);if(isNaN(o))throw new RangeError("Invalid time value");const c=Object.assign({},r,{addSuffix:r==null?void 0:r.addSuffix,comparison:o}),[l,d]=He(r==null?void 0:r.in,...o>0?[e,t]:[t,e]),y=xu(d,l),h=(Pt(d)-Pt(l))/1e3,x=Math.round((y-h)/60);let p;if(x<2)return r!=null&&r.includeSeconds?y<5?i.formatDistance("lessThanXSeconds",5,c):y<10?i.formatDistance("lessThanXSeconds",10,c):y<20?i.formatDistance("lessThanXSeconds",20,c):y<40?i.formatDistance("halfAMinute",0,c):y<60?i.formatDistance("lessThanXMinutes",1,c):i.formatDistance("xMinutes",1,c):x===0?i.formatDistance("lessThanXMinutes",1,c):i.formatDistance("xMinutes",x,c);if(x<45)return i.formatDistance("xMinutes",x,c);if(x<90)return i.formatDistance("aboutXHours",1,c);if(x<Tn){const m=Math.round(x/60);return i.formatDistance("aboutXHours",m,c)}else{if(x<a)return i.formatDistance("xDays",1,c);if(x<gt){const m=Math.round(x/Tn);return i.formatDistance("xDays",m,c)}else if(x<gt*2)return p=Math.round(x/gt),i.formatDistance("aboutXMonths",p,c)}if(p=gu(d,l),p<12){const m=Math.round(x/gt);return i.formatDistance("xMonths",m,c)}else{const m=p%12,u=Math.trunc(p/12);return m<3?i.formatDistance("aboutXYears",u,c):m<9?i.formatDistance("overXYears",u,c):i.formatDistance("almostXYears",u+1,c)}}function lt(t,e){return ph(t,zr(t),e)}function ki(t,e,r){const[s,i]=He(r==null?void 0:r.in,t,e);return+Fe(s,r)==+Fe(i,r)}function Ii(t,e){return wi(fe(t,t),zr(t))}function gh(t,e,r){return iu(t,-1,r)}function Ai(t,e){return wi(fe(t,t),gh(zr(t)))}const xh=()=>{const[t,e]=ma(),r=ae(),s=je(),[i,a]=b.useState(t.get("q")||""),[o,c]=b.useState([]),[l,d]=b.useState(!1),[y,h]=b.useState(""),[x,p]=b.useState(t.get("category")||"all"),{toggleFavorite:m,isFavorite:u}=ut(),[A,O]=b.useState(!1),[v,k]=b.useState(""),R=["all","Дрехи","Електроника","Книги","Мебели","Спортни стоки","Други"],T={all:"all",clothing:"Дрехи",electronics:"Електроника",books:"Книги",furniture:"Мебели",sports:"Спортни стоки",other:"Други",Дрехи:"Дрехи",Електроника:"Електроника",Книги:"Книги",Мебели:"Мебели","Спортни стоки":"Спортни стоки",Други:"Други"},N=[...new Set([...R,...o.map(S=>S.category)])];b.useEffect(()=>{const S=t.get("category");S&&p(T[S.toLowerCase()]||"all")},[t]);const $=S=>{const j=S.target.value;p(j);const P=t.get("q"),W={};P&&(W.q=P),j!=="all"&&(W.category=j),e(W)},D=b.useCallback(S=>{d(!0),h("");try{const j=Ce(Q,"listings"),P=Ne(j);return yr(P,q=>{const L=q.docs.map(X=>{var me;const V=X.data();return{id:X.id,title:V.title||"",description:V.description||"",category:V.category||"",condition:V.condition||"",images:V.images||[],userEmail:V.userEmail||"",userName:V.userName||"",createdAt:((me=V.createdAt)==null?void 0:me.toDate())||new Date,location:V.location||{latitude:0,longitude:0,address:""}}});let K=L;if(S.trim()){const X=S.toLowerCase().trim().split(/\s+/).filter(V=>V.length>=2);K=L.filter(V=>{const me=V.title.toLowerCase(),Se=V.description.toLowerCase(),Ye=V.category.toLowerCase();return X.some(ge=>me.includes(ge)||Se.includes(ge)||Ye.includes(ge))})}x&&x!=="all"&&(K=K.filter(X=>{var Se;const V=X.category.toLowerCase(),me=x.toLowerCase();return V===me||V===((Se=T[me])==null?void 0:Se.toLowerCase())}));let oe=K.map(X=>{const V=S.trim()?S.toLowerCase().split(/\s+/).reduce((me,Se)=>{const Ye=X.title.toLowerCase().includes(Se)?3:0,ge=X.description.toLowerCase().includes(Se)?1:0,qi=X.category.toLowerCase().includes(Se)?2:0;return me+Ye+ge+qi},0):0;return{...X,score:V}});oe.sort((X,V)=>V.createdAt-X.createdAt),c(oe.map(({score:X,...V})=>V)),d(!1)},q=>{console.error("Error searching listings:",q),h("Грешка при търсене на обяви. Моля, опитайте отново."),d(!1)})}catch(j){return console.error("Error setting up search:",j),h("Грешка при настройка на търсенето. Моля, опитайте отново."),d(!1),()=>{}}},[x]),I=b.useCallback(nu(S=>{const j=D(S);return()=>{j()}},300),[D]);b.useEffect(()=>{const S=t.get("q");let j;return S&&(a(S),j=D(S)),()=>{I.cancel(),j&&j()}},[t,D]),b.useEffect(()=>{const S=t.get("category");if(S&&(p(S),!i)){const j=D(" ");return()=>{typeof j=="function"&&j()}}},[t,i,D]),b.useEffect(()=>{if(!i)return;const S=I(i);return()=>{typeof S=="function"&&S()}},[I,i]);const C=S=>{a(S);const j=t.get("category"),P={q:S};j&&(P.category=j),e(P)},E=S=>{r(`/listing/${S.id}`,{state:{listing:S}})},w=async(S,j)=>{S.stopPropagation();try{await m(j.id),k(u(j.id)?"Премахнато от любими":"Добавено към любими"),O(!0)}catch(P){console.error("Error toggling favorite:",P),k("Грешка при добавяне към любими"),O(!0)}},B=S=>{if(!S)return"неизвестна дата";try{return typeof S=="string"?lt(new Date(S),{addSuffix:!0}):typeof S=="object"&&"seconds"in S?lt(new Date(S.seconds*1e3),{addSuffix:!0}):"неизвестна дата"}catch(j){return console.error("Error formatting date:",j),"неизвестна дата"}};return n.jsxs(M,{animation:"fade",children:[n.jsx(g,{sx:{pt:8},children:n.jsxs(z,{maxWidth:"lg",children:[n.jsx(M,{animation:"slide",delay:.2,children:n.jsxs(g,{sx:{mb:4},children:[n.jsx(f,{variant:"h4",component:"h1",gutterBottom:!0,sx:{textAlign:"center",fontWeight:"bold",mb:3,background:"linear-gradient(45deg, #2196F3 30%, #4CAF50 90%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Дайте втори живот на вещите си"}),n.jsx(f,{variant:"subtitle1",gutterBottom:!0,sx:{textAlign:"center",mb:4,color:"text.secondary"},children:"Разменете, споделете, намерете съкровища"}),n.jsxs(g,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[n.jsx(g,{sx:{flexGrow:1},children:n.jsx(hi,{variant:"search",placeholder:"Намерете подходящият за вас продукт...",value:i,onChange:C})}),n.jsxs(tt,{sx:{minWidth:200},children:[n.jsx(rt,{children:"Категория"}),n.jsxs(nt,{value:x,onChange:$,label:"Категория",children:[n.jsx(Te,{value:"all",children:"Всички категории"}),N.filter(S=>S!=="all").map(S=>n.jsx(Te,{value:S,children:S},S))]})]})]})]})}),l?n.jsx(g,{sx:{display:"flex",justifyContent:"center",py:8},children:n.jsx(ee,{})}):y?n.jsx(ie,{severity:"error",sx:{mt:4},children:y}):o.length===0?n.jsx(M,{animation:"fade",delay:.6,children:n.jsx(ie,{severity:"info",sx:{mt:4},children:"Няма намерени обяви, отговарящи на критериите за търсене."})}):n.jsx(_,{container:!0,spacing:4,children:o.map((S,j)=>n.jsx(_,{item:!0,xs:12,sm:6,md:4,children:n.jsx(M,{animation:"scale",delay:.4+j*.1,children:n.jsxs(Ae,{sx:{height:"100%",display:"flex",flexDirection:"column",cursor:"pointer",transition:"all 0.2s ease-in-out","&:hover":{transform:"translateY(-4px)",boxShadow:s.shadows[4]}},onClick:()=>E(S),children:[n.jsx(Be,{component:"img",height:"200",image:S.images[0]||"/placeholder-image.jpg",alt:S.title,sx:{objectFit:"cover"}}),n.jsxs(De,{sx:{flexGrow:1},children:[n.jsx(f,{variant:"h6",gutterBottom:!0,children:S.title}),n.jsx(f,{variant:"body2",color:"text.secondary",sx:{mb:2,display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:S.description}),n.jsxs(g,{sx:{display:"flex",gap:1,mb:2},children:[n.jsx(be,{icon:n.jsx(Xi,{}),label:S.category,size:"small"}),n.jsx(be,{label:S.condition,size:"small",color:"primary",variant:"outlined"})]}),n.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:1},children:[n.jsx(pr,{fontSize:"small",color:"action"}),n.jsx(f,{variant:"body2",color:"text.secondary",children:S.location.address})]}),n.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:1,mt:1},children:[n.jsx($n,{fontSize:"small",color:"action"}),n.jsx(f,{variant:"body2",color:"text.secondary",children:B(S.createdAt)})]})]}),n.jsx(qn,{children:n.jsx(G,{onClick:P=>w(P,S),sx:{ml:"auto"},children:u(S.id)?n.jsx(Un,{color:"error"}):n.jsx(Qi,{})})})]})})},S.id))})]})}),n.jsx(Ln,{open:A,autoHideDuration:3e3,onClose:()=>O(!1),message:v})]})},yh=()=>{const t=[{icon:n.jsx(Ji,{sx:{fontSize:40}}),title:"Разгледайте предметите",description:"Търсете сред нашата колекция от използвани предмети, достъпни за размяна."},{icon:n.jsx(zn,{sx:{fontSize:40}}),title:"Свържете се",description:"Свържете се със собственика на предмета и обсъдете възможната размяна."},{icon:n.jsx(Zi,{sx:{fontSize:40}}),title:"Разменете",description:"Срещнете се и разменете предмети с други членове на общността."},{icon:n.jsx(Ct,{sx:{fontSize:40}}),title:"Намалете отпадъците",description:"Помогнете за намаляване на отпадъците, като дадете на предметите втори живот чрез размяна."}];return n.jsxs(M,{children:[n.jsx(g,{sx:{py:{xs:4,md:8}},children:n.jsxs(z,{maxWidth:"lg",children:[n.jsx(f,{variant:"h2",component:"h1",align:"center",gutterBottom:!0,sx:{mb:6,fontWeight:700,fontSize:{xs:"2rem",sm:"3rem",md:"3.75rem"}},children:"Как работи"}),n.jsx(_,{container:!0,spacing:4,children:t.map((e,r)=>n.jsx(_,{item:!0,xs:12,sm:6,md:3,children:n.jsxs(re,{elevation:0,sx:{p:3,height:"100%",textAlign:"center",backgroundColor:"transparent","&:hover":{backgroundColor:"background.paper",transform:"translateY(-4px)",transition:"all 0.2s ease-in-out"}},children:[n.jsx(g,{sx:{display:"flex",justifyContent:"center",alignItems:"center",mb:2,color:"primary.main"},children:e.icon}),n.jsx(f,{variant:"h5",component:"h2",gutterBottom:!0,sx:{fontWeight:600},children:e.title}),n.jsx(f,{color:"text.secondary",children:e.description})]})},r))}),n.jsxs(g,{sx:{mt:8,textAlign:"center"},children:[n.jsx(f,{variant:"h4",component:"h2",gutterBottom:!0,sx:{fontWeight:600},children:"Присъединете се към нашата общност"}),n.jsx(f,{variant:"body1",color:"text.secondary",sx:{maxWidth:800,mx:"auto",mb:4},children:"Бъдете част от растящата общност от екологично съзнателни хора, които правят разлика, като избират да разменят вместо да пазаруват. Всяка размяна допринася за намаляване на отпадъците и насърчаване на устойчиво потребление."})]})]})}),n.jsx(Ut,{})]})},bh={lessThanXSeconds:{one:"по-малко от секунда",other:"по-малко от {{count}} секунди"},xSeconds:{one:"1 секунда",other:"{{count}} секунди"},halfAMinute:"половин минута",lessThanXMinutes:{one:"по-малко от минута",other:"по-малко от {{count}} минути"},xMinutes:{one:"1 минута",other:"{{count}} минути"},aboutXHours:{one:"около час",other:"около {{count}} часа"},xHours:{one:"1 час",other:"{{count}} часа"},xDays:{one:"1 ден",other:"{{count}} дни"},aboutXWeeks:{one:"около седмица",other:"около {{count}} седмици"},xWeeks:{one:"1 седмица",other:"{{count}} седмици"},aboutXMonths:{one:"около месец",other:"около {{count}} месеца"},xMonths:{one:"1 месец",other:"{{count}} месеца"},aboutXYears:{one:"около година",other:"около {{count}} години"},xYears:{one:"1 година",other:"{{count}} години"},overXYears:{one:"над година",other:"над {{count}} години"},almostXYears:{one:"почти година",other:"почти {{count}} години"}},vh=(t,e,r)=>{let s;const i=bh[t];return typeof i=="string"?s=i:e===1?s=i.one:s=i.other.replace("{{count}}",String(e)),r!=null&&r.addSuffix?r.comparison&&r.comparison>0?"след "+s:"преди "+s:s},wh={full:"EEEE, dd MMMM yyyy",long:"dd MMMM yyyy",medium:"dd MMM yyyy",short:"dd.MM.yyyy"},jh={full:"HH:mm:ss zzzz",long:"HH:mm:ss z",medium:"HH:mm:ss",short:"H:mm"},Sh={any:"{{date}} {{time}}"},_h={date:Ue({formats:wh,defaultWidth:"full"}),time:Ue({formats:jh,defaultWidth:"full"}),dateTime:Ue({formats:Sh,defaultWidth:"any"})},Vr=["неделя","понеделник","вторник","сряда","четвъртък","петък","събота"];function Ch(t){const e=Vr[t];switch(t){case 0:case 3:case 6:return"'миналата "+e+" в' p";case 1:case 2:case 4:case 5:return"'миналия "+e+" в' p"}}function Di(t){const e=Vr[t];return t===2?"'във "+e+" в' p":"'в "+e+" в' p"}function Eh(t){const e=Vr[t];switch(t){case 0:case 3:case 6:return"'следващата "+e+" в' p";case 1:case 2:case 4:case 5:return"'следващия "+e+" в' p"}}const kh=(t,e,r)=>{const s=te(t),i=s.getDay();return ki(s,e,r)?Di(i):Ch(i)},Ih=(t,e,r)=>{const s=te(t),i=s.getDay();return ki(s,e,r)?Di(i):Eh(i)},Ah={lastWeek:kh,yesterday:"'вчера в' p",today:"'днес в' p",tomorrow:"'утре в' p",nextWeek:Ih,other:"P"},Dh=(t,e,r,s)=>{const i=Ah[t];return typeof i=="function"?i(e,r,s):i},Th={narrow:["пр.н.е.","н.е."],abbreviated:["преди н. е.","н. е."],wide:["преди новата ера","новата ера"]},Ph={narrow:["1","2","3","4"],abbreviated:["1-во тримес.","2-ро тримес.","3-то тримес.","4-то тримес."],wide:["1-во тримесечие","2-ро тримесечие","3-то тримесечие","4-то тримесечие"]},Rh={abbreviated:["яну","фев","мар","апр","май","юни","юли","авг","сеп","окт","ное","дек"],wide:["януари","февруари","март","април","май","юни","юли","август","септември","октомври","ноември","декември"]},Oh={narrow:["Н","П","В","С","Ч","П","С"],short:["нд","пн","вт","ср","чт","пт","сб"],abbreviated:["нед","пон","вто","сря","чет","пет","съб"],wide:["неделя","понеделник","вторник","сряда","четвъртък","петък","събота"]},Mh={wide:{am:"преди обяд",pm:"след обяд",midnight:"в полунощ",noon:"на обяд",morning:"сутринта",afternoon:"следобед",evening:"вечерта",night:"през нощта"}};function Bh(t){return t==="year"||t==="week"||t==="minute"||t==="second"}function Nh(t){return t==="quarter"}function Pe(t,e,r,s,i){const a=Nh(e)?i:Bh(e)?s:r;return t+"-"+a}const Lh=(t,e)=>{const r=Number(t),s=e==null?void 0:e.unit;if(r===0)return Pe(0,s,"ев","ева","ево");if(r%1e3===0)return Pe(r,s,"ен","на","но");if(r%100===0)return Pe(r,s,"тен","тна","тно");const i=r%100;if(i>20||i<10)switch(i%10){case 1:return Pe(r,s,"ви","ва","во");case 2:return Pe(r,s,"ри","ра","ро");case 7:case 8:return Pe(r,s,"ми","ма","мо")}return Pe(r,s,"ти","та","то")},Wh={ordinalNumber:Lh,era:xe({values:Th,defaultWidth:"wide"}),quarter:xe({values:Ph,defaultWidth:"wide",argumentCallback:t=>t-1}),month:xe({values:Rh,defaultWidth:"wide"}),day:xe({values:Oh,defaultWidth:"wide"}),dayPeriod:xe({values:Mh,defaultWidth:"wide"})},Fh=/^(\d+)(-?[врмт][аи]|-?т?(ен|на)|-?(ев|ева))?/i,$h=/\d+/i,qh={narrow:/^((пр)?н\.?\s?е\.?)/i,abbreviated:/^((пр)?н\.?\s?е\.?)/i,wide:/^(преди новата ера|новата ера|нова ера)/i},Uh={any:[/^п/i,/^н/i]},zh={narrow:/^[1234]/i,abbreviated:/^[1234](-?[врт]?o?)? тримес.?/i,wide:/^[1234](-?[врт]?о?)? тримесечие/i},Vh={any:[/1/i,/2/i,/3/i,/4/i]},Hh={narrow:/^[нпвсч]/i,short:/^(нд|пн|вт|ср|чт|пт|сб)/i,abbreviated:/^(нед|пон|вто|сря|чет|пет|съб)/i,wide:/^(неделя|понеделник|вторник|сряда|четвъртък|петък|събота)/i},Yh={narrow:[/^н/i,/^п/i,/^в/i,/^с/i,/^ч/i,/^п/i,/^с/i],any:[/^н[ед]/i,/^п[он]/i,/^вт/i,/^ср/i,/^ч[ет]/i,/^п[ет]/i,/^с[ъб]/i]},Gh={abbreviated:/^(яну|фев|мар|апр|май|юни|юли|авг|сеп|окт|ное|дек)/i,wide:/^(януари|февруари|март|април|май|юни|юли|август|септември|октомври|ноември|декември)/i},Kh={any:[/^я/i,/^ф/i,/^мар/i,/^ап/i,/^май/i,/^юн/i,/^юл/i,/^ав/i,/^се/i,/^окт/i,/^но/i,/^де/i]},Xh={any:/^(преди о|след о|в по|на о|през|веч|сут|следо)/i},Qh={any:{am:/^преди о/i,pm:/^след о/i,midnight:/^в пол/i,noon:/^на об/i,morning:/^сут/i,afternoon:/^следо/i,evening:/^веч/i,night:/^през н/i}},Jh={ordinalNumber:Si({matchPattern:Fh,parsePattern:$h,valueCallback:t=>parseInt(t,10)}),era:ye({matchPatterns:qh,defaultMatchWidth:"wide",parsePatterns:Uh,defaultParseWidth:"any"}),quarter:ye({matchPatterns:zh,defaultMatchWidth:"wide",parsePatterns:Vh,defaultParseWidth:"any",valueCallback:t=>t+1}),month:ye({matchPatterns:Gh,defaultMatchWidth:"wide",parsePatterns:Kh,defaultParseWidth:"any"}),day:ye({matchPatterns:Hh,defaultMatchWidth:"wide",parsePatterns:Yh,defaultParseWidth:"any"}),dayPeriod:ye({matchPatterns:Xh,defaultMatchWidth:"any",parsePatterns:Qh,defaultParseWidth:"any"})},Zh={code:"bg",formatDistance:vh,formatLong:_h,formatRelative:Dh,localize:Wh,match:Jh,options:{weekStartsOn:1,firstWeekContainsDate:1}};var Hr={},ef=J;Object.defineProperty(Hr,"__esModule",{value:!0});var Ti=Hr.default=void 0,tf=ef(Z()),Nn=n;Ti=Hr.default=(0,tf.default)([(0,Nn.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"},"0"),(0,Nn.jsx)("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"},"1")],"AccessTime");const rf=()=>{const t=ae(),{user:e}=le(),[r,s]=b.useState([]),[i,a]=b.useState(!0),[o,c]=b.useState(null),[l,d]=b.useState(!1),[y,h]=b.useState(null),[x,p]=b.useState(!1),m=je();b.useEffect(()=>{(async()=>{if(!e){t("/signin");return}try{a(!0);const T=Ne(Ce(Q,"listings"),it("userId","==",e.uid),it("status","==","active")),$=(await Nt(T)).docs.map(D=>({id:D.id,...D.data()}));s($),c(null)}catch(T){console.error("Error fetching listings:",T),c("Грешка при зареждане на вашите обяви. Моля, опитайте отново по-късно.")}finally{a(!1)}})()},[e,t]);const u=R=>{t(`/edit-listing/${R}`)},A=R=>{h(R),d(!0)},O=async()=>{if(y)try{p(!0);const R=he(Q,"listings",y);await ze(R);const T=r.find(N=>N.id===y);if(T!=null&&T.images&&T.images.length>0)for(const N of T.images)try{const $=N.split("listings/")[1];if($){const D=at(ct,`listings/${$}`);await br(D)}}catch($){console.error("Error deleting image:",$)}s(r.filter(N=>N.id!==y)),c(null)}catch(R){console.error("Error deleting listing:",R),c("Грешка при изтриване на обявата. Моля, опитайте отново.")}finally{p(!1),d(!1),h(null)}},v=R=>{if(!R)return"неизвестна дата";try{let T;if(typeof R=="string")T=new Date(R);else if(typeof R=="object"&&"seconds"in R)T=new Date(R.seconds*1e3);else if(R instanceof Date)T=R;else return"неизвестна дата";return isNaN(T.getTime())?"неизвестна дата":lt(T,{addSuffix:!0,locale:Zh})}catch(T){return console.error("Error formatting date:",T),"неизвестна дата"}},k=()=>n.jsx(M,{animation:"slide",delay:.2,children:n.jsxs(g,{sx:{mb:4},children:[n.jsx(f,{variant:"h4",component:"h1",gutterBottom:!0,children:"Моите обяви"}),n.jsx(Y,{variant:"contained",color:"primary",startIcon:n.jsx(Vn,{}),onClick:()=>t("/create-listing"),children:"Нова обява"})]})});return i&&!x?n.jsx(M,{animation:"fade",children:n.jsx(g,{sx:{pt:8},children:n.jsxs(z,{maxWidth:"lg",children:[k(),n.jsx(g,{sx:{display:"flex",justifyContent:"center",py:8},children:n.jsx(ee,{})})]})})}):o?n.jsx(M,{animation:"fade",children:n.jsx(g,{sx:{pt:8},children:n.jsxs(z,{maxWidth:"lg",children:[k(),n.jsx(ie,{severity:"error",sx:{mt:4},children:o})]})})}):n.jsxs(M,{animation:"fade",children:[n.jsx(g,{sx:{pt:8},children:n.jsxs(z,{maxWidth:"lg",children:[k(),r.length===0?n.jsx(M,{animation:"fade",delay:.6,children:n.jsx(ie,{severity:"info",sx:{mt:4},children:"Все още нямате публикувани обяви."})}):n.jsx(_,{container:!0,spacing:4,children:r.map((R,T)=>{var N;return n.jsx(_,{item:!0,xs:12,sm:6,md:4,children:n.jsx(M,{animation:"scale",delay:.4+T*.1,children:n.jsxs(Ae,{sx:{height:"100%",display:"flex",flexDirection:"column",cursor:"pointer",transition:"all 0.2s ease-in-out","&:hover":{transform:"translateY(-4px)",boxShadow:m.shadows[4]}},onClick:()=>u(R.id),children:[n.jsx(Be,{component:"img",height:"200",image:((N=R.images)==null?void 0:N[0])||"/placeholder-image.jpg",alt:R.title,sx:{objectFit:"cover"}}),n.jsxs(De,{children:[n.jsx(f,{gutterBottom:!0,variant:"h6",component:"h2",children:R.title}),n.jsx(f,{variant:"body2",color:"text.secondary",sx:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:R.description}),n.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:1,mt:1},children:[n.jsx(Ti,{fontSize:"small",color:"action"}),n.jsx(f,{variant:"body2",color:"text.secondary",children:v(R.createdAt)})]}),n.jsx(g,{sx:{display:"flex",alignItems:"center",gap:1,mt:1},children:n.jsxs(f,{variant:"body2",color:"text.secondary",children:[R.city,", ",R.region]})})]}),n.jsx(qn,{children:n.jsx(G,{size:"small",onClick:$=>{$.stopPropagation(),A(R.id)},title:"Изтрий обява",color:"error",children:n.jsx(Fn,{fontSize:"small"})})})]})})},R.id)})})]})}),n.jsxs(St,{open:l,onClose:()=>d(!1),children:[n.jsx(gr,{children:"Потвърждение за изтриване"}),n.jsx(_t,{children:n.jsx(f,{children:"Сигурни ли сте, че искате да изтриете тази обява? Това действие не може да бъде отменено."})}),n.jsxs(xr,{children:[n.jsx(Y,{onClick:()=>d(!1),disabled:x,children:"Отказ"}),n.jsx(Y,{onClick:O,color:"error",variant:"contained",disabled:x,startIcon:x?n.jsx(ee,{size:20}):null,children:x?"Изтриване...":"Изтрий"})]})]})]})},nf=()=>{const t=[{icon:n.jsx(Ct,{}),title:"Устойчивост",description:"Вярваме в намаляване на отпадъците и насърчаване на кръговата икономика чрез размяна на предмети."},{icon:n.jsx(ea,{}),title:"Общност",description:"Изграждане на общност от екологично съзнателни хора, които споделят общи ценности."},{icon:n.jsx(ta,{}),title:"Глобален ефект",description:"Постигане на положителен екологичен ефект чрез удължаване на жизнения цикъл на предметите."}];return n.jsxs(M,{children:[n.jsx(g,{sx:{py:{xs:4,md:8}},children:n.jsxs(z,{maxWidth:"lg",children:[n.jsxs(g,{sx:{textAlign:"center",mb:8},children:[n.jsx(f,{variant:"h2",component:"h1",sx:{mb:3,fontWeight:700,fontSize:{xs:"2rem",sm:"3rem",md:"3.75rem"}},children:"За Zero-Waste Swap"}),n.jsx(f,{variant:"h5",color:"text.secondary",sx:{maxWidth:800,mx:"auto",mb:4,fontSize:{xs:"1.1rem",sm:"1.25rem"}},children:"Нашата мисия е да създадем по-устойчиво бъдеще, като улесним хората да разменят предмети вместо да купуват нови."})]}),n.jsx(_,{container:!0,spacing:4,sx:{mb:8},children:t.map((e,r)=>n.jsx(_,{item:!0,xs:12,md:4,children:n.jsxs(re,{elevation:0,sx:{p:4,height:"100%",textAlign:"center",backgroundColor:"transparent","&:hover":{backgroundColor:"background.paper",transform:"translateY(-4px)",transition:"all 0.2s ease-in-out"}},children:[n.jsx(ke,{sx:{width:64,height:64,bgcolor:"primary.main",mb:2,mx:"auto"},children:e.icon}),n.jsx(f,{variant:"h5",component:"h2",gutterBottom:!0,sx:{fontWeight:600},children:e.title}),n.jsx(f,{color:"text.secondary",children:e.description})]})},r))}),n.jsxs(g,{sx:{textAlign:"center"},children:[n.jsx(f,{variant:"h4",component:"h2",gutterBottom:!0,sx:{fontWeight:600},children:"Нашата история"}),n.jsx(f,{variant:"body1",color:"text.secondary",sx:{maxWidth:800,mx:"auto",mb:2,fontSize:"1.1rem",lineHeight:1.8},children:"Zero-Waste Swap започна с проста идея: какво ще стане, ако можем да намалим отпадъците, като помогнем на хората да разменят предмети, от които вече не се нуждаят, с други, които могат да ги използват? Тази платформа е резултат от тази визия, създавайки пространство, където устойчивостта се среща с общността."}),n.jsx(f,{variant:"body1",color:"text.secondary",sx:{maxWidth:800,mx:"auto",fontSize:"1.1rem",lineHeight:1.8},children:"Днес с гордост улесняваме хиляди размени, помагайки за намаляване на отпадъците и изграждане на връзки между екологично съзнателни хора. Всяка размяна представлява крачка към по-устойчиво бъдеще."})]})]})}),n.jsx(Ut,{})]})},sf=()=>{const{user:t}=le(),e=ae(),[r,s]=b.useState((t==null?void 0:t.displayName)||""),[i,a]=b.useState(!1),[o,c]=b.useState(null);if(!t)return e("/login"),null;const l=async d=>{d.preventDefault(),a(!0),c(null);try{await is(t,{displayName:r.trim()}),setTimeout(()=>{e("/profile")},2e3)}catch(y){c("Грешка при актуализиране на профила. Моля, опитайте отново."),console.error("Error updating profile:",y)}finally{a(!1)}};return n.jsx(M,{animation:"fade",children:n.jsx(g,{sx:{pt:8},children:n.jsxs(z,{maxWidth:"md",children:[n.jsx(M,{animation:"slide",delay:.2,children:n.jsxs(g,{sx:{mb:4},children:[n.jsx(f,{variant:"h4",component:"h1",gutterBottom:!0,children:"Настройки"}),n.jsx(f,{variant:"body1",color:"text.secondary",paragraph:!0,children:"Управлявайте вашите лични данни и настройки."})]})}),n.jsx(M,{animation:"scale",delay:.4,children:n.jsx(re,{sx:{p:4},children:n.jsx("form",{onSubmit:l,children:n.jsxs(_,{container:!0,spacing:3,children:[n.jsx(_,{item:!0,xs:12,children:n.jsx(U,{fullWidth:!0,label:"Име",value:r,onChange:d=>s(d.target.value),required:!0,error:!!o,helperText:o})}),n.jsx(_,{item:!0,xs:12,children:n.jsx(U,{fullWidth:!0,label:"Имейл",value:t.email||"",disabled:!0})}),n.jsx(_,{item:!0,xs:12,children:n.jsx(M,{animation:"slide",delay:.6,children:n.jsxs(g,{sx:{display:"flex",gap:2,justifyContent:"flex-end"},children:[n.jsx(Y,{variant:"outlined",onClick:()=>e(-1),children:"Отказ"}),n.jsx(Y,{type:"submit",variant:"contained",color:"primary",disabled:i,children:i?n.jsx(ee,{size:24}):"Запази промените"})]})})})]})})})})]})})})},af=()=>{const{user:t}=le(),e=ae(),[r,s]=b.useState({name:(t==null?void 0:t.displayName)||"",email:(t==null?void 0:t.email)||"",subject:"",message:""}),[i,a]=b.useState(!1),[o,c]=b.useState(!1),[l,d]=b.useState(null),y=p=>/^[^@]+@[^@]+\.[^@]+$/.test(p),h=p=>{const{name:m,value:u}=p.target;s(A=>({...A,[m]:u})),l&&d(null)},x=async p=>{p.preventDefault(),a(!0),d(null),c(!1);try{if(!r.name.trim())throw new Error("Моля, въведете вашето име");if(!r.email.trim()||!y(r.email))throw new Error("Моля, въведете валиден имейл адрес");if(!r.subject.trim())throw new Error("Моля, въведете тема");if(!r.message.trim())throw new Error("Моля, въведете вашето съобщение");const m={name:r.name.trim(),email:r.email.trim(),subject:r.subject.trim(),message:r.message.trim(),createdAt:new Date,status:"new"};await cs(Ce(Q,"contact_messages"),m),c(!0),setTimeout(()=>{e("/")},2e3)}catch(m){console.error("Error sending message:",m),d(m instanceof Error?m.message:"Грешка при изпращане на съобщението. Моля, опитайте отново.")}finally{a(!1)}};return n.jsxs(M,{children:[n.jsx(z,{maxWidth:"md",children:n.jsx(g,{sx:{my:4},children:n.jsxs(re,{elevation:2,sx:{p:4,borderRadius:2},children:[n.jsx(f,{variant:"h4",component:"h1",gutterBottom:!0,align:"center",sx:{mb:4},children:"Свържете се с нас"}),l&&n.jsx(ie,{severity:"error",sx:{mb:3},children:l}),o&&n.jsx(ie,{severity:"success",sx:{mb:3},children:"Вашето съобщение беше изпратено успешно! Пренасочване към началната страница..."}),n.jsx(g,{component:"form",onSubmit:x,noValidate:!0,children:n.jsxs(_,{container:!0,spacing:3,children:[n.jsx(_,{item:!0,xs:12,sm:6,children:n.jsx(U,{required:!0,fullWidth:!0,label:"Име",name:"name",value:r.name,onChange:h,disabled:i||o,error:!!(l&&!r.name.trim())})}),n.jsx(_,{item:!0,xs:12,sm:6,children:n.jsx(U,{required:!0,fullWidth:!0,label:"Имейл",name:"email",type:"email",value:r.email,onChange:h,disabled:i||o,error:!!(l&&(!r.email.trim()||!y(r.email)))})}),n.jsx(_,{item:!0,xs:12,children:n.jsx(U,{required:!0,fullWidth:!0,label:"Тема",name:"subject",value:r.subject,onChange:h,disabled:i||o,error:!!(l&&!r.subject.trim())})}),n.jsx(_,{item:!0,xs:12,children:n.jsx(U,{required:!0,fullWidth:!0,label:"Съобщение",name:"message",multiline:!0,rows:4,value:r.message,onChange:h,disabled:i||o,error:!!(l&&!r.message.trim())})}),n.jsx(_,{item:!0,xs:12,children:n.jsx(Y,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,size:"large",disabled:i||o,sx:{mt:2},children:i?n.jsx(ee,{size:24}):"Изпрати съобщение"})})]})})]})})}),n.jsx(Ut,{})]})},of=[{id:1,title:"Биологични зеленчуци",description:"Свежи биологични зеленчуци от нашата градина, включително домати, краставици и листни зеленчуци",image:Js,location:"София, България",category:"Храни"},{id:2,title:"Повторно използваеми чанти",description:"Комплект от 5 екологични чанти за пазаруване, направени от рециклирани материали, издръжливи и перащи се",image:Zs,location:"Пловдив, България",category:"Аксесоари"},{id:3,title:"Комплект бамбукови прибори",description:"Пълен комплект бамбукови кухненски прибори, включващ лъжици, лопатки и сервиращи инструменти",image:bl,location:"Варна, България",category:"Кухня"},{id:4,title:"Бягащи обувки",description:"Nike бягащи обувки, размер EU 42, леко използвани, идеални за начинаещи",image:ei,location:"Бургас, България",category:"Дрехи"},{id:5,title:"Кафе машина",description:"Philips кафе машина, капацитет 1.5L, използвана 6 месеца, работи перфектно",image:ti,location:"Русе, България",category:"Уреди"},{id:6,title:"Зимна якa",description:"Дамска зимна якa, размер M, водоустойчива, отлично състояние",image:ri,location:"София, България",category:"Дрехи"},{id:7,title:"Колекция настолни игри",description:"Колекция от популярни настолни игри, включваща Монополи, Скрабъл и Шах",image:ni,location:"Пловдив, България",category:"Забавление"},{id:8,title:"Йога килим",description:"Екологичен йога килим, направен от натурален каучук, дебелина 4mm, почти неизползван",image:si,location:"Варна, България",category:"Спорт"},{id:9,title:"Блендер",description:"Високоскоростен блендер, идеален за смутита и супи, мощност 800W",image:ur,location:"Бургас, България",category:"Уреди"},{id:10,title:"Детски книги",description:"Колекция от 15 детски книги в отлично състояние, подходящи за възраст 5-8 години",image:ii,location:"София, България",category:"Книги"},{id:11,title:"Комплект градински инструменти",description:"Пълен комплект градински инструменти, включващ лопата, гребло и ножици за подрязване",image:ai,location:"Стара Загора, България",category:"Инструменти"},{id:12,title:"Станд за лаптоп",description:"Регулируем алуминиев стенд за лаптоп, ергономичен дизайн, сгъваем",image:oi,location:"Велико Търново, България",category:"Електроника"},{id:13,title:"Велосипед",description:'Планински велосипед в добро състояние, 26" колела, наскоро обслужен',image:ci,location:"София, България",category:"Спорт"},{id:14,title:"Художествени материали",description:"Комплект акрилни бои, четки и платна, идеални за начинаещи",image:li,location:"Пловдив, България",category:"Хобита"},{id:15,title:"Настолна лампа",description:"LED настолна лампа с регулируема яркост и цветна температура",image:di,location:"Варна, България",category:"Електроника"},{id:16,title:"Лаптоп",description:'Apple MacBook Pro 16" M3 Pro 512GB Space Black',image:ui,location:"Сливен, България",category:"Електроника"}],cf=()=>{const t=ae(),e=je(),{user:r}=le(),{favorites:s,toggleFavorite:i}=ut(),[a,o]=b.useState([]),[c,l]=b.useState(!0),[d,y]=b.useState(null);b.useEffect(()=>{(async()=>{if(!r||s.length===0){console.log("No user or no favorites:",{user:!!r,favoritesLength:s.length}),o([]),l(!1);return}try{console.log("Fetching favorites:",s);const u=s.map(k=>String(k)).filter(k=>k.length>0);if(console.log("Valid favorites:",u),u.length===0){o([]),l(!1);return}const A=u.map(async k=>{var R;try{if(k.startsWith("demo_")){const I=parseInt(k.replace("demo_","")),C=of.find(E=>E.id===I);if(C){const{id:E,...w}=C;return{id:k,...w,images:[C.image],location:{address:C.location,latitude:0,longitude:0},userId:"demo",userName:"Demo User",userEmail:"demo@example.com",createdAt:new Date,updatedAt:new Date,condition:"good",status:"active"}}return null}console.log("Fetching listing:",k);const T=he(Q,"listings",k),N=await Bt(T);if(N.exists()){const I=N.data();return console.log("Found listing:",{id:N.id,...I}),{id:N.id,...I,createdAt:((R=I.createdAt)==null?void 0:R.toDate())||new Date}}console.log(`Listing ${k} not found, removing from favorites`);const $=`${r.uid}_${k}`,D=he(Q,"favorites",$);return await ze(D),null}catch(T){return console.error(`Error fetching listing ${k}:`,T),null}}),v=(await Promise.all(A)).filter(k=>k!==null).sort((k,R)=>R.createdAt.getTime()-k.createdAt.getTime());console.log("Final listings:",v),o(v)}catch(u){console.error("Error fetching favorite listings:",u),y("Грешка при зареждане на любими обяви")}finally{l(!1)}})()},[r,s]);const h=m=>{t(`/listing/${m.id}`,{state:{listing:m}})},x=async(m,u)=>{m.stopPropagation(),await i(u)},p=m=>{if(!m)return"неизвестна дата";try{return typeof m=="string"?lt(new Date(m),{addSuffix:!0}):typeof m=="object"&&"seconds"in m?lt(new Date(m.seconds*1e3),{addSuffix:!0}):"неизвестна дата"}catch(u){return console.error("Error formatting date:",u),"неизвестна дата"}};return r?c?n.jsx(g,{sx:{display:"flex",justifyContent:"center",py:4},children:n.jsx(ee,{})}):n.jsxs(z,{maxWidth:"lg",sx:{py:4},children:[n.jsx(f,{variant:"h4",component:"h1",gutterBottom:!0,children:"Моите любими"}),d&&n.jsx(ie,{severity:"error",sx:{mb:3},children:d}),a.length===0?n.jsx(ie,{severity:"info",children:"Все още нямате добавени обяви в любими."}):n.jsx(_,{container:!0,spacing:3,children:a.map(m=>{var u,A;return n.jsx(_,{item:!0,xs:12,sm:6,md:4,children:n.jsxs(Ae,{sx:{height:"100%",display:"flex",flexDirection:"column",cursor:"pointer",transition:"all 0.2s ease-in-out","&:hover":{transform:"translateY(-4px)",boxShadow:e.shadows[4]}},onClick:()=>h(m),children:[n.jsxs(g,{sx:{position:"relative"},children:[n.jsx(Be,{component:"img",height:"200",image:((u=m.images)==null?void 0:u[0])||"/placeholder-image.jpg",alt:m.title,sx:{objectFit:"cover"}}),n.jsx(G,{sx:{position:"absolute",top:8,right:8,backgroundColor:"rgba(255, 255, 255, 0.8)","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.9)"}},onClick:O=>x(O,m.id),children:n.jsx(Un,{color:"error"})})]}),n.jsxs(De,{sx:{flexGrow:1},children:[n.jsx(f,{gutterBottom:!0,variant:"h6",component:"h2",children:m.title}),n.jsx(f,{variant:"body2",color:"text.secondary",sx:{mb:2},children:m.description}),n.jsxs(g,{sx:{display:"flex",gap:1,flexWrap:"wrap",mb:2},children:[n.jsx(be,{icon:n.jsx(pr,{}),label:((A=m.location)==null?void 0:A.address)||"Местоположението не е посочено",size:"small"}),n.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:1,mt:1},children:[n.jsx($n,{fontSize:"small",color:"action"}),n.jsx(f,{variant:"body2",color:"text.secondary",children:p(m.createdAt)})]})]})]})]})},m.id)})})]}):n.jsx(z,{maxWidth:"lg",sx:{py:4},children:n.jsx(ie,{severity:"info",children:"Моля, влезте в системата, за да видите вашите любими обяви."})})},lf=()=>n.jsx(z,{maxWidth:"md",children:n.jsx(g,{sx:{my:4},children:n.jsxs(re,{elevation:0,sx:{p:4},children:[n.jsx(f,{variant:"h4",component:"h1",gutterBottom:!0,children:"Политика за поверителност"}),n.jsxs(f,{variant:"body1",paragraph:!0,children:["Последна актуализация: ",new Date().toLocaleDateString("bg-BG")]}),n.jsx(f,{variant:"h6",gutterBottom:!0,sx:{mt:3},children:"1. Информация, която събираме"}),n.jsx(f,{variant:"body1",paragraph:!0,children:"Събираме информация, която вие предоставяте директно на нас, включително име, имейл адрес и всяка друга информация, която изберете да предоставите при използване на нашата платформа Zero-Waste Swap."}),n.jsx(f,{variant:"h6",gutterBottom:!0,sx:{mt:3},children:"2. Как използваме вашата информация"}),n.jsx(f,{variant:"body1",paragraph:!0,children:"Използваме събраната информация, за да: • Предоставяме и поддържаме нашите услуги • Обработваме вашите транзакции • Изпращаме ви технически известия и съобщения за поддръжка • Комуникираме с вас за продукти, услуги и събития"}),n.jsx(f,{variant:"h6",gutterBottom:!0,sx:{mt:3},children:"3. Споделяне на информация"}),n.jsx(f,{variant:"body1",paragraph:!0,children:"Ние не продаваме или споделяме вашата лична информация с трети страни, освен когато е необходимо за предоставяне на нашите услуги или когато се изисква по закон."}),n.jsx(f,{variant:"h6",gutterBottom:!0,sx:{mt:3},children:"4. Сигурност на данните"}),n.jsx(f,{variant:"body1",paragraph:!0,children:"Прилагаме подходящи мерки за сигурност, за да защитим вашата лична информация от неоторизиран достъп, промяна или унищожаване."}),n.jsx(f,{variant:"h6",gutterBottom:!0,sx:{mt:3},children:"5. Вашите права"}),n.jsx(f,{variant:"body1",paragraph:!0,children:"Имате право да достъпвате, актуализирате или изтривате вашата лична информация. Можете да упражните тези права, като се свържете с нас чрез нашата платформа."}),n.jsx(f,{variant:"h6",gutterBottom:!0,sx:{mt:3},children:"6. Промени в тази политика"}),n.jsx(f,{variant:"body1",paragraph:!0,children:"Може да актуализираме тази политика за поверителност от време на време. Ще ви уведомим за всички промени, като публикуваме новата политика на тази страница."}),n.jsx(f,{variant:"h6",gutterBottom:!0,sx:{mt:3},children:"7. Свържете се с нас"}),n.jsx(f,{variant:"body1",paragraph:!0,children:"Ако имате въпроси относно тази Политика за поверителност, моля, свържете се с нас чрез контактната форма на нашата платформа."})]})})}),df=()=>n.jsx(z,{maxWidth:"md",children:n.jsx(g,{sx:{my:4},children:n.jsxs(re,{elevation:0,sx:{p:4},children:[n.jsx(f,{variant:"h4",component:"h1",gutterBottom:!0,children:"Общи условия за ползване"}),n.jsxs(f,{variant:"body1",paragraph:!0,children:["Последна актуализация: ",new Date().toLocaleDateString("bg-BG")]}),n.jsx(f,{variant:"h6",gutterBottom:!0,sx:{mt:3},children:"1. Приемане на условията"}),n.jsx(f,{variant:"body1",paragraph:!0,children:"Чрез достъп и използване на платформата Zero-Waste Swap, вие се съгласявате да се придържате към тези Общи условия за ползване и всички приложими закони и разпоредби."}),n.jsx(f,{variant:"h6",gutterBottom:!0,sx:{mt:3},children:"2. Потребителски акаунти"}),n.jsx(f,{variant:"body1",paragraph:!0,children:"Трябва да създадете акаунт, за да използвате определени функции на нашата платформа. Вие сте отговорни за поддържането на поверителността на информацията за вашия акаунт и за всички действия, извършени под вашия акаунт."}),n.jsx(f,{variant:"h6",gutterBottom:!0,sx:{mt:3},children:"3. Насоки за публикуване на обяви"}),n.jsx(f,{variant:"body1",paragraph:!0,children:"При създаване на обяви, вие се съгласявате да: • Предоставяте точна и пълна информация • Публикувате само предмети, които имате право да разменяте или давате • Не публикувате забранени предмети • Поддържате и актуализирате вашите обяви"}),n.jsx(f,{variant:"h6",gutterBottom:!0,sx:{mt:3},children:"4. Потребителско поведение"}),n.jsx(f,{variant:"body1",paragraph:!0,children:"Вие се съгласявате да не: • Нарушавате закони или разпоредби • Нарушавате интелектуалните права на другите • Притеснявате или навреждате на други потребители • Публикувате невярна или подвеждаща информация"}),n.jsx(f,{variant:"h6",gutterBottom:!0,sx:{mt:3},children:"5. Правила на платформата"}),n.jsx(f,{variant:"body1",paragraph:!0,children:"Ние си запазваме правото да: • Премахваме всяко съдържание, което нарушава тези условия • Спираме или прекратяваме акаунти • Променяме или прекратяваме услугите • Актуализираме тези условия по всяко време"}),n.jsx(f,{variant:"h6",gutterBottom:!0,sx:{mt:3},children:"6. Отговорност"}),n.jsx(f,{variant:"body1",paragraph:!0,children:'Платформата се предоставя "както е" без никакви гаранции. Ние не носим отговорност за поведението на потребителите или качеството на предметите, разменяни чрез нашата платформа.'}),n.jsx(f,{variant:"h6",gutterBottom:!0,sx:{mt:3},children:"7. Контакт"}),n.jsx(f,{variant:"body1",paragraph:!0,children:"За въпроси относно тези Общи условия за ползване, моля, свържете се с нас чрез контактната форма на нашата платформа."})]})})}),uf=()=>{const[t,e]=b.useState(""),[r,s]=b.useState(!1),[i,a]=b.useState(null),[o,c]=b.useState(!1),{resetPassword:l}=le(),d=h=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(h),y=async h=>{if(h.preventDefault(),a(null),c(!1),!d(t)){a("Моля, въведете валиден имейл адрес");return}try{s(!0),await l(t),c(!0)}catch{a("Грешка при изпращане на имейл за възстановяване на паролата. Моля, опитайте отново.")}finally{s(!1)}};return n.jsx(z,{maxWidth:"sm",children:n.jsx(g,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:n.jsxs(re,{elevation:3,sx:{padding:4,display:"flex",flexDirection:"column",alignItems:"center",width:"100%"},children:[n.jsx(f,{component:"h1",variant:"h5",children:"Забравена парола"}),n.jsx(f,{variant:"body2",color:"text.secondary",align:"center",sx:{mt:2},children:"Въведете имейл адреса си и ние ще ви изпратим линк за възстановяване на паролата."}),i&&n.jsx(ie,{severity:"error",sx:{mt:2,width:"100%"},children:i}),o&&n.jsx(ie,{severity:"success",sx:{mt:2,width:"100%"},children:"Имейл за възстановяване на паролата беше изпратен. Моля, проверете вашата поща."}),n.jsxs(g,{component:"form",onSubmit:y,sx:{mt:3,width:"100%"},children:[n.jsx(U,{margin:"normal",required:!0,fullWidth:!0,id:"email",label:"Имейл адрес",name:"email",autoComplete:"email",autoFocus:!0,value:t,onChange:h=>e(h.target.value),error:!!i&&!d(t),helperText:i&&!d(t)?"Моля, въведете валиден имейл адрес":"",InputProps:{startAdornment:n.jsx(et,{position:"start",children:n.jsx(tr,{})})}}),n.jsx(Y,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},disabled:r,children:r?n.jsx(ee,{size:24}):"Изпрати линк за възстановяване"}),n.jsx(g,{sx:{textAlign:"center"},children:n.jsx(_e,{component:Me,to:"/login",variant:"body2",children:"Назад към входа"})})]})]})})})},hf=()=>{const t=ae();return n.jsx(z,{maxWidth:"md",children:n.jsxs(g,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"80vh",textAlign:"center"},children:[n.jsx(f,{variant:"h1",component:"h1",gutterBottom:!0,children:"404"}),n.jsx(f,{variant:"h4",component:"h2",gutterBottom:!0,children:"Страницата не е намерена"}),n.jsx(f,{variant:"body1",color:"text.secondary",paragraph:!0,children:"Съжаляваме, но страницата, която търсите, не съществува или е била преместена."}),n.jsx(Y,{variant:"contained",startIcon:n.jsx(Wn,{}),onClick:()=>t("/"),sx:{mt:2},children:"Обратно към началната страница"})]})})};var Yr={},ff=J;Object.defineProperty(Yr,"__esModule",{value:!0});var hr=Yr.default=void 0,mf=ff(Z()),pf=n;hr=Yr.default=(0,mf.default)((0,pf.jsx)("path",{d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m0 14H6l-2 2V4h16z"}),"ChatBubbleOutline");var Gr={},gf=J;Object.defineProperty(Gr,"__esModule",{value:!0});var Pi=Gr.default=void 0,xf=gf(Z()),yf=n;Pi=Gr.default=(0,xf.default)((0,yf.jsx)("path",{d:"M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m-9-2V7H4v3H1v2h3v3h2v-3h3v-2zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"PersonAdd");const bf=({chat:t,currentUserId:e,selected:r,onClick:s,unreadCount:i=0})=>{var y;const a=je();console.log("ChatListItem participants:",{chatId:t._id,allParticipants:t.participants.map(h=>({uid:h.uid,username:h.username,email:h.email,displayName:h.displayName})),currentUserId:e});const o=t.participants.find(h=>h.uid!==e);console.log("ChatListItem otherParticipant:",{chatId:t._id,currentUserId:e,otherParticipant:o?{uid:o.uid,username:o.username,email:o.email,displayName:o.displayName}:null});const c=()=>o?o.username?o.username:o.displayName?o.displayName:o.email?o.email.split("@")[0]:"Unknown User":"Unknown User",l=()=>c().split(" ").map(x=>x[0]).join("").toUpperCase().slice(0,2),d=h=>{const x=new Date(h);return ji(x)?Ii(x)?Ot(x,"HH:mm"):Ai(x)?"Yesterday":Ot(x,"MMM d"):""};return n.jsxs(rr,{button:!0,selected:r,onClick:s,sx:{borderRadius:2,mb:.5,transition:"all 0.2s ease","&.Mui-selected":{backgroundColor:`${a.palette.primary.main}15`,"&:hover":{backgroundColor:`${a.palette.primary.main}25`}},"&:hover":{backgroundColor:a.palette.action.hover}},children:[n.jsx(ra,{children:n.jsx(st,{overlap:"circular",anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"dot",color:"success",invisible:!(o!=null&&o.online),children:n.jsx(ke,{src:o==null?void 0:o.photoURL,sx:{width:48,height:48,bgcolor:a.palette.primary.main,fontSize:"1.2rem",fontWeight:500},children:l()})})}),n.jsx(na,{primaryTypographyProps:{component:"div",sx:{display:"flex",justifyContent:"space-between",alignItems:"center"}},primary:n.jsxs(n.Fragment,{children:[n.jsx(f,{variant:"subtitle1",fontWeight:500,children:c()}),n.jsx(f,{variant:"caption",color:"text.secondary",children:d(t.updatedAt)})]}),secondaryTypographyProps:{component:"div",sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mt:.5}},secondary:n.jsxs(n.Fragment,{children:[n.jsx(f,{variant:"body2",color:i>0?"text.primary":"text.secondary",sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"70%",fontWeight:i>0?500:400},children:((y=t.lastMessage)==null?void 0:y.text)||"No messages yet"}),i>0&&n.jsx(st,{badgeContent:i,color:"primary",sx:{"& .MuiBadge-badge":{right:-3,top:3}}})]})})]})},vf=t=>{var i;const e=((i=t.participants)==null?void 0:i.map(a=>{console.log("Raw participant data:",a);const o={uid:typeof a=="object"&&a&&a.uid||"unknown",username:typeof a=="object"&&a&&a.username||"user",displayName:typeof a=="object"&&a&&a.displayName||"Unknown User",email:typeof a=="object"&&a&&a.email||"",photoURL:typeof a=="object"&&a&&a.photoURL||void 0,online:typeof a=="object"&&a&&a.online||!1};return console.log("Processed participant data:",o),o}))||[];console.log("Final participants array:",e);const r=t.lastMessage?{text:t.lastMessage.text||"",createdAt:typeof t.lastMessage.createdAt=="string"?t.lastMessage.createdAt:t.lastMessage.createdAt instanceof Date?t.lastMessage.createdAt.toISOString():new Date().toISOString()}:void 0,s={_id:t._id,participants:e,lastMessage:r,updatedAt:t.updatedAt||new Date().toISOString()};return console.log("Final chat list item:",s),s},wf=({onChatSelect:t,selectedChatId:e})=>{const{chats:r,currentChat:s,setCurrentChat:i,fetchChats:a,loading:o,error:c}=dt(),{user:l}=Ft(),d=je(),[y,h]=b.useState("");b.useEffect(()=>{l&&a()},[l,a]);const x=r.filter(m=>{const u=m.participants.find(O=>O.uid!==(l==null?void 0:l.uid));return[u==null?void 0:u.username,u==null?void 0:u.displayName,u==null?void 0:u.email].filter(Boolean).join(" ").toLowerCase().includes(y.toLowerCase())}),p=m=>{i(m),t&&t(m)};return l?n.jsxs(g,{sx:{display:"flex",flexDirection:"column",height:"100%",borderRight:`1px solid ${d.palette.divider}`},children:[n.jsx(re,{elevation:0,sx:{p:2,backgroundColor:d.palette.background.paper,borderBottom:`1px solid ${d.palette.divider}`},children:n.jsx(U,{fullWidth:!0,placeholder:"Search conversations...",variant:"outlined",size:"small",value:y,onChange:m=>h(m.target.value),InputProps:{startAdornment:n.jsx(et,{position:"start",children:n.jsx(Nr,{color:"action"})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:3,backgroundColor:d.palette.grey[50],transition:d.transitions.create(["box-shadow","background-color"]),"&:hover":{backgroundColor:d.palette.grey[100]},"&.Mui-focused":{backgroundColor:d.palette.background.paper,boxShadow:`0 0 0 2px ${d.palette.primary.main}25`}}}})}),n.jsx(g,{sx:{flex:1,overflowY:"auto",px:2,py:1},children:o?n.jsx(g,{sx:{display:"flex",justifyContent:"center",p:4},children:n.jsx(ee,{})}):c?n.jsxs(g,{sx:{p:3,textAlign:"center"},children:[n.jsx(f,{color:"error",gutterBottom:!0,children:c}),n.jsx(Y,{variant:"outlined",color:"primary",size:"small",onClick:()=>a(),sx:{mt:1},children:"Try Again"})]}):x.length>0?n.jsx(Hn,{disablePadding:!0,children:x.map(m=>n.jsx(bf,{chat:vf(m),currentUserId:l.uid,selected:m._id===(e||(s==null?void 0:s._id)),onClick:()=>p(m),unreadCount:m.unreadCount},m._id))}):n.jsxs(g,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",p:3,textAlign:"center"},children:[n.jsx(hr,{sx:{fontSize:48,color:d.palette.text.secondary,mb:2}}),n.jsx(f,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:y?"No conversations found":"No conversations yet"}),n.jsx(f,{color:"text.secondary",variant:"body2",children:y?"Try a different search term":"Start a new conversation to connect with others"})]})})]}):n.jsxs(re,{sx:{height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",p:4,textAlign:"center"},children:[n.jsx(hr,{sx:{fontSize:48,color:"primary.main",mb:2}}),n.jsx(f,{variant:"h6",gutterBottom:!0,children:"Welcome to Chat"}),n.jsx(f,{color:"text.secondary",sx:{mb:3},children:"Please log in to start chatting with other users."}),n.jsx(Y,{variant:"contained",color:"primary",href:"/login",startIcon:n.jsx(Pi,{}),children:"Sign In"})]})};var Kr={},jf=J;Object.defineProperty(Kr,"__esModule",{value:!0});var Ri=Kr.default=void 0,Sf=jf(Z()),_f=n;Ri=Kr.default=(0,Sf.default)((0,_f.jsx)("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send");var Xr={},Cf=J;Object.defineProperty(Xr,"__esModule",{value:!0});var Oi=Xr.default=void 0,Ef=Cf(Z()),kf=n;Oi=Xr.default=(0,Ef.default)((0,kf.jsx)("path",{d:"M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6z"}),"AttachFile");var Qr={},If=J;Object.defineProperty(Qr,"__esModule",{value:!0});var Mi=Qr.default=void 0,Af=If(Z()),Df=n;Mi=Qr.default=(0,Af.default)((0,Df.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M8.5 8c.83 0 1.5.67 1.5 1.5S9.33 11 8.5 11 7 10.33 7 9.5 7.67 8 8.5 8M12 18c-2.28 0-4.22-1.66-5-4h10c-.78 2.34-2.72 4-5 4m3.5-7c-.83 0-1.5-.67-1.5-1.5S14.67 8 15.5 8s1.5.67 1.5 1.5-.67 1.5-1.5 1.5"}),"EmojiEmotions");var Jr={},Tf=J;Object.defineProperty(Jr,"__esModule",{value:!0});var Bi=Jr.default=void 0,Pf=Tf(Z()),Rf=n;Bi=Jr.default=(0,Pf.default)((0,Rf.jsx)("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreVert");var Zr={},Of=J;Object.defineProperty(Zr,"__esModule",{value:!0});var Ni=Zr.default=void 0,Mf=Of(Z()),Bf=n;Ni=Zr.default=(0,Mf.default)((0,Bf.jsx)("path",{d:"m18 7-1.41-1.41-6.34 6.34 1.41 1.41zm4.24-1.41L11.66 16.17 7.48 12l-1.41 1.41L11.66 19l12-12zM.41 13.41 6 19l1.41-1.41L1.83 12z"}),"DoneAll");var en={},Nf=J;Object.defineProperty(en,"__esModule",{value:!0});var Li=en.default=void 0,Lf=Nf(Z()),Wf=n;Li=en.default=(0,Lf.default)((0,Wf.jsx)("path",{d:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2M8.5 13.5l2.5 3.01L14.5 12l4.5 6H5z"}),"Image");const Ff=3e3,Qe=t=>typeof t!="string"&&t!==null,$f=({chatId:t,onClose:e})=>{var N,$;const{currentChat:r,messages:s,sendMessage:i,socket:a}=dt(),{user:o}=Ft(),[c,l]=b.useState(""),[d,y]=b.useState(!1),[h,x]=b.useState(new Set),p=b.useRef(null),m=b.useRef(),u=je();b.useEffect(()=>{r&&console.log("ChatWindow currentChat:",{chatId:r._id,participants:r.participants.map(D=>({_id:D._id,username:D.username,email:D.email,displayName:D.displayName}))})},[r]),b.useEffect(()=>{var D;(D=p.current)==null||D.scrollIntoView({behavior:"smooth"})},[s]),b.useEffect(()=>{if(!a||!t)return;const D=C=>{C.chat===t&&console.log("New message received:",C)},I=C=>{C.chatId===t&&x(E=>{const w=new Set(E);return C.isTyping?w.add(C.userId):w.delete(C.userId),w})};return a.on("message",D),a.on("typing",I),()=>{a.off("message",D),a.off("typing",I)}},[a,t]);const A=()=>{!a||!t||!o||(y(!0),a.emit("typing",{chatId:t,isTyping:!0}),m.current&&clearTimeout(m.current),m.current=setTimeout(()=>{y(!1),a.emit("typing",{chatId:t,isTyping:!1})},Ff))},O=async D=>{if(D.preventDefault(),!(!c.trim()||!t))try{await i(t,c),l("")}catch(I){console.error("Error sending message:",I)}},v=D=>{const I=new Date(D);return Ii(I)?Ot(I,"HH:mm"):Ai(I)?"Yesterday":Ot(I,"MMM d")},k=(D,I)=>{var S;const C=D.sender,E=Qe(C)?C._id===(o==null?void 0:o.uid):C===(o==null?void 0:o.uid),B=(()=>{var j;return C&&Qe(C)&&(C.username||C.displayName||((j=C.email)==null?void 0:j.split("@")[0]))||"Unknown User"})();return n.jsxs(rr,{sx:{display:"flex",justifyContent:E?"flex-end":"flex-start",alignItems:"flex-start",mb:I?1.5:.5,px:2,"&:hover":{bgcolor:"transparent"},position:"relative"},disableGutters:!0,children:[!E&&I&&Qe(D.sender)&&n.jsx(ke,{src:D.sender.photoURL||void 0,sx:{width:28,height:28,mr:1,bgcolor:u.palette.grey[400],position:"absolute",left:u.spacing(2),top:0},children:(S=B[0])==null?void 0:S.toUpperCase()}),n.jsxs(g,{sx:{maxWidth:"65%",display:"flex",flexDirection:"column",alignItems:E?"flex-end":"flex-start",ml:E?0:5},children:[!E&&I&&n.jsx(f,{variant:"caption",sx:{mb:.5,ml:.5,color:u.palette.text.secondary,fontSize:"0.75rem"},children:B}),n.jsxs(re,{elevation:0,sx:{p:1.5,bgcolor:E?u.palette.primary.main:u.palette.grey[100],color:E?u.palette.primary.contrastText:u.palette.text.primary,borderRadius:2.5,borderTopRightRadius:E&&I?0:2.5,borderTopLeftRadius:!E&&I?0:2.5,position:"relative",wordBreak:"break-word",maxWidth:"100%",boxShadow:`0 1px 2px ${u.palette.mode==="dark"?"rgba(0,0,0,0.15)":"rgba(0,0,0,0.1)"}`,"&::before":I?{content:'""',position:"absolute",top:0,[E?"right":"left"]:-8,borderStyle:"solid",borderWidth:"8px 8px 0 0",borderColor:`${E?u.palette.primary.main:u.palette.grey[100]} transparent transparent transparent`,transform:E?"none":"scaleX(-1)"}:{}},children:[n.jsx(f,{variant:"body1",sx:{wordBreak:"break-word",whiteSpace:"pre-wrap",lineHeight:1.4},children:D.text}),n.jsxs(g,{sx:{display:"flex",alignItems:"center",justifyContent:"flex-end",gap:.5,mt:.5,opacity:.7,minHeight:15},children:[n.jsx(f,{variant:"caption",sx:{fontSize:"0.7rem",color:E?u.palette.primary.contrastText:u.palette.text.secondary,opacity:.8},children:v(typeof D.createdAt=="string"?D.createdAt:D.createdAt.toISOString())}),E&&n.jsx(Ni,{sx:{fontSize:14,color:D.read?u.palette.primary.contrastText:"rgba(255,255,255,0.7)",opacity:D.read?1:.5}})]})]})]})]},D._id)};if(!t||!r)return n.jsxs(g,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",bgcolor:"background.paper",borderRadius:2,p:3},children:[n.jsx(Li,{sx:{fontSize:64,color:"text.secondary",mb:2}}),n.jsx(f,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"Select a Chat"}),n.jsx(f,{color:"text.secondary",textAlign:"center",children:"Choose a conversation from the list to start messaging"})]});const R=h.size,T=r.participants.find(D=>D._id!==(o==null?void 0:o.uid));return n.jsxs(g,{sx:{display:"flex",flexDirection:"column",height:"100%",bgcolor:u.palette.background.default,borderRadius:u.shape.borderRadius,overflow:"hidden"},children:[n.jsx(re,{elevation:2,sx:{p:2,bgcolor:u.palette.background.paper,borderBottom:`1px solid ${u.palette.divider}`},children:n.jsxs(g,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[n.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:2},children:[n.jsx(st,{overlap:"circular",anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"dot",color:"success",children:n.jsx(ke,{src:T==null?void 0:T.photoURL,alt:T==null?void 0:T.username,sx:{width:45,height:45,border:`2px solid ${u.palette.primary.main}`},children:($=(N=T==null?void 0:T.username)==null?void 0:N[0])==null?void 0:$.toUpperCase()})}),n.jsxs(g,{children:[n.jsx(f,{variant:"h6",sx:{fontWeight:600},children:T==null?void 0:T.username}),n.jsx(f,{variant:"caption",color:"text.secondary",children:d?"typing...":"online"})]})]}),n.jsx(G,{onClick:e,size:"small",children:n.jsx(Bi,{})})]})}),n.jsx(g,{sx:{flex:1,overflowY:"auto",bgcolor:u.palette.background.default,backgroundImage:"linear-gradient(rgba(255,255,255,.95), rgba(255,255,255,.95))",display:"flex",flexDirection:"column"},children:n.jsxs(Hn,{sx:{width:"100%",pt:2,pb:2},children:[s.length>0?s.map((D,I)=>{const C=s[I+1],E=Qe(D.sender)?D.sender._id:D.sender,w=C&&Qe(C.sender)?C.sender._id:C==null?void 0:C.sender,B=!C||!w||!E||w!==E||new Date(C.createdAt).getTime()-new Date(D.createdAt).getTime()>3e5;return k(D,B)}):n.jsx(g,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",p:3},children:n.jsx(f,{variant:"body1",color:"text.secondary",children:r!=null&&r.participants.some(D=>D.username==="Ivan"||D.displayName==="Ivan")?"You have 1 message(s) from Ivan":"No messages yet. Start the conversation!"})}),R>0&&n.jsxs(rr,{sx:{justifyContent:"flex-start"},children:[n.jsx(ke,{sx:{width:32,height:32,mr:1},children:"U"}),n.jsx(re,{elevation:1,sx:{p:1.5,bgcolor:"grey.100",borderRadius:2},children:n.jsx(f,{variant:"caption",color:"text.secondary",sx:{fontStyle:"italic"},children:R===1?"Someone is typing...":"Multiple people are typing..."})})]}),n.jsx("div",{ref:p})]})}),n.jsxs(re,{component:"form",onSubmit:O,sx:{p:2,bgcolor:u.palette.background.paper,borderTop:`1px solid ${u.palette.divider}`,display:"flex",gap:1,alignItems:"center"},children:[n.jsx(G,{size:"small",color:"primary",children:n.jsx(Mi,{})}),n.jsx(G,{size:"small",color:"primary",children:n.jsx(Oi,{})}),n.jsx(U,{fullWidth:!0,variant:"outlined",placeholder:"Type a message...",value:c,onChange:D=>{l(D.target.value),A()},size:"small",sx:{"& .MuiOutlinedInput-root":{borderRadius:3,bgcolor:u.palette.grey[50]}},multiline:!0,maxRows:4}),n.jsx(G,{type:"submit",color:"primary",disabled:!c.trim(),sx:{bgcolor:u.palette.primary.main,color:u.palette.primary.contrastText,"&:hover":{bgcolor:u.palette.primary.dark},"&.Mui-disabled":{bgcolor:u.palette.action.disabledBackground}},children:n.jsx(Ri,{})})]})]})};var tn={},qf=J;Object.defineProperty(tn,"__esModule",{value:!0});var Wi=tn.default=void 0,Uf=qf(Z()),zf=n;Wi=tn.default=(0,Uf.default)((0,zf.jsx)("path",{d:"M3 18h18v-2H3zm0-5h18v-2H3zm0-7v2h18V6z"}),"Menu");var rn={},Vf=J;Object.defineProperty(rn,"__esModule",{value:!0});var fr=rn.default=void 0,Hf=Vf(Z()),Yf=n;fr=rn.default=(0,Hf.default)((0,Yf.jsx)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack");var nn={},Gf=J;Object.defineProperty(nn,"__esModule",{value:!0});var Fi=nn.default=void 0,Kf=Gf(Z()),Xf=n;Fi=nn.default=(0,Kf.default)((0,Xf.jsx)("path",{d:"M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2m6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1z"}),"Notifications");var sn={},Qf=J;Object.defineProperty(sn,"__esModule",{value:!0});var $i=sn.default=void 0,Jf=Qf(Z()),Zf=n;$i=sn.default=(0,Jf.default)((0,Zf.jsx)("path",{d:"M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6"}),"Settings");const em=()=>{var p;const t=je(),e=ae(),r=Yn(t.breakpoints.down("md")),[s,i]=b.useState(!1),{currentChat:a,setCurrentChat:o,unreadCount:c}=dt(),{user:l}=Ft();b.useEffect(()=>{const m=document.querySelector("nav"),u=document.body;return m&&(m.style.display="none"),u.style.backgroundColor=t.palette.background.default,()=>{m&&(m.style.display="flex"),u.style.backgroundColor=""}},[t.palette.background.default]);const d=()=>i(!s),y=m=>{o(m),r&&i(!1)},h=()=>{a&&r?(o(null),i(!0)):e("/")};if(!l)return n.jsx(z,{maxWidth:"sm",sx:{mt:8},children:n.jsx(sa,{in:!0,timeout:800,children:n.jsxs(re,{elevation:3,sx:{p:4,textAlign:"center",borderRadius:3,bgcolor:"background.paper",boxShadow:t.shadows[3]},children:[n.jsx(f,{variant:"h4",gutterBottom:!0,fontWeight:"500",color:"primary",children:"Welcome to Chat"}),n.jsx(f,{variant:"body1",color:"text.secondary",paragraph:!0,children:"Please sign in to start connecting with other users in real-time."}),n.jsx(Y,{variant:"contained",size:"large",onClick:()=>e("/login"),sx:{mt:2,borderRadius:2,textTransform:"none",fontSize:"1.1rem"},children:"Sign In"})]})})});const x=n.jsxs(g,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[n.jsxs(g,{sx:{p:2,borderBottom:`1px solid ${t.palette.divider}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[n.jsx(f,{variant:"h6",fontWeight:"500",children:"Messages"}),n.jsxs(g,{sx:{display:"flex",gap:1},children:[n.jsx(G,{size:"small",children:n.jsx(st,{badgeContent:c,color:"primary",children:n.jsx(Fi,{})})}),n.jsx(G,{size:"small",children:n.jsx($i,{})})]})]}),n.jsx(g,{sx:{flex:1,overflow:"auto"},children:n.jsx(wf,{onChatSelect:y,selectedChatId:a==null?void 0:a._id})})]});return n.jsxs(g,{sx:{height:"100vh",display:"flex",flexDirection:"column",bgcolor:t.palette.background.default,position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:t.zIndex.drawer+1},children:[n.jsx(Gn,{position:"static",color:"inherit",elevation:0,sx:{borderBottom:`1px solid ${t.palette.divider}`,bgcolor:t.palette.background.paper},children:n.jsxs(Kn,{sx:{minHeight:{xs:56,sm:64}},children:[n.jsx(G,{edge:"start",onClick:h,sx:{mr:2,color:t.palette.text.primary,"&:hover":{bgcolor:t.palette.action.hover}},children:a&&r?n.jsx(fr,{}):n.jsx(fr,{})}),n.jsx(f,{variant:"h6",component:"div",sx:{flexGrow:1,fontWeight:500,color:t.palette.text.primary},children:a&&r?(p=a.participants.find(m=>m._id!==l.uid))==null?void 0:p.username:"Messages"}),r&&!a&&n.jsx(G,{color:"inherit",edge:"end",onClick:d,sx:{display:{md:"none"}},children:n.jsx(Wi,{})})]})}),n.jsxs(g,{sx:{flex:1,display:"flex",overflow:"hidden",bgcolor:t.palette.background.default},children:[r?n.jsx(ia,{variant:"temporary",anchor:"left",open:s,onClose:d,ModalProps:{keepMounted:!0},sx:{display:{xs:"block",md:"none"},"& .MuiDrawer-paper":{width:{xs:"100%",sm:320},bgcolor:t.palette.background.paper}},children:x}):n.jsx(g,{sx:{width:320,flexShrink:0,bgcolor:t.palette.background.paper,borderRight:`1px solid ${t.palette.divider}`,display:"flex",flexDirection:"column"},children:x}),n.jsx(g,{sx:{flex:1,display:"flex",flexDirection:"column",bgcolor:t.palette.background.default,...r&&!a&&{display:"none"}},children:n.jsx($f,{chatId:(a==null?void 0:a._id)||"",onClose:h})})]})]})},tm=()=>n.jsxs(pa,{children:[n.jsx(se,{path:"/",element:n.jsx(Ll,{})}),n.jsx(se,{path:"/login",element:n.jsx(Wl,{})}),n.jsx(se,{path:"/register",element:n.jsx(Fl,{})}),n.jsx(se,{path:"/forgot-password",element:n.jsx(uf,{})}),n.jsx(se,{path:"/profile",element:n.jsx(Ul,{})}),n.jsx(se,{path:"/settings",element:n.jsx(sf,{})}),n.jsx(se,{path:"/contact",element:n.jsx(af,{})}),n.jsx(se,{path:"/create-listing",element:n.jsx(Jl,{})}),n.jsx(se,{path:"/listing/:id",element:n.jsx(Zl,{})}),n.jsx(se,{path:"/edit-listing/:id",element:n.jsx(nd,{})}),n.jsx(se,{path:"/search",element:n.jsx(xh,{})}),n.jsx(se,{path:"/how-it-works",element:n.jsx(yh,{})}),n.jsx(se,{path:"/my-listings",element:n.jsx(rf,{})}),n.jsx(se,{path:"/about",element:n.jsx(nf,{})}),n.jsx(se,{path:"/favorites",element:n.jsx(cf,{})}),n.jsx(se,{path:"/privacy",element:n.jsx(lf,{})}),n.jsx(se,{path:"/terms",element:n.jsx(df,{})}),n.jsx(se,{path:"/chat",element:n.jsx(em,{})}),n.jsx(se,{path:"*",element:n.jsx(hf,{})})]}),rm=()=>{var O;const t=ae(),{user:e,logout:r}=le(),{unreadCount:s}=dt(),i=je(),a=Yn(i.breakpoints.down("md")),[o,c]=b.useState(null),[l,d]=b.useState(null),y=[{title:"Начало",path:"/"},{title:"Търсене",path:"/search"},{title:"Как работи",path:"/how-it-works"},{title:"За нас",path:"/about"},{title:"Контакти",path:"/contact"}],h=e?[{title:"Профил",path:"/profile"},{title:"Моите обяви",path:"/my-listings"},{title:"Любими",path:"/favorites"},{title:"Настройки",path:"/settings"},{title:"Изход",action:r}]:[{title:"Вход",path:"/login"},{title:"Регистрация",path:"/register"}],x=v=>{c(v.currentTarget)},p=v=>{d(v.currentTarget)},m=()=>{c(null)},u=()=>{d(null)},A=(v,k)=>{k?k():v&&t(v),m(),u()};return n.jsx(Gn,{position:"sticky",color:"default",elevation:1,children:n.jsx(z,{maxWidth:"lg",children:n.jsxs(Kn,{disableGutters:!0,children:[n.jsx(g,{sx:{display:{xs:"none",md:"flex"},mr:2},children:n.jsx(G,{onClick:()=>t("/"),sx:{p:0,color:"primary.main"},children:n.jsx(Ct,{sx:{fontSize:32}})})}),n.jsxs(g,{sx:{flexGrow:1,display:{xs:"flex",md:"none"}},children:[n.jsx(G,{size:"large","aria-label":"menu","aria-controls":"menu-appbar","aria-haspopup":"true",onClick:x,color:"inherit",children:n.jsx(aa,{})}),n.jsx(an,{id:"menu-appbar",anchorEl:o,anchorOrigin:{vertical:"bottom",horizontal:"left"},keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"left"},open:!!o,onClose:m,sx:{display:{xs:"block",md:"none"}},children:y.map(v=>n.jsx(Te,{onClick:()=>A(v.path),children:n.jsx(f,{textAlign:"center",children:v.title})},v.title))})]}),n.jsx(g,{sx:{display:{xs:"flex",md:"none"},flexGrow:1},children:n.jsx(G,{onClick:()=>t("/"),sx:{p:0,color:"primary.main"},children:n.jsx(Ct,{sx:{fontSize:32}})})}),n.jsx(g,{sx:{flexGrow:1,display:{xs:"none",md:"flex"}},children:y.map(v=>n.jsx(Y,{onClick:()=>A(v.path),sx:{my:2,color:"text.primary",display:"block","&:hover":{color:"primary.main"}},children:v.title},v.title))}),e&&n.jsx(on,{title:"Messages",children:n.jsx(G,{onClick:()=>t("/chat"),sx:{mr:2,color:"text.primary",position:"relative"},children:n.jsx(st,{badgeContent:s||0,color:"error",invisible:!s,sx:{"& .MuiBadge-badge":{backgroundColor:i.palette.error.main,color:i.palette.error.contrastText,minWidth:"20px",height:"20px",borderRadius:"10px",fontSize:"0.75rem",fontWeight:"bold",padding:"0 6px",transform:"scale(1) translate(25%, -25%)"}},children:n.jsx(zn,{})})})}),e&&n.jsx(Y,{startIcon:n.jsx(Vn,{}),variant:"contained",color:"primary",onClick:()=>t("/create-listing"),sx:{mr:2},children:a?"Добави":"Създай обява"}),n.jsxs(g,{sx:{flexShrink:0},children:[n.jsx(on,{title:e?"Настройки на профила":"Вход",children:n.jsx(G,{onClick:p,sx:{p:0},children:n.jsx(ke,{alt:(e==null?void 0:e.displayName)||"User",src:(e==null?void 0:e.photoURL)||void 0,sx:{bgcolor:e?"primary.main":"grey.400",width:40,height:40},children:((O=e==null?void 0:e.displayName)==null?void 0:O[0])||"U"})})}),n.jsx(an,{sx:{mt:"45px"},id:"menu-appbar",anchorEl:l,anchorOrigin:{vertical:"top",horizontal:"right"},keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:!!l,onClose:u,children:h.map(v=>n.jsx(Te,{onClick:()=>A(v.path,v.action),children:n.jsx(f,{textAlign:"center",children:v.title})},v.title))})]})]})})})},nm={"*":{margin:0,padding:0,boxSizing:"border-box"},"html, body, #root":{width:"100%",minHeight:"100vh",margin:0,padding:0},body:{overflowY:"auto",overflowX:"hidden"}},sm=()=>n.jsx(ga,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:n.jsxs(oa,{theme:sl,children:[n.jsx(ca,{}),n.jsx(la,{styles:nm}),n.jsx(cc,{children:n.jsx(nl,{children:n.jsx(La,{children:n.jsxs(g,{sx:{display:"flex",flexDirection:"column",minHeight:"100vh",width:"100%",position:"relative",overflow:"hidden"},children:[n.jsx(rm,{}),n.jsx(g,{component:"main",sx:{flex:1,display:"flex",flexDirection:"column",width:"100%",position:"relative"},children:n.jsx(tm,{})})]})})})})]})});us(document.getElementById("root")).render(n.jsx(b.StrictMode,{children:n.jsx(sm,{})}));
//# sourceMappingURL=index-CB61Oyo6.js.map
